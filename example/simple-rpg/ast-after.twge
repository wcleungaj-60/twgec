//--------------------------------//
//--- AST After symbolChecking ---//
//--------------------------------//
const INSTANCE_ANGLE = "{instance.bodyRotation}*180/3.14";
const WIND_STAFF_ENBLAST_DAMAGE = "{instance.INT} + {instance.PSY}/2 + 10";
const HP_FORMULA = "98 + 10*{instance.CON} + 2*{instance.Level}";
const RECOVERY_FORMULA = "1 + {instance.PSY} + {instance.CON}/2";
const STATUS_TEXT = ("【Lv{{instance.id}.Level}】\n" + ("Exp:{{instance.id}.Exp}/{{instance.id}.ExpNeeded}\n" + ("尚餘能力點：{{instance.id}.Point}\n" + ("力量：{{instance.id}.STR}\n" + ("體質：{{instance.id}.CON}\n" + ("敏捷：{{instance.id}.AGI}\n" + ("智慧：{{instance.id}.INT}\n" + "精神：{{instance.id}.PSY}")))))));
const SPAWN_POINT = Point(10,10);
const DEBUG_MODE = false;
const USER_STATE_CATEGORY = "simple-rpg-test";
__skydowLocs__ = SPAWN_POINT;
__royalLocs__ = SPAWN_POINT;
__thirdLocs__ = SPAWN_POINT;
__lives__ = 9999;
__title__ = "RPG試驗";
__useDefaultItems__ = true;
__useCustomWeapons__ = true;
__customWeapons__ = [CustomWeapon(reference = "TWilightGameEventCompiler.weapon_wind_staff", code = "wind_staff", damage = 5, fireType = "單手橫劈", pivotOnHandDegree = 58, pivotOnHandX = 2, pivotOnHandY = 9, pivotOnHandXScale = "1.3", pivotOnHandYScale = "1.5", pivotOnIconDegree = -40, pivotOnIconX = 20, pivotOnIconY = 20),CustomWeapon(reference = "TWilightGameEventCompiler.weapon_iron_sword", code = "iron_sword", damage = 30, fireType = "大刀砍劈", pivotOnHandDegree = 35, pivotOnHandX = -12, pivotOnIconDegree = -40, pivotOnIconX = 27, pivotOnIconY = 14)];
__map__ = "CG.TWilightGameEventCompiler/rpg/simple_rpg.twmap";
__roomSize__ = 8;
def debug(text) : actions {
    if(DEBUG_MODE) {
        print(type = "error", text = text);
    }
}
def setInstanceInt(key, value) : actions {
    setObjectVar(key = key, object = "instance", type = "integer", value = value);
}
def biMapWarp(x1, y1, x2, y2) : actions {
    if(((x1 == x2) && (y1 < y2))) {
        mapWarp(fromX = x1, fromY = y1, toX = x2, toY = y2, direction = "下");
        mapWarp(fromX = x2, fromY = y2, toX = x1, toY = y1, direction = "上");
    } else if(((x1 == x2) && (y1 > y2))) {
        mapWarp(fromX = x1, fromY = y1, toX = x2, toY = y2, direction = "上");
        mapWarp(fromX = x2, fromY = y2, toX = x1, toY = y1, direction = "下");
    } else if(((x1 > x2) && (y1 == y2))) {
        mapWarp(fromX = x1, fromY = y1, toX = x2, toY = y2, direction = "左");
        mapWarp(fromX = x2, fromY = y2, toX = x1, toY = y1, direction = "右");
    } else if(((x1 < x2) && (y1 == y2))) {
        mapWarp(fromX = x1, fromY = y1, toX = x2, toY = y2, direction = "右");
        mapWarp(fromX = x2, fromY = y2, toX = x1, toY = y1, direction = "左");
    } else if(((x1 == x2) && (y1 == y2))) {
        print(type = "error", text = "Cannot set the same point as the mapWarp src and dst");
    } else {
        print(type = "error", text = "Bidirectional mapWarp requires x or y to be the same value");
    }
}
def updatePlayerAttributes(actorId) : actions {
    setObjectVar(key = "HP", object = actorId, type = "integer", value = ("98 + 10*{" + (actorId + (".CON} + 2*{" + (actorId + ".Level}")))));
    actorAttributes(actorId = actorId, attr = "maxHp", value = ("{" + (actorId + ".HP}")));
    actorAttributes(actorId = actorId, attr = "closeWeaponSpeed", value = ("4-3/(1+0.05*{" + (actorId + ".AGI})")));
    actorAttributes(actorId = actorId, attr = "weight", value = ("3*pow(0.97,{" + (actorId + ".AGI})")));
}
def setObjectVarFromUserState(key) : actions {
    getUserState(category = USER_STATE_CATEGORY, key = key, playerId = "{instance}", varName = ("{instance}_" + key));
    setInstanceInt(key, ("{{instance}_" + (key + "}")));
}
def setUserStateFromObjectVar(key) : actions {
    setUserState(category = USER_STATE_CATEGORY, key = key, playerId = "{instance}", type = "string", value = ("{{instance}." + (key + "}")));
}
def loadStateDef(hasSavedBefore) : block {
    __repeat__ = -1;
    checks {
        forEachActor(actor = ActorMatch(controller = "player"), varname = "instance");
        checkNumber(lhs = "{instance.completedInit}", op = "==", rhs = 1);
        if(hasSavedBefore) {
            checkString(str = "{{instance}_savedBefore}", matchKind = "equal", value = "1");
        }
        if((hasSavedBefore == false)) {
            checkString(str = "{{instance}_savedBefore}", matchKind = "equal", value = "undefined");
        }
    }
    actions {
        setObjectVar(key = "completedInit", object = "instance", type = "string", value = 2);
        if(hasSavedBefore) {
            setObjectVarFromUserState("Point");
            setObjectVarFromUserState("ExpNeeded");
            setObjectVarFromUserState("Level");
            setObjectVarFromUserState("STR");
            setObjectVarFromUserState("CON");
            setObjectVarFromUserState("AGI");
            setObjectVarFromUserState("INT");
            setObjectVarFromUserState("PSY");
            setObjectVarFromUserState("Exp");
            setObjectVarFromUserState("HP");
            updatePlayerAttributes("instance");
            deltaHp(actorCode = "instance", type = "heal", value = 9999);
        }
    }
}
def saveUserState() : actions {
    setUserStateFromObjectVar("Point");
    setUserStateFromObjectVar("ExpNeeded");
    setUserStateFromObjectVar("Level");
    setUserStateFromObjectVar("STR");
    setUserStateFromObjectVar("CON");
    setUserStateFromObjectVar("AGI");
    setUserStateFromObjectVar("INT");
    setUserStateFromObjectVar("PSY");
    setUserStateFromObjectVar("Exp");
    setUserStateFromObjectVar("HP");
    setUserState(category = USER_STATE_CATEGORY, key = "savedBefore", playerId = "{instance}", type = "integer", value = "1");
}
def clickIncreaseDef(type, typeZh) : block {
    __repeat__ = -1;
    triggers {
        clickButton(varName = "instance", buttonId = ("increase" + type));
    }
    checks {
        checkNumber(lhs = "{instance.Point}", op = ">", rhs = 0);
    }
    actions {
        setInstanceInt("Point", "{instance.Point}-1");
        setInstanceInt(type, ("{instance." + (type + "}+1")));
        actorTalk(actorId = "instance", text = ("成功提升一點" + (typeZh + "，尚餘{instance.Point}點能力點")));
        updatePlayerAttributes("instance");
        saveUserState();
    }
}
def releasePowerDef(weapon) : block {
    __repeat__ = -1;
    triggers {
        releasePower(varName = "instance", weapon = weapon);
    }
    actions {
        if((weapon == "custom_wind_staff")) {
            enblastEffect(fromActor = "instance", scale = "0.5", damage = WIND_STAFF_ENBLAST_DAMAGE, toAngle = (INSTANCE_ANGLE + 32));
            enblastEffect(fromActor = "instance", scale = "0.5", damage = WIND_STAFF_ENBLAST_DAMAGE, toAngle = (INSTANCE_ANGLE + 16));
            enblastEffect(fromActor = "instance", scale = "0.5", damage = WIND_STAFF_ENBLAST_DAMAGE, toAngle = INSTANCE_ANGLE);
            enblastEffect(fromActor = "instance", scale = "0.5", damage = WIND_STAFF_ENBLAST_DAMAGE, toAngle = (INSTANCE_ANGLE - 16));
            enblastEffect(fromActor = "instance", scale = "0.5", damage = WIND_STAFF_ENBLAST_DAMAGE, toAngle = (INSTANCE_ANGLE - 32));
        }
        if((weapon == "custom_iron_sword")) {
            deltaHp(actorCode = "instance", value = "{instance.HP}/4");
        }
    }
}
block loadStateSaved = loadStateDef(hasSavedBefore = true);
block loadStateNew = loadStateDef(hasSavedBefore = false);
block clickIncreaseSTR = clickIncreaseDef("STR", "力量");
block clickIncreaseCON = clickIncreaseDef("CON", "體質");
block clickIncreaseAGI = clickIncreaseDef("AGI", "敏捷");
block clickIncreaseINT = clickIncreaseDef("INT", "智慧");
block clickIncreasePSY = clickIncreaseDef("PSY", "精神");
block releasePowerWindStaff = releasePowerDef("custom_wind_staff");
block releasePowerIronSword = releasePowerDef("custom_iron_sword");
block clickResetPoint {
    __repeat__ = -1;
    triggers {
        clickButton(varName = "instance", buttonId = "ResetPoint");
    }
    actions {
        setInstanceInt("Point", "{instance.Level}*2+3");
        setInstanceInt("STR", 0);
        setInstanceInt("CON", 0);
        setInstanceInt("AGI", 0);
        setInstanceInt("INT", 0);
        setInstanceInt("PSY", 0);
        actorTalk(actorId = "instance", text = "成功重設能力點，目前有{instance.Point}點能力點");
        updatePlayerAttributes("instance");
        saveUserState();
    }
}
block getExp {
    __repeat__ = -1;
    triggers {
        itemPickup(actorVarname = "instance", matchKind = "equal", itemVarname = "deer_exp");
    }
    actions {
        setInstanceInt("Exp", ("{instance.Exp}" + 1));
        saveUserState();
    }
}
block monsterDead {
    __repeat__ = -1;
    triggers {
        actorDead(actor = ActorMatch(id = "monster"), varName = "instance");
    }
    actions {
        addDropItem(itemCode = "deer_exp", x = "({instance.gamePosition.x}-16)/32", y = "({instance.gamePosition.y}-16)/32", type = "sariraFire");
    }
}
block monsterSpawn {
    __repeat__ = -1;
    __repeatInterval__ = 8000;
    checks {
        actorCount(actor = ActorMatch(id = "monster_deer", matchKind = "contain"), op = "<", value = "5");
    }
    actions {
        addActor(name = "鹿(60)", id = "monster_deer*", camp = "第三", hp = 60, x = "random(21,40)", y = "random(0,19)", localVarname = "actor", weapon1 = "fist", weapon2 = "fist", strength = "10", role = "鹿");
        actorFollow(actorId = "actor", type = "跟隨自己");
    }
}
block levelUp {
    __repeat__ = -1;
    checks {
        forEachActor(actor = ActorMatch(controller = "玩家"), varname = "instance");
        checkNumber(lhs = "{instance.Exp}", op = ">=", rhs = "{instance.ExpNeeded}");
    }
    actions {
        setInstanceInt("Exp", "{instance.Exp}-{instance.ExpNeeded}");
        setInstanceInt("Level", ("{instance.Level}" + 1));
        setInstanceInt("Point", ("{instance.Point}" + 2));
        setInstanceInt("ExpNeeded", "{instance.Level}*2+4");
        setInstanceInt("HP", HP_FORMULA);
        actorAttributes(actorId = "instance", attr = "maxHp", value = "{instance.HP}");
        saveUserState();
    }
}
block recover {
    __repeat__ = -1;
    __repeatInterval__ = 10000;
    checks {
        forEachActor(actor = ActorMatch(controller = "玩家"), varname = "instance");
    }
    actions {
        deltaHp(actorCode = "instance", value = RECOVERY_FORMULA);
    }
}
block pressZ {
    __repeat__ = -1;
    triggers {
        keyboardPressed(varName = "instance", key = "Z");
    }
    actions {
        actorTalk(actorId = "{instance.id}", text = STATUS_TEXT);
    }
}
block staffAttack {
    __repeat__ = -1;
    triggers {
        actorFire(weapon = "custom_wind_staff", varName = "instance");
    }
    actions {
        enblastEffect(fromActor = "instance", toAngle = INSTANCE_ANGLE, scale = "0.5", damage = WIND_STAFF_ENBLAST_DAMAGE);
    }
}
block swordAttack {
    __repeat__ = -1;
    triggers {
        actorHit(actor = ActorMatch(), actorVarName = "instance", hitter = ActorMatch(), hitterVarName = "attacker", weapon = "custom_iron_sword");
    }
    actions {
        deltaHp(actorCode = "instance", casterCode = "attacker", type = "流血受傷", value = "{attacker.STR}*3");
    }
}
block newPlayer {
    __repeat__ = -1;
    triggers {
        actorAdded(actor = ActorMatch(controller = "player"), varName = "instance");
    }
    actions {
        setInstanceInt("STR", 0);
        setInstanceInt("CON", 0);
        setInstanceInt("AGI", 0);
        setInstanceInt("INT", 0);
        setInstanceInt("PSY", 0);
        setInstanceInt("Level", 1);
        setInstanceInt("Point", 5);
        setInstanceInt("Exp", 0);
        setInstanceInt("ExpNeeded", 6);
        setInstanceInt("HP", 100);
        getUserState(category = USER_STATE_CATEGORY, key = "savedBefore", playerId = "{instance}", varName = "{instance}_savedBefore");
        setInstanceInt("completedInit", 1);
    }
}
block init {
    actions {
        setWeaponAbility(weapon = "小刀", operation = "無技能", level = 1);
        setWeaponAbility(weapon = "小刀", operation = "無技能", level = 2);
        setWeaponAbility(weapon = "custom_wind_staff");
        setWeaponAbility(weapon = "custom_iron_sword");
        addStuff(x = 4, y = 8, item = "custom_wind_staff");
        addStuff(x = 4, y = 8, item = "custom_wind_staff");
        addStuff(x = 4, y = 8, item = "custom_wind_staff");
        addStuff(x = 4, y = 8, item = "custom_wind_staff");
        addStuff(x = 4, y = 8, item = "custom_wind_staff");
        addMapSign(x = 4, y = 7, rotation = 90, text = "【法杖】\n武器傷害：5\n - 攻擊附帶傷害為【10+智慧+精神/2】的光彈\n技能：釋出5發光彈", showButtons = false);
        addMapSign(x = 6, y = 7, rotation = 90, text = "【鐵劍】\n武器傷害：【30+力量*3】\n技能：恢復四分之一的血量", showButtons = false);
        biMapWarp(x1 = 19, y1 = 9, x2 = 21, y2 = 9);
        biMapWarp(x1 = 19, y1 = 10, x2 = 21, y2 = 10);
        addStuff(x = 6, y = 8, item = "custom_iron_sword");
        addStuff(x = 6, y = 8, item = "custom_iron_sword");
        addStuff(x = 6, y = 8, item = "custom_iron_sword");
        addStuff(x = 6, y = 8, item = "custom_iron_sword");
        addStuff(x = 6, y = 8, item = "custom_iron_sword");
        addMapSign(x = 3, y = 17, rotation = 270, text = "【力量】\n消耗一點能力點，提升劍類傷害", buttonCode = "increaseSTR", buttonLabel = "確認");
        addMapSign(x = 5, y = 17, rotation = 270, text = "【體質】\n消耗一點能力點，增加十點血量上限及半點恢復力", buttonCode = "increaseCON", buttonLabel = "確認");
        addMapSign(x = 7, y = 17, rotation = 270, text = "【敏捷】\n消耗一點能力點，重量減少3%，並提升武器攻擊速度", buttonCode = "increaseAGI", buttonLabel = "確認");
        addMapSign(x = 9, y = 17, rotation = 270, text = "【智慧】\n消耗一點能力點，提升杖類傷害", buttonCode = "increaseINT", buttonLabel = "確認");
        addMapSign(x = 11, y = 17, rotation = 270, text = "【精神】\n消耗一點能力點，小量提升杖類傷害及提升一點恢復力", buttonCode = "increasePSY", buttonLabel = "確認");
        addMapSign(x = 1, y = 15, rotation = 0, text = "【重置能力點分配】", buttonCode = "ResetPoint", buttonLabel = "確認");
    }
}
//----------------------------//
//--- AST After argBinding ---//
//----------------------------//
const INSTANCE_ANGLE = "{instance.bodyRotation}*180/3.14";
const WIND_STAFF_ENBLAST_DAMAGE = "{instance.INT} + {instance.PSY}/2 + 10";
const HP_FORMULA = "98 + 10*{instance.CON} + 2*{instance.Level}";
const RECOVERY_FORMULA = "1 + {instance.PSY} + {instance.CON}/2";
const STATUS_TEXT = ("【Lv{{instance.id}.Level}】\n" + ("Exp:{{instance.id}.Exp}/{{instance.id}.ExpNeeded}\n" + ("尚餘能力點：{{instance.id}.Point}\n" + ("力量：{{instance.id}.STR}\n" + ("體質：{{instance.id}.CON}\n" + ("敏捷：{{instance.id}.AGI}\n" + ("智慧：{{instance.id}.INT}\n" + "精神：{{instance.id}.PSY}")))))));
const SPAWN_POINT = Point(10,10);
const DEBUG_MODE = false;
const USER_STATE_CATEGORY = "simple-rpg-test";
__skydowLocs__ = SPAWN_POINT;
__royalLocs__ = SPAWN_POINT;
__thirdLocs__ = SPAWN_POINT;
__lives__ = 9999;
__title__ = "RPG試驗";
__useDefaultItems__ = true;
__useCustomWeapons__ = true;
__customWeapons__ = [CustomWeapon(reference = "TWilightGameEventCompiler.weapon_wind_staff", code = "wind_staff", damage = 5, fireType = "單手橫劈", pivotOnHandDegree = 58, pivotOnHandX = 2, pivotOnHandY = 9, pivotOnHandXScale = "1.3", pivotOnHandYScale = "1.5", pivotOnIconDegree = -40, pivotOnIconX = 20, pivotOnIconY = 20),CustomWeapon(reference = "TWilightGameEventCompiler.weapon_iron_sword", code = "iron_sword", damage = 30, fireType = "大刀砍劈", pivotOnHandDegree = 35, pivotOnHandX = -12, pivotOnIconDegree = -40, pivotOnIconX = 27, pivotOnIconY = 14)];
__map__ = "CG.TWilightGameEventCompiler/rpg/simple_rpg.twmap";
__roomSize__ = 8;
def debug(text) : actions {
    if(DEBUG_MODE) {
        print(type = "error", text = text);
    }
}
def setInstanceInt(key, value) : actions {
    setObjectVar(key = key, object = "instance", type = "integer", value = value);
}
def biMapWarp(x1, y1, x2, y2) : actions {
    if(((x1 == x2) && (y1 < y2))) {
        mapWarp(fromX = x1, fromY = y1, toX = x2, toY = y2, direction = "下");
        mapWarp(fromX = x2, fromY = y2, toX = x1, toY = y1, direction = "上");
    } else if(((x1 == x2) && (y1 > y2))) {
        mapWarp(fromX = x1, fromY = y1, toX = x2, toY = y2, direction = "上");
        mapWarp(fromX = x2, fromY = y2, toX = x1, toY = y1, direction = "下");
    } else if(((x1 > x2) && (y1 == y2))) {
        mapWarp(fromX = x1, fromY = y1, toX = x2, toY = y2, direction = "左");
        mapWarp(fromX = x2, fromY = y2, toX = x1, toY = y1, direction = "右");
    } else if(((x1 < x2) && (y1 == y2))) {
        mapWarp(fromX = x1, fromY = y1, toX = x2, toY = y2, direction = "右");
        mapWarp(fromX = x2, fromY = y2, toX = x1, toY = y1, direction = "左");
    } else if(((x1 == x2) && (y1 == y2))) {
        print(type = "error", text = "Cannot set the same point as the mapWarp src and dst");
    } else {
        print(type = "error", text = "Bidirectional mapWarp requires x or y to be the same value");
    }
}
def updatePlayerAttributes(actorId) : actions {
    setObjectVar(key = "HP", object = actorId, type = "integer", value = ("98 + 10*{" + (actorId + (".CON} + 2*{" + (actorId + ".Level}")))));
    actorAttributes(actorId = actorId, attr = "maxHp", value = ("{" + (actorId + ".HP}")));
    actorAttributes(actorId = actorId, attr = "closeWeaponSpeed", value = ("4-3/(1+0.05*{" + (actorId + ".AGI})")));
    actorAttributes(actorId = actorId, attr = "weight", value = ("3*pow(0.97,{" + (actorId + ".AGI})")));
}
def setObjectVarFromUserState(key) : actions {
    getUserState(category = USER_STATE_CATEGORY, key = key, playerId = "{instance}", varName = ("{instance}_" + key));
    setInstanceInt(key = key, value = ("{{instance}_" + (key + "}")));
}
def setUserStateFromObjectVar(key) : actions {
    setUserState(category = USER_STATE_CATEGORY, key = key, playerId = "{instance}", type = "string", value = ("{{instance}." + (key + "}")));
}
def loadStateDef(hasSavedBefore) : block {
    __repeat__ = -1;
    checks {
        forEachActor(actor = ActorMatch(controller = "player"), varname = "instance");
        checkNumber(lhs = "{instance.completedInit}", op = "==", rhs = 1);
        if(hasSavedBefore) {
            checkString(str = "{{instance}_savedBefore}", matchKind = "equal", value = "1");
        }
        if((hasSavedBefore == false)) {
            checkString(str = "{{instance}_savedBefore}", matchKind = "equal", value = "undefined");
        }
    }
    actions {
        setObjectVar(key = "completedInit", object = "instance", type = "string", value = 2);
        if(hasSavedBefore) {
            setObjectVarFromUserState(key = "Point");
            setObjectVarFromUserState(key = "ExpNeeded");
            setObjectVarFromUserState(key = "Level");
            setObjectVarFromUserState(key = "STR");
            setObjectVarFromUserState(key = "CON");
            setObjectVarFromUserState(key = "AGI");
            setObjectVarFromUserState(key = "INT");
            setObjectVarFromUserState(key = "PSY");
            setObjectVarFromUserState(key = "Exp");
            setObjectVarFromUserState(key = "HP");
            updatePlayerAttributes(actorId = "instance");
            deltaHp(actorCode = "instance", type = "heal", value = 9999);
        }
    }
}
def saveUserState() : actions {
    setUserStateFromObjectVar(key = "Point");
    setUserStateFromObjectVar(key = "ExpNeeded");
    setUserStateFromObjectVar(key = "Level");
    setUserStateFromObjectVar(key = "STR");
    setUserStateFromObjectVar(key = "CON");
    setUserStateFromObjectVar(key = "AGI");
    setUserStateFromObjectVar(key = "INT");
    setUserStateFromObjectVar(key = "PSY");
    setUserStateFromObjectVar(key = "Exp");
    setUserStateFromObjectVar(key = "HP");
    setUserState(category = USER_STATE_CATEGORY, key = "savedBefore", playerId = "{instance}", type = "integer", value = "1");
}
def clickIncreaseDef(type, typeZh) : block {
    __repeat__ = -1;
    triggers {
        clickButton(varName = "instance", buttonId = ("increase" + type));
    }
    checks {
        checkNumber(lhs = "{instance.Point}", op = ">", rhs = 0);
    }
    actions {
        setInstanceInt(key = "Point", value = "{instance.Point}-1");
        setInstanceInt(key = type, value = ("{instance." + (type + "}+1")));
        actorTalk(actorId = "instance", text = ("成功提升一點" + (typeZh + "，尚餘{instance.Point}點能力點")));
        updatePlayerAttributes(actorId = "instance");
        saveUserState();
    }
}
def releasePowerDef(weapon) : block {
    __repeat__ = -1;
    triggers {
        releasePower(varName = "instance", weapon = weapon);
    }
    actions {
        if((weapon == "custom_wind_staff")) {
            enblastEffect(fromActor = "instance", scale = "0.5", damage = WIND_STAFF_ENBLAST_DAMAGE, toAngle = (INSTANCE_ANGLE + 32));
            enblastEffect(fromActor = "instance", scale = "0.5", damage = WIND_STAFF_ENBLAST_DAMAGE, toAngle = (INSTANCE_ANGLE + 16));
            enblastEffect(fromActor = "instance", scale = "0.5", damage = WIND_STAFF_ENBLAST_DAMAGE, toAngle = INSTANCE_ANGLE);
            enblastEffect(fromActor = "instance", scale = "0.5", damage = WIND_STAFF_ENBLAST_DAMAGE, toAngle = (INSTANCE_ANGLE - 16));
            enblastEffect(fromActor = "instance", scale = "0.5", damage = WIND_STAFF_ENBLAST_DAMAGE, toAngle = (INSTANCE_ANGLE - 32));
        }
        if((weapon == "custom_iron_sword")) {
            deltaHp(actorCode = "instance", value = "{instance.HP}/4");
        }
    }
}
block loadStateSaved = loadStateDef(hasSavedBefore = true);
block loadStateNew = loadStateDef(hasSavedBefore = false);
block clickIncreaseSTR = clickIncreaseDef(type = "STR", typeZh = "力量");
block clickIncreaseCON = clickIncreaseDef(type = "CON", typeZh = "體質");
block clickIncreaseAGI = clickIncreaseDef(type = "AGI", typeZh = "敏捷");
block clickIncreaseINT = clickIncreaseDef(type = "INT", typeZh = "智慧");
block clickIncreasePSY = clickIncreaseDef(type = "PSY", typeZh = "精神");
block releasePowerWindStaff = releasePowerDef(weapon = "custom_wind_staff");
block releasePowerIronSword = releasePowerDef(weapon = "custom_iron_sword");
block clickResetPoint {
    __repeat__ = -1;
    triggers {
        clickButton(varName = "instance", buttonId = "ResetPoint");
    }
    actions {
        setInstanceInt(key = "Point", value = "{instance.Level}*2+3");
        setInstanceInt(key = "STR", value = 0);
        setInstanceInt(key = "CON", value = 0);
        setInstanceInt(key = "AGI", value = 0);
        setInstanceInt(key = "INT", value = 0);
        setInstanceInt(key = "PSY", value = 0);
        actorTalk(actorId = "instance", text = "成功重設能力點，目前有{instance.Point}點能力點");
        updatePlayerAttributes(actorId = "instance");
        saveUserState();
    }
}
block getExp {
    __repeat__ = -1;
    triggers {
        itemPickup(actorVarname = "instance", matchKind = "equal", itemVarname = "deer_exp");
    }
    actions {
        setInstanceInt(key = "Exp", value = ("{instance.Exp}" + 1));
        saveUserState();
    }
}
block monsterDead {
    __repeat__ = -1;
    triggers {
        actorDead(actor = ActorMatch(id = "monster"), varName = "instance");
    }
    actions {
        addDropItem(itemCode = "deer_exp", x = "({instance.gamePosition.x}-16)/32", y = "({instance.gamePosition.y}-16)/32", type = "sariraFire");
    }
}
block monsterSpawn {
    __repeat__ = -1;
    __repeatInterval__ = 8000;
    checks {
        actorCount(actor = ActorMatch(id = "monster_deer", matchKind = "contain"), op = "<", value = "5");
    }
    actions {
        addActor(name = "鹿(60)", id = "monster_deer*", camp = "第三", hp = 60, x = "random(21,40)", y = "random(0,19)", localVarname = "actor", weapon1 = "fist", weapon2 = "fist", strength = "10", role = "鹿");
        actorFollow(actorId = "actor", type = "跟隨自己");
    }
}
block levelUp {
    __repeat__ = -1;
    checks {
        forEachActor(actor = ActorMatch(controller = "玩家"), varname = "instance");
        checkNumber(lhs = "{instance.Exp}", op = ">=", rhs = "{instance.ExpNeeded}");
    }
    actions {
        setInstanceInt(key = "Exp", value = "{instance.Exp}-{instance.ExpNeeded}");
        setInstanceInt(key = "Level", value = ("{instance.Level}" + 1));
        setInstanceInt(key = "Point", value = ("{instance.Point}" + 2));
        setInstanceInt(key = "ExpNeeded", value = "{instance.Level}*2+4");
        setInstanceInt(key = "HP", value = HP_FORMULA);
        actorAttributes(actorId = "instance", attr = "maxHp", value = "{instance.HP}");
        saveUserState();
    }
}
block recover {
    __repeat__ = -1;
    __repeatInterval__ = 10000;
    checks {
        forEachActor(actor = ActorMatch(controller = "玩家"), varname = "instance");
    }
    actions {
        deltaHp(actorCode = "instance", value = RECOVERY_FORMULA);
    }
}
block pressZ {
    __repeat__ = -1;
    triggers {
        keyboardPressed(varName = "instance", key = "Z");
    }
    actions {
        actorTalk(actorId = "{instance.id}", text = STATUS_TEXT);
    }
}
block staffAttack {
    __repeat__ = -1;
    triggers {
        actorFire(weapon = "custom_wind_staff", varName = "instance");
    }
    actions {
        enblastEffect(fromActor = "instance", toAngle = INSTANCE_ANGLE, scale = "0.5", damage = WIND_STAFF_ENBLAST_DAMAGE);
    }
}
block swordAttack {
    __repeat__ = -1;
    triggers {
        actorHit(actor = ActorMatch(), actorVarName = "instance", hitter = ActorMatch(), hitterVarName = "attacker", weapon = "custom_iron_sword");
    }
    actions {
        deltaHp(actorCode = "instance", casterCode = "attacker", type = "流血受傷", value = "{attacker.STR}*3");
    }
}
block newPlayer {
    __repeat__ = -1;
    triggers {
        actorAdded(actor = ActorMatch(controller = "player"), varName = "instance");
    }
    actions {
        setInstanceInt(key = "STR", value = 0);
        setInstanceInt(key = "CON", value = 0);
        setInstanceInt(key = "AGI", value = 0);
        setInstanceInt(key = "INT", value = 0);
        setInstanceInt(key = "PSY", value = 0);
        setInstanceInt(key = "Level", value = 1);
        setInstanceInt(key = "Point", value = 5);
        setInstanceInt(key = "Exp", value = 0);
        setInstanceInt(key = "ExpNeeded", value = 6);
        setInstanceInt(key = "HP", value = 100);
        getUserState(category = USER_STATE_CATEGORY, key = "savedBefore", playerId = "{instance}", varName = "{instance}_savedBefore");
        setInstanceInt(key = "completedInit", value = 1);
    }
}
block init {
    actions {
        setWeaponAbility(weapon = "小刀", operation = "無技能", level = 1);
        setWeaponAbility(weapon = "小刀", operation = "無技能", level = 2);
        setWeaponAbility(weapon = "custom_wind_staff");
        setWeaponAbility(weapon = "custom_iron_sword");
        addStuff(x = 4, y = 8, item = "custom_wind_staff");
        addStuff(x = 4, y = 8, item = "custom_wind_staff");
        addStuff(x = 4, y = 8, item = "custom_wind_staff");
        addStuff(x = 4, y = 8, item = "custom_wind_staff");
        addStuff(x = 4, y = 8, item = "custom_wind_staff");
        addMapSign(x = 4, y = 7, rotation = 90, text = "【法杖】\n武器傷害：5\n - 攻擊附帶傷害為【10+智慧+精神/2】的光彈\n技能：釋出5發光彈", showButtons = false);
        addMapSign(x = 6, y = 7, rotation = 90, text = "【鐵劍】\n武器傷害：【30+力量*3】\n技能：恢復四分之一的血量", showButtons = false);
        biMapWarp(x1 = 19, y1 = 9, x2 = 21, y2 = 9);
        biMapWarp(x1 = 19, y1 = 10, x2 = 21, y2 = 10);
        addStuff(x = 6, y = 8, item = "custom_iron_sword");
        addStuff(x = 6, y = 8, item = "custom_iron_sword");
        addStuff(x = 6, y = 8, item = "custom_iron_sword");
        addStuff(x = 6, y = 8, item = "custom_iron_sword");
        addStuff(x = 6, y = 8, item = "custom_iron_sword");
        addMapSign(x = 3, y = 17, rotation = 270, text = "【力量】\n消耗一點能力點，提升劍類傷害", buttonCode = "increaseSTR", buttonLabel = "確認");
        addMapSign(x = 5, y = 17, rotation = 270, text = "【體質】\n消耗一點能力點，增加十點血量上限及半點恢復力", buttonCode = "increaseCON", buttonLabel = "確認");
        addMapSign(x = 7, y = 17, rotation = 270, text = "【敏捷】\n消耗一點能力點，重量減少3%，並提升武器攻擊速度", buttonCode = "increaseAGI", buttonLabel = "確認");
        addMapSign(x = 9, y = 17, rotation = 270, text = "【智慧】\n消耗一點能力點，提升杖類傷害", buttonCode = "increaseINT", buttonLabel = "確認");
        addMapSign(x = 11, y = 17, rotation = 270, text = "【精神】\n消耗一點能力點，小量提升杖類傷害及提升一點恢復力", buttonCode = "increasePSY", buttonLabel = "確認");
        addMapSign(x = 1, y = 15, rotation = 0, text = "【重置能力點分配】", buttonCode = "ResetPoint", buttonLabel = "確認");
    }
}
//-----------------------------//
//--- AST After blockInling ---//
//-----------------------------//
const INSTANCE_ANGLE = "{instance.bodyRotation}*180/3.14";
const WIND_STAFF_ENBLAST_DAMAGE = "{instance.INT} + {instance.PSY}/2 + 10";
const HP_FORMULA = "98 + 10*{instance.CON} + 2*{instance.Level}";
const RECOVERY_FORMULA = "1 + {instance.PSY} + {instance.CON}/2";
const STATUS_TEXT = ("【Lv{{instance.id}.Level}】\n" + ("Exp:{{instance.id}.Exp}/{{instance.id}.ExpNeeded}\n" + ("尚餘能力點：{{instance.id}.Point}\n" + ("力量：{{instance.id}.STR}\n" + ("體質：{{instance.id}.CON}\n" + ("敏捷：{{instance.id}.AGI}\n" + ("智慧：{{instance.id}.INT}\n" + "精神：{{instance.id}.PSY}")))))));
const SPAWN_POINT = Point(10,10);
const DEBUG_MODE = false;
const USER_STATE_CATEGORY = "simple-rpg-test";
__skydowLocs__ = SPAWN_POINT;
__royalLocs__ = SPAWN_POINT;
__thirdLocs__ = SPAWN_POINT;
__lives__ = 9999;
__title__ = "RPG試驗";
__useDefaultItems__ = true;
__useCustomWeapons__ = true;
__customWeapons__ = [CustomWeapon(reference = "TWilightGameEventCompiler.weapon_wind_staff", code = "wind_staff", damage = 5, fireType = "單手橫劈", pivotOnHandDegree = 58, pivotOnHandX = 2, pivotOnHandY = 9, pivotOnHandXScale = "1.3", pivotOnHandYScale = "1.5", pivotOnIconDegree = -40, pivotOnIconX = 20, pivotOnIconY = 20),CustomWeapon(reference = "TWilightGameEventCompiler.weapon_iron_sword", code = "iron_sword", damage = 30, fireType = "大刀砍劈", pivotOnHandDegree = 35, pivotOnHandX = -12, pivotOnIconDegree = -40, pivotOnIconX = 27, pivotOnIconY = 14)];
__map__ = "CG.TWilightGameEventCompiler/rpg/simple_rpg.twmap";
__roomSize__ = 8;
def debug(text) : actions {
    if(DEBUG_MODE) {
        print(type = "error", text = text);
    }
}
def setInstanceInt(key, value) : actions {
    setObjectVar(key = key, object = "instance", type = "integer", value = value);
}
def biMapWarp(x1, y1, x2, y2) : actions {
    if(((x1 == x2) && (y1 < y2))) {
        mapWarp(fromX = x1, fromY = y1, toX = x2, toY = y2, direction = "下");
        mapWarp(fromX = x2, fromY = y2, toX = x1, toY = y1, direction = "上");
    } else if(((x1 == x2) && (y1 > y2))) {
        mapWarp(fromX = x1, fromY = y1, toX = x2, toY = y2, direction = "上");
        mapWarp(fromX = x2, fromY = y2, toX = x1, toY = y1, direction = "下");
    } else if(((x1 > x2) && (y1 == y2))) {
        mapWarp(fromX = x1, fromY = y1, toX = x2, toY = y2, direction = "左");
        mapWarp(fromX = x2, fromY = y2, toX = x1, toY = y1, direction = "右");
    } else if(((x1 < x2) && (y1 == y2))) {
        mapWarp(fromX = x1, fromY = y1, toX = x2, toY = y2, direction = "右");
        mapWarp(fromX = x2, fromY = y2, toX = x1, toY = y1, direction = "左");
    } else if(((x1 == x2) && (y1 == y2))) {
        print(type = "error", text = "Cannot set the same point as the mapWarp src and dst");
    } else {
        print(type = "error", text = "Bidirectional mapWarp requires x or y to be the same value");
    }
}
def updatePlayerAttributes(actorId) : actions {
    setObjectVar(key = "HP", object = actorId, type = "integer", value = ("98 + 10*{" + (actorId + (".CON} + 2*{" + (actorId + ".Level}")))));
    actorAttributes(actorId = actorId, attr = "maxHp", value = ("{" + (actorId + ".HP}")));
    actorAttributes(actorId = actorId, attr = "closeWeaponSpeed", value = ("4-3/(1+0.05*{" + (actorId + ".AGI})")));
    actorAttributes(actorId = actorId, attr = "weight", value = ("3*pow(0.97,{" + (actorId + ".AGI})")));
}
def setObjectVarFromUserState(key) : actions {
    getUserState(category = USER_STATE_CATEGORY, key = key, playerId = "{instance}", varName = ("{instance}_" + key));
    setInstanceInt(key = key, value = ("{{instance}_" + (key + "}")));
}
def setUserStateFromObjectVar(key) : actions {
    setUserState(category = USER_STATE_CATEGORY, key = key, playerId = "{instance}", type = "string", value = ("{{instance}." + (key + "}")));
}
def loadStateDef(hasSavedBefore) : block {
    __repeat__ = -1;
    checks {
        forEachActor(actor = ActorMatch(controller = "player"), varname = "instance");
        checkNumber(lhs = "{instance.completedInit}", op = "==", rhs = 1);
        if(hasSavedBefore) {
            checkString(str = "{{instance}_savedBefore}", matchKind = "equal", value = "1");
        }
        if((hasSavedBefore == false)) {
            checkString(str = "{{instance}_savedBefore}", matchKind = "equal", value = "undefined");
        }
    }
    actions {
        setObjectVar(key = "completedInit", object = "instance", type = "string", value = 2);
        if(hasSavedBefore) {
            setObjectVarFromUserState(key = "Point");
            setObjectVarFromUserState(key = "ExpNeeded");
            setObjectVarFromUserState(key = "Level");
            setObjectVarFromUserState(key = "STR");
            setObjectVarFromUserState(key = "CON");
            setObjectVarFromUserState(key = "AGI");
            setObjectVarFromUserState(key = "INT");
            setObjectVarFromUserState(key = "PSY");
            setObjectVarFromUserState(key = "Exp");
            setObjectVarFromUserState(key = "HP");
            updatePlayerAttributes(actorId = "instance");
            deltaHp(actorCode = "instance", type = "heal", value = 9999);
        }
    }
}
def saveUserState() : actions {
    setUserStateFromObjectVar(key = "Point");
    setUserStateFromObjectVar(key = "ExpNeeded");
    setUserStateFromObjectVar(key = "Level");
    setUserStateFromObjectVar(key = "STR");
    setUserStateFromObjectVar(key = "CON");
    setUserStateFromObjectVar(key = "AGI");
    setUserStateFromObjectVar(key = "INT");
    setUserStateFromObjectVar(key = "PSY");
    setUserStateFromObjectVar(key = "Exp");
    setUserStateFromObjectVar(key = "HP");
    setUserState(category = USER_STATE_CATEGORY, key = "savedBefore", playerId = "{instance}", type = "integer", value = "1");
}
def clickIncreaseDef(type, typeZh) : block {
    __repeat__ = -1;
    triggers {
        clickButton(varName = "instance", buttonId = ("increase" + type));
    }
    checks {
        checkNumber(lhs = "{instance.Point}", op = ">", rhs = 0);
    }
    actions {
        setInstanceInt(key = "Point", value = "{instance.Point}-1");
        setInstanceInt(key = type, value = ("{instance." + (type + "}+1")));
        actorTalk(actorId = "instance", text = ("成功提升一點" + (typeZh + "，尚餘{instance.Point}點能力點")));
        updatePlayerAttributes(actorId = "instance");
        saveUserState();
    }
}
def releasePowerDef(weapon) : block {
    __repeat__ = -1;
    triggers {
        releasePower(varName = "instance", weapon = weapon);
    }
    actions {
        if((weapon == "custom_wind_staff")) {
            enblastEffect(fromActor = "instance", scale = "0.5", damage = WIND_STAFF_ENBLAST_DAMAGE, toAngle = (INSTANCE_ANGLE + 32));
            enblastEffect(fromActor = "instance", scale = "0.5", damage = WIND_STAFF_ENBLAST_DAMAGE, toAngle = (INSTANCE_ANGLE + 16));
            enblastEffect(fromActor = "instance", scale = "0.5", damage = WIND_STAFF_ENBLAST_DAMAGE, toAngle = INSTANCE_ANGLE);
            enblastEffect(fromActor = "instance", scale = "0.5", damage = WIND_STAFF_ENBLAST_DAMAGE, toAngle = (INSTANCE_ANGLE - 16));
            enblastEffect(fromActor = "instance", scale = "0.5", damage = WIND_STAFF_ENBLAST_DAMAGE, toAngle = (INSTANCE_ANGLE - 32));
        }
        if((weapon == "custom_iron_sword")) {
            deltaHp(actorCode = "instance", value = "{instance.HP}/4");
        }
    }
}
block loadStateSaved {
    __repeat__ = -1;
    checks {
        forEachActor(actor = ActorMatch(controller = "player"), varname = "instance");
        checkNumber(lhs = "{instance.completedInit}", op = "==", rhs = 1);
        if(true) {
            checkString(str = "{{instance}_savedBefore}", matchKind = "equal", value = "1");
        }
        if((true == false)) {
            checkString(str = "{{instance}_savedBefore}", matchKind = "equal", value = "undefined");
        }
    }
    actions {
        setObjectVar(key = "completedInit", object = "instance", type = "string", value = 2);
        if(true) {
            setObjectVarFromUserState(key = "Point");
            setObjectVarFromUserState(key = "ExpNeeded");
            setObjectVarFromUserState(key = "Level");
            setObjectVarFromUserState(key = "STR");
            setObjectVarFromUserState(key = "CON");
            setObjectVarFromUserState(key = "AGI");
            setObjectVarFromUserState(key = "INT");
            setObjectVarFromUserState(key = "PSY");
            setObjectVarFromUserState(key = "Exp");
            setObjectVarFromUserState(key = "HP");
            updatePlayerAttributes(actorId = "instance");
            deltaHp(actorCode = "instance", type = "heal", value = 9999);
        }
    }
}
block loadStateNew {
    __repeat__ = -1;
    checks {
        forEachActor(actor = ActorMatch(controller = "player"), varname = "instance");
        checkNumber(lhs = "{instance.completedInit}", op = "==", rhs = 1);
        if(false) {
            checkString(str = "{{instance}_savedBefore}", matchKind = "equal", value = "1");
        }
        if((false == false)) {
            checkString(str = "{{instance}_savedBefore}", matchKind = "equal", value = "undefined");
        }
    }
    actions {
        setObjectVar(key = "completedInit", object = "instance", type = "string", value = 2);
        if(false) {
            setObjectVarFromUserState(key = "Point");
            setObjectVarFromUserState(key = "ExpNeeded");
            setObjectVarFromUserState(key = "Level");
            setObjectVarFromUserState(key = "STR");
            setObjectVarFromUserState(key = "CON");
            setObjectVarFromUserState(key = "AGI");
            setObjectVarFromUserState(key = "INT");
            setObjectVarFromUserState(key = "PSY");
            setObjectVarFromUserState(key = "Exp");
            setObjectVarFromUserState(key = "HP");
            updatePlayerAttributes(actorId = "instance");
            deltaHp(actorCode = "instance", type = "heal", value = 9999);
        }
    }
}
block clickIncreaseSTR {
    __repeat__ = -1;
    triggers {
        clickButton(varName = "instance", buttonId = ("increase" + "STR"));
    }
    checks {
        checkNumber(lhs = "{instance.Point}", op = ">", rhs = 0);
    }
    actions {
        setInstanceInt(key = "Point", value = "{instance.Point}-1");
        setInstanceInt(key = "STR", value = ("{instance." + ("STR" + "}+1")));
        actorTalk(actorId = "instance", text = ("成功提升一點" + ("力量" + "，尚餘{instance.Point}點能力點")));
        updatePlayerAttributes(actorId = "instance");
        saveUserState();
    }
}
block clickIncreaseCON {
    __repeat__ = -1;
    triggers {
        clickButton(varName = "instance", buttonId = ("increase" + "CON"));
    }
    checks {
        checkNumber(lhs = "{instance.Point}", op = ">", rhs = 0);
    }
    actions {
        setInstanceInt(key = "Point", value = "{instance.Point}-1");
        setInstanceInt(key = "CON", value = ("{instance." + ("CON" + "}+1")));
        actorTalk(actorId = "instance", text = ("成功提升一點" + ("體質" + "，尚餘{instance.Point}點能力點")));
        updatePlayerAttributes(actorId = "instance");
        saveUserState();
    }
}
block clickIncreaseAGI {
    __repeat__ = -1;
    triggers {
        clickButton(varName = "instance", buttonId = ("increase" + "AGI"));
    }
    checks {
        checkNumber(lhs = "{instance.Point}", op = ">", rhs = 0);
    }
    actions {
        setInstanceInt(key = "Point", value = "{instance.Point}-1");
        setInstanceInt(key = "AGI", value = ("{instance." + ("AGI" + "}+1")));
        actorTalk(actorId = "instance", text = ("成功提升一點" + ("敏捷" + "，尚餘{instance.Point}點能力點")));
        updatePlayerAttributes(actorId = "instance");
        saveUserState();
    }
}
block clickIncreaseINT {
    __repeat__ = -1;
    triggers {
        clickButton(varName = "instance", buttonId = ("increase" + "INT"));
    }
    checks {
        checkNumber(lhs = "{instance.Point}", op = ">", rhs = 0);
    }
    actions {
        setInstanceInt(key = "Point", value = "{instance.Point}-1");
        setInstanceInt(key = "INT", value = ("{instance." + ("INT" + "}+1")));
        actorTalk(actorId = "instance", text = ("成功提升一點" + ("智慧" + "，尚餘{instance.Point}點能力點")));
        updatePlayerAttributes(actorId = "instance");
        saveUserState();
    }
}
block clickIncreasePSY {
    __repeat__ = -1;
    triggers {
        clickButton(varName = "instance", buttonId = ("increase" + "PSY"));
    }
    checks {
        checkNumber(lhs = "{instance.Point}", op = ">", rhs = 0);
    }
    actions {
        setInstanceInt(key = "Point", value = "{instance.Point}-1");
        setInstanceInt(key = "PSY", value = ("{instance." + ("PSY" + "}+1")));
        actorTalk(actorId = "instance", text = ("成功提升一點" + ("精神" + "，尚餘{instance.Point}點能力點")));
        updatePlayerAttributes(actorId = "instance");
        saveUserState();
    }
}
block releasePowerWindStaff {
    __repeat__ = -1;
    triggers {
        releasePower(varName = "instance", weapon = "custom_wind_staff");
    }
    actions {
        if(("custom_wind_staff" == "custom_wind_staff")) {
            enblastEffect(fromActor = "instance", scale = "0.5", damage = WIND_STAFF_ENBLAST_DAMAGE, toAngle = (INSTANCE_ANGLE + 32));
            enblastEffect(fromActor = "instance", scale = "0.5", damage = WIND_STAFF_ENBLAST_DAMAGE, toAngle = (INSTANCE_ANGLE + 16));
            enblastEffect(fromActor = "instance", scale = "0.5", damage = WIND_STAFF_ENBLAST_DAMAGE, toAngle = INSTANCE_ANGLE);
            enblastEffect(fromActor = "instance", scale = "0.5", damage = WIND_STAFF_ENBLAST_DAMAGE, toAngle = (INSTANCE_ANGLE - 16));
            enblastEffect(fromActor = "instance", scale = "0.5", damage = WIND_STAFF_ENBLAST_DAMAGE, toAngle = (INSTANCE_ANGLE - 32));
        }
        if(("custom_wind_staff" == "custom_iron_sword")) {
            deltaHp(actorCode = "instance", value = "{instance.HP}/4");
        }
    }
}
block releasePowerIronSword {
    __repeat__ = -1;
    triggers {
        releasePower(varName = "instance", weapon = "custom_iron_sword");
    }
    actions {
        if(("custom_iron_sword" == "custom_wind_staff")) {
            enblastEffect(fromActor = "instance", scale = "0.5", damage = WIND_STAFF_ENBLAST_DAMAGE, toAngle = (INSTANCE_ANGLE + 32));
            enblastEffect(fromActor = "instance", scale = "0.5", damage = WIND_STAFF_ENBLAST_DAMAGE, toAngle = (INSTANCE_ANGLE + 16));
            enblastEffect(fromActor = "instance", scale = "0.5", damage = WIND_STAFF_ENBLAST_DAMAGE, toAngle = INSTANCE_ANGLE);
            enblastEffect(fromActor = "instance", scale = "0.5", damage = WIND_STAFF_ENBLAST_DAMAGE, toAngle = (INSTANCE_ANGLE - 16));
            enblastEffect(fromActor = "instance", scale = "0.5", damage = WIND_STAFF_ENBLAST_DAMAGE, toAngle = (INSTANCE_ANGLE - 32));
        }
        if(("custom_iron_sword" == "custom_iron_sword")) {
            deltaHp(actorCode = "instance", value = "{instance.HP}/4");
        }
    }
}
block clickResetPoint {
    __repeat__ = -1;
    triggers {
        clickButton(varName = "instance", buttonId = "ResetPoint");
    }
    actions {
        setInstanceInt(key = "Point", value = "{instance.Level}*2+3");
        setInstanceInt(key = "STR", value = 0);
        setInstanceInt(key = "CON", value = 0);
        setInstanceInt(key = "AGI", value = 0);
        setInstanceInt(key = "INT", value = 0);
        setInstanceInt(key = "PSY", value = 0);
        actorTalk(actorId = "instance", text = "成功重設能力點，目前有{instance.Point}點能力點");
        updatePlayerAttributes(actorId = "instance");
        saveUserState();
    }
}
block getExp {
    __repeat__ = -1;
    triggers {
        itemPickup(actorVarname = "instance", matchKind = "equal", itemVarname = "deer_exp");
    }
    actions {
        setInstanceInt(key = "Exp", value = ("{instance.Exp}" + 1));
        saveUserState();
    }
}
block monsterDead {
    __repeat__ = -1;
    triggers {
        actorDead(actor = ActorMatch(id = "monster"), varName = "instance");
    }
    actions {
        addDropItem(itemCode = "deer_exp", x = "({instance.gamePosition.x}-16)/32", y = "({instance.gamePosition.y}-16)/32", type = "sariraFire");
    }
}
block monsterSpawn {
    __repeat__ = -1;
    __repeatInterval__ = 8000;
    checks {
        actorCount(actor = ActorMatch(id = "monster_deer", matchKind = "contain"), op = "<", value = "5");
    }
    actions {
        addActor(name = "鹿(60)", id = "monster_deer*", camp = "第三", hp = 60, x = "random(21,40)", y = "random(0,19)", localVarname = "actor", weapon1 = "fist", weapon2 = "fist", strength = "10", role = "鹿");
        actorFollow(actorId = "actor", type = "跟隨自己");
    }
}
block levelUp {
    __repeat__ = -1;
    checks {
        forEachActor(actor = ActorMatch(controller = "玩家"), varname = "instance");
        checkNumber(lhs = "{instance.Exp}", op = ">=", rhs = "{instance.ExpNeeded}");
    }
    actions {
        setInstanceInt(key = "Exp", value = "{instance.Exp}-{instance.ExpNeeded}");
        setInstanceInt(key = "Level", value = ("{instance.Level}" + 1));
        setInstanceInt(key = "Point", value = ("{instance.Point}" + 2));
        setInstanceInt(key = "ExpNeeded", value = "{instance.Level}*2+4");
        setInstanceInt(key = "HP", value = HP_FORMULA);
        actorAttributes(actorId = "instance", attr = "maxHp", value = "{instance.HP}");
        saveUserState();
    }
}
block recover {
    __repeat__ = -1;
    __repeatInterval__ = 10000;
    checks {
        forEachActor(actor = ActorMatch(controller = "玩家"), varname = "instance");
    }
    actions {
        deltaHp(actorCode = "instance", value = RECOVERY_FORMULA);
    }
}
block pressZ {
    __repeat__ = -1;
    triggers {
        keyboardPressed(varName = "instance", key = "Z");
    }
    actions {
        actorTalk(actorId = "{instance.id}", text = STATUS_TEXT);
    }
}
block staffAttack {
    __repeat__ = -1;
    triggers {
        actorFire(weapon = "custom_wind_staff", varName = "instance");
    }
    actions {
        enblastEffect(fromActor = "instance", toAngle = INSTANCE_ANGLE, scale = "0.5", damage = WIND_STAFF_ENBLAST_DAMAGE);
    }
}
block swordAttack {
    __repeat__ = -1;
    triggers {
        actorHit(actor = ActorMatch(), actorVarName = "instance", hitter = ActorMatch(), hitterVarName = "attacker", weapon = "custom_iron_sword");
    }
    actions {
        deltaHp(actorCode = "instance", casterCode = "attacker", type = "流血受傷", value = "{attacker.STR}*3");
    }
}
block newPlayer {
    __repeat__ = -1;
    triggers {
        actorAdded(actor = ActorMatch(controller = "player"), varName = "instance");
    }
    actions {
        setInstanceInt(key = "STR", value = 0);
        setInstanceInt(key = "CON", value = 0);
        setInstanceInt(key = "AGI", value = 0);
        setInstanceInt(key = "INT", value = 0);
        setInstanceInt(key = "PSY", value = 0);
        setInstanceInt(key = "Level", value = 1);
        setInstanceInt(key = "Point", value = 5);
        setInstanceInt(key = "Exp", value = 0);
        setInstanceInt(key = "ExpNeeded", value = 6);
        setInstanceInt(key = "HP", value = 100);
        getUserState(category = USER_STATE_CATEGORY, key = "savedBefore", playerId = "{instance}", varName = "{instance}_savedBefore");
        setInstanceInt(key = "completedInit", value = 1);
    }
}
block init {
    actions {
        setWeaponAbility(weapon = "小刀", operation = "無技能", level = 1);
        setWeaponAbility(weapon = "小刀", operation = "無技能", level = 2);
        setWeaponAbility(weapon = "custom_wind_staff");
        setWeaponAbility(weapon = "custom_iron_sword");
        addStuff(x = 4, y = 8, item = "custom_wind_staff");
        addStuff(x = 4, y = 8, item = "custom_wind_staff");
        addStuff(x = 4, y = 8, item = "custom_wind_staff");
        addStuff(x = 4, y = 8, item = "custom_wind_staff");
        addStuff(x = 4, y = 8, item = "custom_wind_staff");
        addMapSign(x = 4, y = 7, rotation = 90, text = "【法杖】\n武器傷害：5\n - 攻擊附帶傷害為【10+智慧+精神/2】的光彈\n技能：釋出5發光彈", showButtons = false);
        addMapSign(x = 6, y = 7, rotation = 90, text = "【鐵劍】\n武器傷害：【30+力量*3】\n技能：恢復四分之一的血量", showButtons = false);
        biMapWarp(x1 = 19, y1 = 9, x2 = 21, y2 = 9);
        biMapWarp(x1 = 19, y1 = 10, x2 = 21, y2 = 10);
        addStuff(x = 6, y = 8, item = "custom_iron_sword");
        addStuff(x = 6, y = 8, item = "custom_iron_sword");
        addStuff(x = 6, y = 8, item = "custom_iron_sword");
        addStuff(x = 6, y = 8, item = "custom_iron_sword");
        addStuff(x = 6, y = 8, item = "custom_iron_sword");
        addMapSign(x = 3, y = 17, rotation = 270, text = "【力量】\n消耗一點能力點，提升劍類傷害", buttonCode = "increaseSTR", buttonLabel = "確認");
        addMapSign(x = 5, y = 17, rotation = 270, text = "【體質】\n消耗一點能力點，增加十點血量上限及半點恢復力", buttonCode = "increaseCON", buttonLabel = "確認");
        addMapSign(x = 7, y = 17, rotation = 270, text = "【敏捷】\n消耗一點能力點，重量減少3%，並提升武器攻擊速度", buttonCode = "increaseAGI", buttonLabel = "確認");
        addMapSign(x = 9, y = 17, rotation = 270, text = "【智慧】\n消耗一點能力點，提升杖類傷害", buttonCode = "increaseINT", buttonLabel = "確認");
        addMapSign(x = 11, y = 17, rotation = 270, text = "【精神】\n消耗一點能力點，小量提升杖類傷害及提升一點恢復力", buttonCode = "increasePSY", buttonLabel = "確認");
        addMapSign(x = 1, y = 15, rotation = 0, text = "【重置能力點分配】", buttonCode = "ResetPoint", buttonLabel = "確認");
    }
}
//-----------------------------------//
//--- AST After blockLegalization ---//
//-----------------------------------//
const INSTANCE_ANGLE = "{instance.bodyRotation}*180/3.14";
const WIND_STAFF_ENBLAST_DAMAGE = "{instance.INT} + {instance.PSY}/2 + 10";
const HP_FORMULA = "98 + 10*{instance.CON} + 2*{instance.Level}";
const RECOVERY_FORMULA = "1 + {instance.PSY} + {instance.CON}/2";
const STATUS_TEXT = ("【Lv{{instance.id}.Level}】\n" + ("Exp:{{instance.id}.Exp}/{{instance.id}.ExpNeeded}\n" + ("尚餘能力點：{{instance.id}.Point}\n" + ("力量：{{instance.id}.STR}\n" + ("體質：{{instance.id}.CON}\n" + ("敏捷：{{instance.id}.AGI}\n" + ("智慧：{{instance.id}.INT}\n" + "精神：{{instance.id}.PSY}")))))));
const SPAWN_POINT = Point(10,10);
const DEBUG_MODE = false;
const USER_STATE_CATEGORY = "simple-rpg-test";
__skydowLocs__ = SPAWN_POINT;
__royalLocs__ = SPAWN_POINT;
__thirdLocs__ = SPAWN_POINT;
__lives__ = 9999;
__title__ = "RPG試驗";
__useDefaultItems__ = true;
__useCustomWeapons__ = true;
__customWeapons__ = [CustomWeapon(reference = "TWilightGameEventCompiler.weapon_wind_staff", code = "wind_staff", damage = 5, fireType = "單手橫劈", pivotOnHandDegree = 58, pivotOnHandX = 2, pivotOnHandY = 9, pivotOnHandXScale = "1.3", pivotOnHandYScale = "1.5", pivotOnIconDegree = -40, pivotOnIconX = 20, pivotOnIconY = 20),CustomWeapon(reference = "TWilightGameEventCompiler.weapon_iron_sword", code = "iron_sword", damage = 30, fireType = "大刀砍劈", pivotOnHandDegree = 35, pivotOnHandX = -12, pivotOnIconDegree = -40, pivotOnIconX = 27, pivotOnIconY = 14)];
__map__ = "CG.TWilightGameEventCompiler/rpg/simple_rpg.twmap";
__roomSize__ = 8;
def debug(text) : actions {
    if(DEBUG_MODE) {
        print(type = "error", text = text);
    }
}
def setInstanceInt(key, value) : actions {
    setObjectVar(key = key, object = "instance", type = "integer", value = value);
}
def biMapWarp(x1, y1, x2, y2) : actions {
    if(((x1 == x2) && (y1 < y2))) {
        mapWarp(fromX = x1, fromY = y1, toX = x2, toY = y2, direction = "下");
        mapWarp(fromX = x2, fromY = y2, toX = x1, toY = y1, direction = "上");
    } else if(((x1 == x2) && (y1 > y2))) {
        mapWarp(fromX = x1, fromY = y1, toX = x2, toY = y2, direction = "上");
        mapWarp(fromX = x2, fromY = y2, toX = x1, toY = y1, direction = "下");
    } else if(((x1 > x2) && (y1 == y2))) {
        mapWarp(fromX = x1, fromY = y1, toX = x2, toY = y2, direction = "左");
        mapWarp(fromX = x2, fromY = y2, toX = x1, toY = y1, direction = "右");
    } else if(((x1 < x2) && (y1 == y2))) {
        mapWarp(fromX = x1, fromY = y1, toX = x2, toY = y2, direction = "右");
        mapWarp(fromX = x2, fromY = y2, toX = x1, toY = y1, direction = "左");
    } else if(((x1 == x2) && (y1 == y2))) {
        print(type = "error", text = "Cannot set the same point as the mapWarp src and dst");
    } else {
        print(type = "error", text = "Bidirectional mapWarp requires x or y to be the same value");
    }
}
def updatePlayerAttributes(actorId) : actions {
    setObjectVar(key = "HP", object = actorId, type = "integer", value = ("98 + 10*{" + (actorId + (".CON} + 2*{" + (actorId + ".Level}")))));
    actorAttributes(actorId = actorId, attr = "maxHp", value = ("{" + (actorId + ".HP}")));
    actorAttributes(actorId = actorId, attr = "closeWeaponSpeed", value = ("4-3/(1+0.05*{" + (actorId + ".AGI})")));
    actorAttributes(actorId = actorId, attr = "weight", value = ("3*pow(0.97,{" + (actorId + ".AGI})")));
}
def setObjectVarFromUserState(key) : actions {
    getUserState(category = USER_STATE_CATEGORY, key = key, playerId = "{instance}", varName = ("{instance}_" + key));
    setInstanceInt(key = key, value = ("{{instance}_" + (key + "}")));
}
def setUserStateFromObjectVar(key) : actions {
    setUserState(category = USER_STATE_CATEGORY, key = key, playerId = "{instance}", type = "string", value = ("{{instance}." + (key + "}")));
}
def loadStateDef(hasSavedBefore) : block {
    __repeat__ = -1;
    checks {
        forEachActor(actor = ActorMatch(controller = "player"), varname = "instance");
        checkNumber(lhs = "{instance.completedInit}", op = "==", rhs = 1);
        if(hasSavedBefore) {
            checkString(str = "{{instance}_savedBefore}", matchKind = "equal", value = "1");
        }
        if((hasSavedBefore == false)) {
            checkString(str = "{{instance}_savedBefore}", matchKind = "equal", value = "undefined");
        }
    }
    actions {
        setObjectVar(key = "completedInit", object = "instance", type = "string", value = 2);
        if(hasSavedBefore) {
            setObjectVarFromUserState(key = "Point");
            setObjectVarFromUserState(key = "ExpNeeded");
            setObjectVarFromUserState(key = "Level");
            setObjectVarFromUserState(key = "STR");
            setObjectVarFromUserState(key = "CON");
            setObjectVarFromUserState(key = "AGI");
            setObjectVarFromUserState(key = "INT");
            setObjectVarFromUserState(key = "PSY");
            setObjectVarFromUserState(key = "Exp");
            setObjectVarFromUserState(key = "HP");
            updatePlayerAttributes(actorId = "instance");
            deltaHp(actorCode = "instance", type = "heal", value = 9999);
        }
    }
}
def saveUserState() : actions {
    setUserStateFromObjectVar(key = "Point");
    setUserStateFromObjectVar(key = "ExpNeeded");
    setUserStateFromObjectVar(key = "Level");
    setUserStateFromObjectVar(key = "STR");
    setUserStateFromObjectVar(key = "CON");
    setUserStateFromObjectVar(key = "AGI");
    setUserStateFromObjectVar(key = "INT");
    setUserStateFromObjectVar(key = "PSY");
    setUserStateFromObjectVar(key = "Exp");
    setUserStateFromObjectVar(key = "HP");
    setUserState(category = USER_STATE_CATEGORY, key = "savedBefore", playerId = "{instance}", type = "integer", value = "1");
}
def clickIncreaseDef(type, typeZh) : block {
    __repeat__ = -1;
    triggers {
        clickButton(varName = "instance", buttonId = ("increase" + type));
    }
    checks {
        checkNumber(lhs = "{instance.Point}", op = ">", rhs = 0);
    }
    actions {
        setInstanceInt(key = "Point", value = "{instance.Point}-1");
        setInstanceInt(key = type, value = ("{instance." + (type + "}+1")));
        actorTalk(actorId = "instance", text = ("成功提升一點" + (typeZh + "，尚餘{instance.Point}點能力點")));
        updatePlayerAttributes(actorId = "instance");
        saveUserState();
    }
}
def releasePowerDef(weapon) : block {
    __repeat__ = -1;
    triggers {
        releasePower(varName = "instance", weapon = weapon);
    }
    actions {
        if((weapon == "custom_wind_staff")) {
            enblastEffect(fromActor = "instance", scale = "0.5", damage = WIND_STAFF_ENBLAST_DAMAGE, toAngle = (INSTANCE_ANGLE + 32));
            enblastEffect(fromActor = "instance", scale = "0.5", damage = WIND_STAFF_ENBLAST_DAMAGE, toAngle = (INSTANCE_ANGLE + 16));
            enblastEffect(fromActor = "instance", scale = "0.5", damage = WIND_STAFF_ENBLAST_DAMAGE, toAngle = INSTANCE_ANGLE);
            enblastEffect(fromActor = "instance", scale = "0.5", damage = WIND_STAFF_ENBLAST_DAMAGE, toAngle = (INSTANCE_ANGLE - 16));
            enblastEffect(fromActor = "instance", scale = "0.5", damage = WIND_STAFF_ENBLAST_DAMAGE, toAngle = (INSTANCE_ANGLE - 32));
        }
        if((weapon == "custom_iron_sword")) {
            deltaHp(actorCode = "instance", value = "{instance.HP}/4");
        }
    }
}
block loadStateSaved {
    __repeat__ = -1;
    checks {
        forEachActor(actor = ActorMatch(controller = "player"), varname = "instance");
        checkNumber(lhs = "{instance.completedInit}", op = "==", rhs = 1);
        if(true) {
            checkString(str = "{{instance}_savedBefore}", matchKind = "equal", value = "1");
        }
        if((true == false)) {
            checkString(str = "{{instance}_savedBefore}", matchKind = "equal", value = "undefined");
        }
    }
    actions {
        setObjectVar(key = "completedInit", object = "instance", type = "string", value = 2);
        if(true) {
            setObjectVarFromUserState(key = "Point");
            setObjectVarFromUserState(key = "ExpNeeded");
            setObjectVarFromUserState(key = "Level");
            setObjectVarFromUserState(key = "STR");
            setObjectVarFromUserState(key = "CON");
            setObjectVarFromUserState(key = "AGI");
            setObjectVarFromUserState(key = "INT");
            setObjectVarFromUserState(key = "PSY");
            setObjectVarFromUserState(key = "Exp");
            setObjectVarFromUserState(key = "HP");
            updatePlayerAttributes(actorId = "instance");
            deltaHp(actorCode = "instance", type = "heal", value = 9999);
        }
    }
    triggers {
    }
}
block loadStateNew {
    __repeat__ = -1;
    checks {
        forEachActor(actor = ActorMatch(controller = "player"), varname = "instance");
        checkNumber(lhs = "{instance.completedInit}", op = "==", rhs = 1);
        if(false) {
            checkString(str = "{{instance}_savedBefore}", matchKind = "equal", value = "1");
        }
        if((false == false)) {
            checkString(str = "{{instance}_savedBefore}", matchKind = "equal", value = "undefined");
        }
    }
    actions {
        setObjectVar(key = "completedInit", object = "instance", type = "string", value = 2);
        if(false) {
            setObjectVarFromUserState(key = "Point");
            setObjectVarFromUserState(key = "ExpNeeded");
            setObjectVarFromUserState(key = "Level");
            setObjectVarFromUserState(key = "STR");
            setObjectVarFromUserState(key = "CON");
            setObjectVarFromUserState(key = "AGI");
            setObjectVarFromUserState(key = "INT");
            setObjectVarFromUserState(key = "PSY");
            setObjectVarFromUserState(key = "Exp");
            setObjectVarFromUserState(key = "HP");
            updatePlayerAttributes(actorId = "instance");
            deltaHp(actorCode = "instance", type = "heal", value = 9999);
        }
    }
    triggers {
    }
}
block clickIncreaseSTR {
    __repeat__ = -1;
    triggers {
        clickButton(varName = "instance", buttonId = ("increase" + "STR"));
    }
    checks {
        checkNumber(lhs = "{instance.Point}", op = ">", rhs = 0);
    }
    actions {
        setInstanceInt(key = "Point", value = "{instance.Point}-1");
        setInstanceInt(key = "STR", value = ("{instance." + ("STR" + "}+1")));
        actorTalk(actorId = "instance", text = ("成功提升一點" + ("力量" + "，尚餘{instance.Point}點能力點")));
        updatePlayerAttributes(actorId = "instance");
        saveUserState();
    }
}
block clickIncreaseCON {
    __repeat__ = -1;
    triggers {
        clickButton(varName = "instance", buttonId = ("increase" + "CON"));
    }
    checks {
        checkNumber(lhs = "{instance.Point}", op = ">", rhs = 0);
    }
    actions {
        setInstanceInt(key = "Point", value = "{instance.Point}-1");
        setInstanceInt(key = "CON", value = ("{instance." + ("CON" + "}+1")));
        actorTalk(actorId = "instance", text = ("成功提升一點" + ("體質" + "，尚餘{instance.Point}點能力點")));
        updatePlayerAttributes(actorId = "instance");
        saveUserState();
    }
}
block clickIncreaseAGI {
    __repeat__ = -1;
    triggers {
        clickButton(varName = "instance", buttonId = ("increase" + "AGI"));
    }
    checks {
        checkNumber(lhs = "{instance.Point}", op = ">", rhs = 0);
    }
    actions {
        setInstanceInt(key = "Point", value = "{instance.Point}-1");
        setInstanceInt(key = "AGI", value = ("{instance." + ("AGI" + "}+1")));
        actorTalk(actorId = "instance", text = ("成功提升一點" + ("敏捷" + "，尚餘{instance.Point}點能力點")));
        updatePlayerAttributes(actorId = "instance");
        saveUserState();
    }
}
block clickIncreaseINT {
    __repeat__ = -1;
    triggers {
        clickButton(varName = "instance", buttonId = ("increase" + "INT"));
    }
    checks {
        checkNumber(lhs = "{instance.Point}", op = ">", rhs = 0);
    }
    actions {
        setInstanceInt(key = "Point", value = "{instance.Point}-1");
        setInstanceInt(key = "INT", value = ("{instance." + ("INT" + "}+1")));
        actorTalk(actorId = "instance", text = ("成功提升一點" + ("智慧" + "，尚餘{instance.Point}點能力點")));
        updatePlayerAttributes(actorId = "instance");
        saveUserState();
    }
}
block clickIncreasePSY {
    __repeat__ = -1;
    triggers {
        clickButton(varName = "instance", buttonId = ("increase" + "PSY"));
    }
    checks {
        checkNumber(lhs = "{instance.Point}", op = ">", rhs = 0);
    }
    actions {
        setInstanceInt(key = "Point", value = "{instance.Point}-1");
        setInstanceInt(key = "PSY", value = ("{instance." + ("PSY" + "}+1")));
        actorTalk(actorId = "instance", text = ("成功提升一點" + ("精神" + "，尚餘{instance.Point}點能力點")));
        updatePlayerAttributes(actorId = "instance");
        saveUserState();
    }
}
block releasePowerWindStaff {
    __repeat__ = -1;
    triggers {
        releasePower(varName = "instance", weapon = "custom_wind_staff");
    }
    actions {
        if(("custom_wind_staff" == "custom_wind_staff")) {
            enblastEffect(fromActor = "instance", scale = "0.5", damage = WIND_STAFF_ENBLAST_DAMAGE, toAngle = (INSTANCE_ANGLE + 32));
            enblastEffect(fromActor = "instance", scale = "0.5", damage = WIND_STAFF_ENBLAST_DAMAGE, toAngle = (INSTANCE_ANGLE + 16));
            enblastEffect(fromActor = "instance", scale = "0.5", damage = WIND_STAFF_ENBLAST_DAMAGE, toAngle = INSTANCE_ANGLE);
            enblastEffect(fromActor = "instance", scale = "0.5", damage = WIND_STAFF_ENBLAST_DAMAGE, toAngle = (INSTANCE_ANGLE - 16));
            enblastEffect(fromActor = "instance", scale = "0.5", damage = WIND_STAFF_ENBLAST_DAMAGE, toAngle = (INSTANCE_ANGLE - 32));
        }
        if(("custom_wind_staff" == "custom_iron_sword")) {
            deltaHp(actorCode = "instance", value = "{instance.HP}/4");
        }
    }
    checks {
    }
}
block releasePowerIronSword {
    __repeat__ = -1;
    triggers {
        releasePower(varName = "instance", weapon = "custom_iron_sword");
    }
    actions {
        if(("custom_iron_sword" == "custom_wind_staff")) {
            enblastEffect(fromActor = "instance", scale = "0.5", damage = WIND_STAFF_ENBLAST_DAMAGE, toAngle = (INSTANCE_ANGLE + 32));
            enblastEffect(fromActor = "instance", scale = "0.5", damage = WIND_STAFF_ENBLAST_DAMAGE, toAngle = (INSTANCE_ANGLE + 16));
            enblastEffect(fromActor = "instance", scale = "0.5", damage = WIND_STAFF_ENBLAST_DAMAGE, toAngle = INSTANCE_ANGLE);
            enblastEffect(fromActor = "instance", scale = "0.5", damage = WIND_STAFF_ENBLAST_DAMAGE, toAngle = (INSTANCE_ANGLE - 16));
            enblastEffect(fromActor = "instance", scale = "0.5", damage = WIND_STAFF_ENBLAST_DAMAGE, toAngle = (INSTANCE_ANGLE - 32));
        }
        if(("custom_iron_sword" == "custom_iron_sword")) {
            deltaHp(actorCode = "instance", value = "{instance.HP}/4");
        }
    }
    checks {
    }
}
block clickResetPoint {
    __repeat__ = -1;
    triggers {
        clickButton(varName = "instance", buttonId = "ResetPoint");
    }
    actions {
        setInstanceInt(key = "Point", value = "{instance.Level}*2+3");
        setInstanceInt(key = "STR", value = 0);
        setInstanceInt(key = "CON", value = 0);
        setInstanceInt(key = "AGI", value = 0);
        setInstanceInt(key = "INT", value = 0);
        setInstanceInt(key = "PSY", value = 0);
        actorTalk(actorId = "instance", text = "成功重設能力點，目前有{instance.Point}點能力點");
        updatePlayerAttributes(actorId = "instance");
        saveUserState();
    }
    checks {
    }
}
block getExp {
    __repeat__ = -1;
    triggers {
        itemPickup(actorVarname = "instance", matchKind = "equal", itemVarname = "deer_exp");
    }
    actions {
        setInstanceInt(key = "Exp", value = ("{instance.Exp}" + 1));
        saveUserState();
    }
    checks {
    }
}
block monsterDead {
    __repeat__ = -1;
    triggers {
        actorDead(actor = ActorMatch(id = "monster"), varName = "instance");
    }
    actions {
        addDropItem(itemCode = "deer_exp", x = "({instance.gamePosition.x}-16)/32", y = "({instance.gamePosition.y}-16)/32", type = "sariraFire");
    }
    checks {
    }
}
block monsterSpawn {
    __repeat__ = -1;
    __repeatInterval__ = 8000;
    checks {
        actorCount(actor = ActorMatch(id = "monster_deer", matchKind = "contain"), op = "<", value = "5");
    }
    actions {
        addActor(name = "鹿(60)", id = "monster_deer*", camp = "第三", hp = 60, x = "random(21,40)", y = "random(0,19)", localVarname = "actor", weapon1 = "fist", weapon2 = "fist", strength = "10", role = "鹿");
        actorFollow(actorId = "actor", type = "跟隨自己");
    }
    triggers {
    }
}
block levelUp {
    __repeat__ = -1;
    checks {
        forEachActor(actor = ActorMatch(controller = "玩家"), varname = "instance");
        checkNumber(lhs = "{instance.Exp}", op = ">=", rhs = "{instance.ExpNeeded}");
    }
    actions {
        setInstanceInt(key = "Exp", value = "{instance.Exp}-{instance.ExpNeeded}");
        setInstanceInt(key = "Level", value = ("{instance.Level}" + 1));
        setInstanceInt(key = "Point", value = ("{instance.Point}" + 2));
        setInstanceInt(key = "ExpNeeded", value = "{instance.Level}*2+4");
        setInstanceInt(key = "HP", value = HP_FORMULA);
        actorAttributes(actorId = "instance", attr = "maxHp", value = "{instance.HP}");
        saveUserState();
    }
    triggers {
    }
}
block recover {
    __repeat__ = -1;
    __repeatInterval__ = 10000;
    checks {
        forEachActor(actor = ActorMatch(controller = "玩家"), varname = "instance");
    }
    actions {
        deltaHp(actorCode = "instance", value = RECOVERY_FORMULA);
    }
    triggers {
    }
}
block pressZ {
    __repeat__ = -1;
    triggers {
        keyboardPressed(varName = "instance", key = "Z");
    }
    actions {
        actorTalk(actorId = "{instance.id}", text = STATUS_TEXT);
    }
    checks {
    }
}
block staffAttack {
    __repeat__ = -1;
    triggers {
        actorFire(weapon = "custom_wind_staff", varName = "instance");
    }
    actions {
        enblastEffect(fromActor = "instance", toAngle = INSTANCE_ANGLE, scale = "0.5", damage = WIND_STAFF_ENBLAST_DAMAGE);
    }
    checks {
    }
}
block swordAttack {
    __repeat__ = -1;
    triggers {
        actorHit(actor = ActorMatch(), actorVarName = "instance", hitter = ActorMatch(), hitterVarName = "attacker", weapon = "custom_iron_sword");
    }
    actions {
        deltaHp(actorCode = "instance", casterCode = "attacker", type = "流血受傷", value = "{attacker.STR}*3");
    }
    checks {
    }
}
block newPlayer {
    __repeat__ = -1;
    triggers {
        actorAdded(actor = ActorMatch(controller = "player"), varName = "instance");
    }
    actions {
        setInstanceInt(key = "STR", value = 0);
        setInstanceInt(key = "CON", value = 0);
        setInstanceInt(key = "AGI", value = 0);
        setInstanceInt(key = "INT", value = 0);
        setInstanceInt(key = "PSY", value = 0);
        setInstanceInt(key = "Level", value = 1);
        setInstanceInt(key = "Point", value = 5);
        setInstanceInt(key = "Exp", value = 0);
        setInstanceInt(key = "ExpNeeded", value = 6);
        setInstanceInt(key = "HP", value = 100);
        getUserState(category = USER_STATE_CATEGORY, key = "savedBefore", playerId = "{instance}", varName = "{instance}_savedBefore");
        setInstanceInt(key = "completedInit", value = 1);
    }
    checks {
    }
}
block init {
    actions {
        setWeaponAbility(weapon = "小刀", operation = "無技能", level = 1);
        setWeaponAbility(weapon = "小刀", operation = "無技能", level = 2);
        setWeaponAbility(weapon = "custom_wind_staff");
        setWeaponAbility(weapon = "custom_iron_sword");
        addStuff(x = 4, y = 8, item = "custom_wind_staff");
        addStuff(x = 4, y = 8, item = "custom_wind_staff");
        addStuff(x = 4, y = 8, item = "custom_wind_staff");
        addStuff(x = 4, y = 8, item = "custom_wind_staff");
        addStuff(x = 4, y = 8, item = "custom_wind_staff");
        addMapSign(x = 4, y = 7, rotation = 90, text = "【法杖】\n武器傷害：5\n - 攻擊附帶傷害為【10+智慧+精神/2】的光彈\n技能：釋出5發光彈", showButtons = false);
        addMapSign(x = 6, y = 7, rotation = 90, text = "【鐵劍】\n武器傷害：【30+力量*3】\n技能：恢復四分之一的血量", showButtons = false);
        biMapWarp(x1 = 19, y1 = 9, x2 = 21, y2 = 9);
        biMapWarp(x1 = 19, y1 = 10, x2 = 21, y2 = 10);
        addStuff(x = 6, y = 8, item = "custom_iron_sword");
        addStuff(x = 6, y = 8, item = "custom_iron_sword");
        addStuff(x = 6, y = 8, item = "custom_iron_sword");
        addStuff(x = 6, y = 8, item = "custom_iron_sword");
        addStuff(x = 6, y = 8, item = "custom_iron_sword");
        addMapSign(x = 3, y = 17, rotation = 270, text = "【力量】\n消耗一點能力點，提升劍類傷害", buttonCode = "increaseSTR", buttonLabel = "確認");
        addMapSign(x = 5, y = 17, rotation = 270, text = "【體質】\n消耗一點能力點，增加十點血量上限及半點恢復力", buttonCode = "increaseCON", buttonLabel = "確認");
        addMapSign(x = 7, y = 17, rotation = 270, text = "【敏捷】\n消耗一點能力點，重量減少3%，並提升武器攻擊速度", buttonCode = "increaseAGI", buttonLabel = "確認");
        addMapSign(x = 9, y = 17, rotation = 270, text = "【智慧】\n消耗一點能力點，提升杖類傷害", buttonCode = "increaseINT", buttonLabel = "確認");
        addMapSign(x = 11, y = 17, rotation = 270, text = "【精神】\n消耗一點能力點，小量提升杖類傷害及提升一點恢復力", buttonCode = "increasePSY", buttonLabel = "確認");
        addMapSign(x = 1, y = 15, rotation = 0, text = "【重置能力點分配】", buttonCode = "ResetPoint", buttonLabel = "確認");
    }
    checks {
    }
    triggers {
    }
}
//--------------------------------//
//--- AST After functionInling ---//
//--------------------------------//
const INSTANCE_ANGLE = "{instance.bodyRotation}*180/3.14";
const WIND_STAFF_ENBLAST_DAMAGE = "{instance.INT} + {instance.PSY}/2 + 10";
const HP_FORMULA = "98 + 10*{instance.CON} + 2*{instance.Level}";
const RECOVERY_FORMULA = "1 + {instance.PSY} + {instance.CON}/2";
const STATUS_TEXT = ("【Lv{{instance.id}.Level}】\n" + ("Exp:{{instance.id}.Exp}/{{instance.id}.ExpNeeded}\n" + ("尚餘能力點：{{instance.id}.Point}\n" + ("力量：{{instance.id}.STR}\n" + ("體質：{{instance.id}.CON}\n" + ("敏捷：{{instance.id}.AGI}\n" + ("智慧：{{instance.id}.INT}\n" + "精神：{{instance.id}.PSY}")))))));
const SPAWN_POINT = Point(10,10);
const DEBUG_MODE = false;
const USER_STATE_CATEGORY = "simple-rpg-test";
__skydowLocs__ = SPAWN_POINT;
__royalLocs__ = SPAWN_POINT;
__thirdLocs__ = SPAWN_POINT;
__lives__ = 9999;
__title__ = "RPG試驗";
__useDefaultItems__ = true;
__useCustomWeapons__ = true;
__customWeapons__ = [CustomWeapon(reference = "TWilightGameEventCompiler.weapon_wind_staff", code = "wind_staff", damage = 5, fireType = "單手橫劈", pivotOnHandDegree = 58, pivotOnHandX = 2, pivotOnHandY = 9, pivotOnHandXScale = "1.3", pivotOnHandYScale = "1.5", pivotOnIconDegree = -40, pivotOnIconX = 20, pivotOnIconY = 20),CustomWeapon(reference = "TWilightGameEventCompiler.weapon_iron_sword", code = "iron_sword", damage = 30, fireType = "大刀砍劈", pivotOnHandDegree = 35, pivotOnHandX = -12, pivotOnIconDegree = -40, pivotOnIconX = 27, pivotOnIconY = 14)];
__map__ = "CG.TWilightGameEventCompiler/rpg/simple_rpg.twmap";
__roomSize__ = 8;
block loadStateSaved {
    __repeat__ = -1;
    checks {
        forEachActor(actor = ActorMatch(controller = "player"), varname = "instance");
        checkNumber(lhs = "{instance.completedInit}", op = "==", rhs = 1);
        if(true) {
            checkString(str = "{{instance}_savedBefore}", matchKind = "equal", value = "1");
        }
        if((true == false)) {
            checkString(str = "{{instance}_savedBefore}", matchKind = "equal", value = "undefined");
        }
    }
    actions {
        setObjectVar(key = "completedInit", object = "instance", type = "string", value = 2);
        if(true) {
            getUserState(category = USER_STATE_CATEGORY, key = "Point", playerId = "{instance}", varName = ("{instance}_" + "Point"));
            setObjectVar(key = "Point", object = "instance", type = "integer", value = ("{{instance}_" + ("Point" + "}")));
            getUserState(category = USER_STATE_CATEGORY, key = "ExpNeeded", playerId = "{instance}", varName = ("{instance}_" + "ExpNeeded"));
            setObjectVar(key = "ExpNeeded", object = "instance", type = "integer", value = ("{{instance}_" + ("ExpNeeded" + "}")));
            getUserState(category = USER_STATE_CATEGORY, key = "Level", playerId = "{instance}", varName = ("{instance}_" + "Level"));
            setObjectVar(key = "Level", object = "instance", type = "integer", value = ("{{instance}_" + ("Level" + "}")));
            getUserState(category = USER_STATE_CATEGORY, key = "STR", playerId = "{instance}", varName = ("{instance}_" + "STR"));
            setObjectVar(key = "STR", object = "instance", type = "integer", value = ("{{instance}_" + ("STR" + "}")));
            getUserState(category = USER_STATE_CATEGORY, key = "CON", playerId = "{instance}", varName = ("{instance}_" + "CON"));
            setObjectVar(key = "CON", object = "instance", type = "integer", value = ("{{instance}_" + ("CON" + "}")));
            getUserState(category = USER_STATE_CATEGORY, key = "AGI", playerId = "{instance}", varName = ("{instance}_" + "AGI"));
            setObjectVar(key = "AGI", object = "instance", type = "integer", value = ("{{instance}_" + ("AGI" + "}")));
            getUserState(category = USER_STATE_CATEGORY, key = "INT", playerId = "{instance}", varName = ("{instance}_" + "INT"));
            setObjectVar(key = "INT", object = "instance", type = "integer", value = ("{{instance}_" + ("INT" + "}")));
            getUserState(category = USER_STATE_CATEGORY, key = "PSY", playerId = "{instance}", varName = ("{instance}_" + "PSY"));
            setObjectVar(key = "PSY", object = "instance", type = "integer", value = ("{{instance}_" + ("PSY" + "}")));
            getUserState(category = USER_STATE_CATEGORY, key = "Exp", playerId = "{instance}", varName = ("{instance}_" + "Exp"));
            setObjectVar(key = "Exp", object = "instance", type = "integer", value = ("{{instance}_" + ("Exp" + "}")));
            getUserState(category = USER_STATE_CATEGORY, key = "HP", playerId = "{instance}", varName = ("{instance}_" + "HP"));
            setObjectVar(key = "HP", object = "instance", type = "integer", value = ("{{instance}_" + ("HP" + "}")));
            setObjectVar(key = "HP", object = "instance", type = "integer", value = ("98 + 10*{" + ("instance" + (".CON} + 2*{" + ("instance" + ".Level}")))));
            actorAttributes(actorId = "instance", attr = "maxHp", value = ("{" + ("instance" + ".HP}")));
            actorAttributes(actorId = "instance", attr = "closeWeaponSpeed", value = ("4-3/(1+0.05*{" + ("instance" + ".AGI})")));
            actorAttributes(actorId = "instance", attr = "weight", value = ("3*pow(0.97,{" + ("instance" + ".AGI})")));
            deltaHp(actorCode = "instance", type = "heal", value = 9999);
        }
    }
    triggers {
    }
}
block loadStateNew {
    __repeat__ = -1;
    checks {
        forEachActor(actor = ActorMatch(controller = "player"), varname = "instance");
        checkNumber(lhs = "{instance.completedInit}", op = "==", rhs = 1);
        if(false) {
            checkString(str = "{{instance}_savedBefore}", matchKind = "equal", value = "1");
        }
        if((false == false)) {
            checkString(str = "{{instance}_savedBefore}", matchKind = "equal", value = "undefined");
        }
    }
    actions {
        setObjectVar(key = "completedInit", object = "instance", type = "string", value = 2);
        if(false) {
            getUserState(category = USER_STATE_CATEGORY, key = "Point", playerId = "{instance}", varName = ("{instance}_" + "Point"));
            setObjectVar(key = "Point", object = "instance", type = "integer", value = ("{{instance}_" + ("Point" + "}")));
            getUserState(category = USER_STATE_CATEGORY, key = "ExpNeeded", playerId = "{instance}", varName = ("{instance}_" + "ExpNeeded"));
            setObjectVar(key = "ExpNeeded", object = "instance", type = "integer", value = ("{{instance}_" + ("ExpNeeded" + "}")));
            getUserState(category = USER_STATE_CATEGORY, key = "Level", playerId = "{instance}", varName = ("{instance}_" + "Level"));
            setObjectVar(key = "Level", object = "instance", type = "integer", value = ("{{instance}_" + ("Level" + "}")));
            getUserState(category = USER_STATE_CATEGORY, key = "STR", playerId = "{instance}", varName = ("{instance}_" + "STR"));
            setObjectVar(key = "STR", object = "instance", type = "integer", value = ("{{instance}_" + ("STR" + "}")));
            getUserState(category = USER_STATE_CATEGORY, key = "CON", playerId = "{instance}", varName = ("{instance}_" + "CON"));
            setObjectVar(key = "CON", object = "instance", type = "integer", value = ("{{instance}_" + ("CON" + "}")));
            getUserState(category = USER_STATE_CATEGORY, key = "AGI", playerId = "{instance}", varName = ("{instance}_" + "AGI"));
            setObjectVar(key = "AGI", object = "instance", type = "integer", value = ("{{instance}_" + ("AGI" + "}")));
            getUserState(category = USER_STATE_CATEGORY, key = "INT", playerId = "{instance}", varName = ("{instance}_" + "INT"));
            setObjectVar(key = "INT", object = "instance", type = "integer", value = ("{{instance}_" + ("INT" + "}")));
            getUserState(category = USER_STATE_CATEGORY, key = "PSY", playerId = "{instance}", varName = ("{instance}_" + "PSY"));
            setObjectVar(key = "PSY", object = "instance", type = "integer", value = ("{{instance}_" + ("PSY" + "}")));
            getUserState(category = USER_STATE_CATEGORY, key = "Exp", playerId = "{instance}", varName = ("{instance}_" + "Exp"));
            setObjectVar(key = "Exp", object = "instance", type = "integer", value = ("{{instance}_" + ("Exp" + "}")));
            getUserState(category = USER_STATE_CATEGORY, key = "HP", playerId = "{instance}", varName = ("{instance}_" + "HP"));
            setObjectVar(key = "HP", object = "instance", type = "integer", value = ("{{instance}_" + ("HP" + "}")));
            setObjectVar(key = "HP", object = "instance", type = "integer", value = ("98 + 10*{" + ("instance" + (".CON} + 2*{" + ("instance" + ".Level}")))));
            actorAttributes(actorId = "instance", attr = "maxHp", value = ("{" + ("instance" + ".HP}")));
            actorAttributes(actorId = "instance", attr = "closeWeaponSpeed", value = ("4-3/(1+0.05*{" + ("instance" + ".AGI})")));
            actorAttributes(actorId = "instance", attr = "weight", value = ("3*pow(0.97,{" + ("instance" + ".AGI})")));
            deltaHp(actorCode = "instance", type = "heal", value = 9999);
        }
    }
    triggers {
    }
}
block clickIncreaseSTR {
    __repeat__ = -1;
    triggers {
        clickButton(varName = "instance", buttonId = ("increase" + "STR"));
    }
    checks {
        checkNumber(lhs = "{instance.Point}", op = ">", rhs = 0);
    }
    actions {
        setObjectVar(key = "Point", object = "instance", type = "integer", value = "{instance.Point}-1");
        setObjectVar(key = "STR", object = "instance", type = "integer", value = ("{instance." + ("STR" + "}+1")));
        actorTalk(actorId = "instance", text = ("成功提升一點" + ("力量" + "，尚餘{instance.Point}點能力點")));
        setObjectVar(key = "HP", object = "instance", type = "integer", value = ("98 + 10*{" + ("instance" + (".CON} + 2*{" + ("instance" + ".Level}")))));
        actorAttributes(actorId = "instance", attr = "maxHp", value = ("{" + ("instance" + ".HP}")));
        actorAttributes(actorId = "instance", attr = "closeWeaponSpeed", value = ("4-3/(1+0.05*{" + ("instance" + ".AGI})")));
        actorAttributes(actorId = "instance", attr = "weight", value = ("3*pow(0.97,{" + ("instance" + ".AGI})")));
        setUserState(category = USER_STATE_CATEGORY, key = "Point", playerId = "{instance}", type = "string", value = ("{{instance}." + ("Point" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "ExpNeeded", playerId = "{instance}", type = "string", value = ("{{instance}." + ("ExpNeeded" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "Level", playerId = "{instance}", type = "string", value = ("{{instance}." + ("Level" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "STR", playerId = "{instance}", type = "string", value = ("{{instance}." + ("STR" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "CON", playerId = "{instance}", type = "string", value = ("{{instance}." + ("CON" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "AGI", playerId = "{instance}", type = "string", value = ("{{instance}." + ("AGI" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "INT", playerId = "{instance}", type = "string", value = ("{{instance}." + ("INT" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "PSY", playerId = "{instance}", type = "string", value = ("{{instance}." + ("PSY" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "Exp", playerId = "{instance}", type = "string", value = ("{{instance}." + ("Exp" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "HP", playerId = "{instance}", type = "string", value = ("{{instance}." + ("HP" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "savedBefore", playerId = "{instance}", type = "integer", value = "1");
    }
}
block clickIncreaseCON {
    __repeat__ = -1;
    triggers {
        clickButton(varName = "instance", buttonId = ("increase" + "CON"));
    }
    checks {
        checkNumber(lhs = "{instance.Point}", op = ">", rhs = 0);
    }
    actions {
        setObjectVar(key = "Point", object = "instance", type = "integer", value = "{instance.Point}-1");
        setObjectVar(key = "CON", object = "instance", type = "integer", value = ("{instance." + ("CON" + "}+1")));
        actorTalk(actorId = "instance", text = ("成功提升一點" + ("體質" + "，尚餘{instance.Point}點能力點")));
        setObjectVar(key = "HP", object = "instance", type = "integer", value = ("98 + 10*{" + ("instance" + (".CON} + 2*{" + ("instance" + ".Level}")))));
        actorAttributes(actorId = "instance", attr = "maxHp", value = ("{" + ("instance" + ".HP}")));
        actorAttributes(actorId = "instance", attr = "closeWeaponSpeed", value = ("4-3/(1+0.05*{" + ("instance" + ".AGI})")));
        actorAttributes(actorId = "instance", attr = "weight", value = ("3*pow(0.97,{" + ("instance" + ".AGI})")));
        setUserState(category = USER_STATE_CATEGORY, key = "Point", playerId = "{instance}", type = "string", value = ("{{instance}." + ("Point" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "ExpNeeded", playerId = "{instance}", type = "string", value = ("{{instance}." + ("ExpNeeded" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "Level", playerId = "{instance}", type = "string", value = ("{{instance}." + ("Level" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "STR", playerId = "{instance}", type = "string", value = ("{{instance}." + ("STR" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "CON", playerId = "{instance}", type = "string", value = ("{{instance}." + ("CON" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "AGI", playerId = "{instance}", type = "string", value = ("{{instance}." + ("AGI" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "INT", playerId = "{instance}", type = "string", value = ("{{instance}." + ("INT" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "PSY", playerId = "{instance}", type = "string", value = ("{{instance}." + ("PSY" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "Exp", playerId = "{instance}", type = "string", value = ("{{instance}." + ("Exp" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "HP", playerId = "{instance}", type = "string", value = ("{{instance}." + ("HP" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "savedBefore", playerId = "{instance}", type = "integer", value = "1");
    }
}
block clickIncreaseAGI {
    __repeat__ = -1;
    triggers {
        clickButton(varName = "instance", buttonId = ("increase" + "AGI"));
    }
    checks {
        checkNumber(lhs = "{instance.Point}", op = ">", rhs = 0);
    }
    actions {
        setObjectVar(key = "Point", object = "instance", type = "integer", value = "{instance.Point}-1");
        setObjectVar(key = "AGI", object = "instance", type = "integer", value = ("{instance." + ("AGI" + "}+1")));
        actorTalk(actorId = "instance", text = ("成功提升一點" + ("敏捷" + "，尚餘{instance.Point}點能力點")));
        setObjectVar(key = "HP", object = "instance", type = "integer", value = ("98 + 10*{" + ("instance" + (".CON} + 2*{" + ("instance" + ".Level}")))));
        actorAttributes(actorId = "instance", attr = "maxHp", value = ("{" + ("instance" + ".HP}")));
        actorAttributes(actorId = "instance", attr = "closeWeaponSpeed", value = ("4-3/(1+0.05*{" + ("instance" + ".AGI})")));
        actorAttributes(actorId = "instance", attr = "weight", value = ("3*pow(0.97,{" + ("instance" + ".AGI})")));
        setUserState(category = USER_STATE_CATEGORY, key = "Point", playerId = "{instance}", type = "string", value = ("{{instance}." + ("Point" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "ExpNeeded", playerId = "{instance}", type = "string", value = ("{{instance}." + ("ExpNeeded" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "Level", playerId = "{instance}", type = "string", value = ("{{instance}." + ("Level" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "STR", playerId = "{instance}", type = "string", value = ("{{instance}." + ("STR" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "CON", playerId = "{instance}", type = "string", value = ("{{instance}." + ("CON" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "AGI", playerId = "{instance}", type = "string", value = ("{{instance}." + ("AGI" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "INT", playerId = "{instance}", type = "string", value = ("{{instance}." + ("INT" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "PSY", playerId = "{instance}", type = "string", value = ("{{instance}." + ("PSY" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "Exp", playerId = "{instance}", type = "string", value = ("{{instance}." + ("Exp" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "HP", playerId = "{instance}", type = "string", value = ("{{instance}." + ("HP" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "savedBefore", playerId = "{instance}", type = "integer", value = "1");
    }
}
block clickIncreaseINT {
    __repeat__ = -1;
    triggers {
        clickButton(varName = "instance", buttonId = ("increase" + "INT"));
    }
    checks {
        checkNumber(lhs = "{instance.Point}", op = ">", rhs = 0);
    }
    actions {
        setObjectVar(key = "Point", object = "instance", type = "integer", value = "{instance.Point}-1");
        setObjectVar(key = "INT", object = "instance", type = "integer", value = ("{instance." + ("INT" + "}+1")));
        actorTalk(actorId = "instance", text = ("成功提升一點" + ("智慧" + "，尚餘{instance.Point}點能力點")));
        setObjectVar(key = "HP", object = "instance", type = "integer", value = ("98 + 10*{" + ("instance" + (".CON} + 2*{" + ("instance" + ".Level}")))));
        actorAttributes(actorId = "instance", attr = "maxHp", value = ("{" + ("instance" + ".HP}")));
        actorAttributes(actorId = "instance", attr = "closeWeaponSpeed", value = ("4-3/(1+0.05*{" + ("instance" + ".AGI})")));
        actorAttributes(actorId = "instance", attr = "weight", value = ("3*pow(0.97,{" + ("instance" + ".AGI})")));
        setUserState(category = USER_STATE_CATEGORY, key = "Point", playerId = "{instance}", type = "string", value = ("{{instance}." + ("Point" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "ExpNeeded", playerId = "{instance}", type = "string", value = ("{{instance}." + ("ExpNeeded" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "Level", playerId = "{instance}", type = "string", value = ("{{instance}." + ("Level" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "STR", playerId = "{instance}", type = "string", value = ("{{instance}." + ("STR" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "CON", playerId = "{instance}", type = "string", value = ("{{instance}." + ("CON" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "AGI", playerId = "{instance}", type = "string", value = ("{{instance}." + ("AGI" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "INT", playerId = "{instance}", type = "string", value = ("{{instance}." + ("INT" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "PSY", playerId = "{instance}", type = "string", value = ("{{instance}." + ("PSY" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "Exp", playerId = "{instance}", type = "string", value = ("{{instance}." + ("Exp" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "HP", playerId = "{instance}", type = "string", value = ("{{instance}." + ("HP" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "savedBefore", playerId = "{instance}", type = "integer", value = "1");
    }
}
block clickIncreasePSY {
    __repeat__ = -1;
    triggers {
        clickButton(varName = "instance", buttonId = ("increase" + "PSY"));
    }
    checks {
        checkNumber(lhs = "{instance.Point}", op = ">", rhs = 0);
    }
    actions {
        setObjectVar(key = "Point", object = "instance", type = "integer", value = "{instance.Point}-1");
        setObjectVar(key = "PSY", object = "instance", type = "integer", value = ("{instance." + ("PSY" + "}+1")));
        actorTalk(actorId = "instance", text = ("成功提升一點" + ("精神" + "，尚餘{instance.Point}點能力點")));
        setObjectVar(key = "HP", object = "instance", type = "integer", value = ("98 + 10*{" + ("instance" + (".CON} + 2*{" + ("instance" + ".Level}")))));
        actorAttributes(actorId = "instance", attr = "maxHp", value = ("{" + ("instance" + ".HP}")));
        actorAttributes(actorId = "instance", attr = "closeWeaponSpeed", value = ("4-3/(1+0.05*{" + ("instance" + ".AGI})")));
        actorAttributes(actorId = "instance", attr = "weight", value = ("3*pow(0.97,{" + ("instance" + ".AGI})")));
        setUserState(category = USER_STATE_CATEGORY, key = "Point", playerId = "{instance}", type = "string", value = ("{{instance}." + ("Point" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "ExpNeeded", playerId = "{instance}", type = "string", value = ("{{instance}." + ("ExpNeeded" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "Level", playerId = "{instance}", type = "string", value = ("{{instance}." + ("Level" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "STR", playerId = "{instance}", type = "string", value = ("{{instance}." + ("STR" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "CON", playerId = "{instance}", type = "string", value = ("{{instance}." + ("CON" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "AGI", playerId = "{instance}", type = "string", value = ("{{instance}." + ("AGI" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "INT", playerId = "{instance}", type = "string", value = ("{{instance}." + ("INT" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "PSY", playerId = "{instance}", type = "string", value = ("{{instance}." + ("PSY" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "Exp", playerId = "{instance}", type = "string", value = ("{{instance}." + ("Exp" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "HP", playerId = "{instance}", type = "string", value = ("{{instance}." + ("HP" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "savedBefore", playerId = "{instance}", type = "integer", value = "1");
    }
}
block releasePowerWindStaff {
    __repeat__ = -1;
    triggers {
        releasePower(varName = "instance", weapon = "custom_wind_staff");
    }
    actions {
        if(("custom_wind_staff" == "custom_wind_staff")) {
            enblastEffect(fromActor = "instance", scale = "0.5", damage = WIND_STAFF_ENBLAST_DAMAGE, toAngle = (INSTANCE_ANGLE + 32));
            enblastEffect(fromActor = "instance", scale = "0.5", damage = WIND_STAFF_ENBLAST_DAMAGE, toAngle = (INSTANCE_ANGLE + 16));
            enblastEffect(fromActor = "instance", scale = "0.5", damage = WIND_STAFF_ENBLAST_DAMAGE, toAngle = INSTANCE_ANGLE);
            enblastEffect(fromActor = "instance", scale = "0.5", damage = WIND_STAFF_ENBLAST_DAMAGE, toAngle = (INSTANCE_ANGLE - 16));
            enblastEffect(fromActor = "instance", scale = "0.5", damage = WIND_STAFF_ENBLAST_DAMAGE, toAngle = (INSTANCE_ANGLE - 32));
        }
        if(("custom_wind_staff" == "custom_iron_sword")) {
            deltaHp(actorCode = "instance", value = "{instance.HP}/4");
        }
    }
    checks {
    }
}
block releasePowerIronSword {
    __repeat__ = -1;
    triggers {
        releasePower(varName = "instance", weapon = "custom_iron_sword");
    }
    actions {
        if(("custom_iron_sword" == "custom_wind_staff")) {
            enblastEffect(fromActor = "instance", scale = "0.5", damage = WIND_STAFF_ENBLAST_DAMAGE, toAngle = (INSTANCE_ANGLE + 32));
            enblastEffect(fromActor = "instance", scale = "0.5", damage = WIND_STAFF_ENBLAST_DAMAGE, toAngle = (INSTANCE_ANGLE + 16));
            enblastEffect(fromActor = "instance", scale = "0.5", damage = WIND_STAFF_ENBLAST_DAMAGE, toAngle = INSTANCE_ANGLE);
            enblastEffect(fromActor = "instance", scale = "0.5", damage = WIND_STAFF_ENBLAST_DAMAGE, toAngle = (INSTANCE_ANGLE - 16));
            enblastEffect(fromActor = "instance", scale = "0.5", damage = WIND_STAFF_ENBLAST_DAMAGE, toAngle = (INSTANCE_ANGLE - 32));
        }
        if(("custom_iron_sword" == "custom_iron_sword")) {
            deltaHp(actorCode = "instance", value = "{instance.HP}/4");
        }
    }
    checks {
    }
}
block clickResetPoint {
    __repeat__ = -1;
    triggers {
        clickButton(varName = "instance", buttonId = "ResetPoint");
    }
    actions {
        setObjectVar(key = "Point", object = "instance", type = "integer", value = "{instance.Level}*2+3");
        setObjectVar(key = "STR", object = "instance", type = "integer", value = 0);
        setObjectVar(key = "CON", object = "instance", type = "integer", value = 0);
        setObjectVar(key = "AGI", object = "instance", type = "integer", value = 0);
        setObjectVar(key = "INT", object = "instance", type = "integer", value = 0);
        setObjectVar(key = "PSY", object = "instance", type = "integer", value = 0);
        actorTalk(actorId = "instance", text = "成功重設能力點，目前有{instance.Point}點能力點");
        setObjectVar(key = "HP", object = "instance", type = "integer", value = ("98 + 10*{" + ("instance" + (".CON} + 2*{" + ("instance" + ".Level}")))));
        actorAttributes(actorId = "instance", attr = "maxHp", value = ("{" + ("instance" + ".HP}")));
        actorAttributes(actorId = "instance", attr = "closeWeaponSpeed", value = ("4-3/(1+0.05*{" + ("instance" + ".AGI})")));
        actorAttributes(actorId = "instance", attr = "weight", value = ("3*pow(0.97,{" + ("instance" + ".AGI})")));
        setUserState(category = USER_STATE_CATEGORY, key = "Point", playerId = "{instance}", type = "string", value = ("{{instance}." + ("Point" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "ExpNeeded", playerId = "{instance}", type = "string", value = ("{{instance}." + ("ExpNeeded" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "Level", playerId = "{instance}", type = "string", value = ("{{instance}." + ("Level" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "STR", playerId = "{instance}", type = "string", value = ("{{instance}." + ("STR" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "CON", playerId = "{instance}", type = "string", value = ("{{instance}." + ("CON" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "AGI", playerId = "{instance}", type = "string", value = ("{{instance}." + ("AGI" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "INT", playerId = "{instance}", type = "string", value = ("{{instance}." + ("INT" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "PSY", playerId = "{instance}", type = "string", value = ("{{instance}." + ("PSY" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "Exp", playerId = "{instance}", type = "string", value = ("{{instance}." + ("Exp" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "HP", playerId = "{instance}", type = "string", value = ("{{instance}." + ("HP" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "savedBefore", playerId = "{instance}", type = "integer", value = "1");
    }
    checks {
    }
}
block getExp {
    __repeat__ = -1;
    triggers {
        itemPickup(actorVarname = "instance", matchKind = "equal", itemVarname = "deer_exp");
    }
    actions {
        setObjectVar(key = "Exp", object = "instance", type = "integer", value = ("{instance.Exp}" + 1));
        setUserState(category = USER_STATE_CATEGORY, key = "Point", playerId = "{instance}", type = "string", value = ("{{instance}." + ("Point" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "ExpNeeded", playerId = "{instance}", type = "string", value = ("{{instance}." + ("ExpNeeded" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "Level", playerId = "{instance}", type = "string", value = ("{{instance}." + ("Level" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "STR", playerId = "{instance}", type = "string", value = ("{{instance}." + ("STR" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "CON", playerId = "{instance}", type = "string", value = ("{{instance}." + ("CON" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "AGI", playerId = "{instance}", type = "string", value = ("{{instance}." + ("AGI" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "INT", playerId = "{instance}", type = "string", value = ("{{instance}." + ("INT" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "PSY", playerId = "{instance}", type = "string", value = ("{{instance}." + ("PSY" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "Exp", playerId = "{instance}", type = "string", value = ("{{instance}." + ("Exp" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "HP", playerId = "{instance}", type = "string", value = ("{{instance}." + ("HP" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "savedBefore", playerId = "{instance}", type = "integer", value = "1");
    }
    checks {
    }
}
block monsterDead {
    __repeat__ = -1;
    triggers {
        actorDead(actor = ActorMatch(id = "monster"), varName = "instance");
    }
    actions {
        addDropItem(itemCode = "deer_exp", x = "({instance.gamePosition.x}-16)/32", y = "({instance.gamePosition.y}-16)/32", type = "sariraFire");
    }
    checks {
    }
}
block monsterSpawn {
    __repeat__ = -1;
    __repeatInterval__ = 8000;
    checks {
        actorCount(actor = ActorMatch(id = "monster_deer", matchKind = "contain"), op = "<", value = "5");
    }
    actions {
        addActor(name = "鹿(60)", id = "monster_deer*", camp = "第三", hp = 60, x = "random(21,40)", y = "random(0,19)", localVarname = "actor", weapon1 = "fist", weapon2 = "fist", strength = "10", role = "鹿");
        actorFollow(actorId = "actor", type = "跟隨自己");
    }
    triggers {
    }
}
block levelUp {
    __repeat__ = -1;
    checks {
        forEachActor(actor = ActorMatch(controller = "玩家"), varname = "instance");
        checkNumber(lhs = "{instance.Exp}", op = ">=", rhs = "{instance.ExpNeeded}");
    }
    actions {
        setObjectVar(key = "Exp", object = "instance", type = "integer", value = "{instance.Exp}-{instance.ExpNeeded}");
        setObjectVar(key = "Level", object = "instance", type = "integer", value = ("{instance.Level}" + 1));
        setObjectVar(key = "Point", object = "instance", type = "integer", value = ("{instance.Point}" + 2));
        setObjectVar(key = "ExpNeeded", object = "instance", type = "integer", value = "{instance.Level}*2+4");
        setObjectVar(key = "HP", object = "instance", type = "integer", value = HP_FORMULA);
        actorAttributes(actorId = "instance", attr = "maxHp", value = "{instance.HP}");
        setUserState(category = USER_STATE_CATEGORY, key = "Point", playerId = "{instance}", type = "string", value = ("{{instance}." + ("Point" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "ExpNeeded", playerId = "{instance}", type = "string", value = ("{{instance}." + ("ExpNeeded" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "Level", playerId = "{instance}", type = "string", value = ("{{instance}." + ("Level" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "STR", playerId = "{instance}", type = "string", value = ("{{instance}." + ("STR" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "CON", playerId = "{instance}", type = "string", value = ("{{instance}." + ("CON" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "AGI", playerId = "{instance}", type = "string", value = ("{{instance}." + ("AGI" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "INT", playerId = "{instance}", type = "string", value = ("{{instance}." + ("INT" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "PSY", playerId = "{instance}", type = "string", value = ("{{instance}." + ("PSY" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "Exp", playerId = "{instance}", type = "string", value = ("{{instance}." + ("Exp" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "HP", playerId = "{instance}", type = "string", value = ("{{instance}." + ("HP" + "}")));
        setUserState(category = USER_STATE_CATEGORY, key = "savedBefore", playerId = "{instance}", type = "integer", value = "1");
    }
    triggers {
    }
}
block recover {
    __repeat__ = -1;
    __repeatInterval__ = 10000;
    checks {
        forEachActor(actor = ActorMatch(controller = "玩家"), varname = "instance");
    }
    actions {
        deltaHp(actorCode = "instance", value = RECOVERY_FORMULA);
    }
    triggers {
    }
}
block pressZ {
    __repeat__ = -1;
    triggers {
        keyboardPressed(varName = "instance", key = "Z");
    }
    actions {
        actorTalk(actorId = "{instance.id}", text = STATUS_TEXT);
    }
    checks {
    }
}
block staffAttack {
    __repeat__ = -1;
    triggers {
        actorFire(weapon = "custom_wind_staff", varName = "instance");
    }
    actions {
        enblastEffect(fromActor = "instance", toAngle = INSTANCE_ANGLE, scale = "0.5", damage = WIND_STAFF_ENBLAST_DAMAGE);
    }
    checks {
    }
}
block swordAttack {
    __repeat__ = -1;
    triggers {
        actorHit(actor = ActorMatch(), actorVarName = "instance", hitter = ActorMatch(), hitterVarName = "attacker", weapon = "custom_iron_sword");
    }
    actions {
        deltaHp(actorCode = "instance", casterCode = "attacker", type = "流血受傷", value = "{attacker.STR}*3");
    }
    checks {
    }
}
block newPlayer {
    __repeat__ = -1;
    triggers {
        actorAdded(actor = ActorMatch(controller = "player"), varName = "instance");
    }
    actions {
        setObjectVar(key = "STR", object = "instance", type = "integer", value = 0);
        setObjectVar(key = "CON", object = "instance", type = "integer", value = 0);
        setObjectVar(key = "AGI", object = "instance", type = "integer", value = 0);
        setObjectVar(key = "INT", object = "instance", type = "integer", value = 0);
        setObjectVar(key = "PSY", object = "instance", type = "integer", value = 0);
        setObjectVar(key = "Level", object = "instance", type = "integer", value = 1);
        setObjectVar(key = "Point", object = "instance", type = "integer", value = 5);
        setObjectVar(key = "Exp", object = "instance", type = "integer", value = 0);
        setObjectVar(key = "ExpNeeded", object = "instance", type = "integer", value = 6);
        setObjectVar(key = "HP", object = "instance", type = "integer", value = 100);
        getUserState(category = USER_STATE_CATEGORY, key = "savedBefore", playerId = "{instance}", varName = "{instance}_savedBefore");
        setObjectVar(key = "completedInit", object = "instance", type = "integer", value = 1);
    }
    checks {
    }
}
block init {
    actions {
        setWeaponAbility(weapon = "小刀", operation = "無技能", level = 1);
        setWeaponAbility(weapon = "小刀", operation = "無技能", level = 2);
        setWeaponAbility(weapon = "custom_wind_staff");
        setWeaponAbility(weapon = "custom_iron_sword");
        addStuff(x = 4, y = 8, item = "custom_wind_staff");
        addStuff(x = 4, y = 8, item = "custom_wind_staff");
        addStuff(x = 4, y = 8, item = "custom_wind_staff");
        addStuff(x = 4, y = 8, item = "custom_wind_staff");
        addStuff(x = 4, y = 8, item = "custom_wind_staff");
        addMapSign(x = 4, y = 7, rotation = 90, text = "【法杖】\n武器傷害：5\n - 攻擊附帶傷害為【10+智慧+精神/2】的光彈\n技能：釋出5發光彈", showButtons = false);
        addMapSign(x = 6, y = 7, rotation = 90, text = "【鐵劍】\n武器傷害：【30+力量*3】\n技能：恢復四分之一的血量", showButtons = false);
        if(((19 == 21) && (9 < 9))) {
            mapWarp(fromX = 19, fromY = 9, toX = 21, toY = 9, direction = "下");
            mapWarp(fromX = 21, fromY = 9, toX = 19, toY = 9, direction = "上");
        } else if(((19 == 21) && (9 > 9))) {
            mapWarp(fromX = 19, fromY = 9, toX = 21, toY = 9, direction = "上");
            mapWarp(fromX = 21, fromY = 9, toX = 19, toY = 9, direction = "下");
        } else if(((19 > 21) && (9 == 9))) {
            mapWarp(fromX = 19, fromY = 9, toX = 21, toY = 9, direction = "左");
            mapWarp(fromX = 21, fromY = 9, toX = 19, toY = 9, direction = "右");
        } else if(((19 < 21) && (9 == 9))) {
            mapWarp(fromX = 19, fromY = 9, toX = 21, toY = 9, direction = "右");
            mapWarp(fromX = 21, fromY = 9, toX = 19, toY = 9, direction = "左");
        } else if(((19 == 21) && (9 == 9))) {
            print(type = "error", text = "Cannot set the same point as the mapWarp src and dst");
        } else {
            print(type = "error", text = "Bidirectional mapWarp requires x or y to be the same value");
        }
        if(((19 == 21) && (10 < 10))) {
            mapWarp(fromX = 19, fromY = 10, toX = 21, toY = 10, direction = "下");
            mapWarp(fromX = 21, fromY = 10, toX = 19, toY = 10, direction = "上");
        } else if(((19 == 21) && (10 > 10))) {
            mapWarp(fromX = 19, fromY = 10, toX = 21, toY = 10, direction = "上");
            mapWarp(fromX = 21, fromY = 10, toX = 19, toY = 10, direction = "下");
        } else if(((19 > 21) && (10 == 10))) {
            mapWarp(fromX = 19, fromY = 10, toX = 21, toY = 10, direction = "左");
            mapWarp(fromX = 21, fromY = 10, toX = 19, toY = 10, direction = "右");
        } else if(((19 < 21) && (10 == 10))) {
            mapWarp(fromX = 19, fromY = 10, toX = 21, toY = 10, direction = "右");
            mapWarp(fromX = 21, fromY = 10, toX = 19, toY = 10, direction = "左");
        } else if(((19 == 21) && (10 == 10))) {
            print(type = "error", text = "Cannot set the same point as the mapWarp src and dst");
        } else {
            print(type = "error", text = "Bidirectional mapWarp requires x or y to be the same value");
        }
        addStuff(x = 6, y = 8, item = "custom_iron_sword");
        addStuff(x = 6, y = 8, item = "custom_iron_sword");
        addStuff(x = 6, y = 8, item = "custom_iron_sword");
        addStuff(x = 6, y = 8, item = "custom_iron_sword");
        addStuff(x = 6, y = 8, item = "custom_iron_sword");
        addMapSign(x = 3, y = 17, rotation = 270, text = "【力量】\n消耗一點能力點，提升劍類傷害", buttonCode = "increaseSTR", buttonLabel = "確認");
        addMapSign(x = 5, y = 17, rotation = 270, text = "【體質】\n消耗一點能力點，增加十點血量上限及半點恢復力", buttonCode = "increaseCON", buttonLabel = "確認");
        addMapSign(x = 7, y = 17, rotation = 270, text = "【敏捷】\n消耗一點能力點，重量減少3%，並提升武器攻擊速度", buttonCode = "increaseAGI", buttonLabel = "確認");
        addMapSign(x = 9, y = 17, rotation = 270, text = "【智慧】\n消耗一點能力點，提升杖類傷害", buttonCode = "increaseINT", buttonLabel = "確認");
        addMapSign(x = 11, y = 17, rotation = 270, text = "【精神】\n消耗一點能力點，小量提升杖類傷害及提升一點恢復力", buttonCode = "increasePSY", buttonLabel = "確認");
        addMapSign(x = 1, y = 15, rotation = 0, text = "【重置能力點分配】", buttonCode = "ResetPoint", buttonLabel = "確認");
    }
    checks {
    }
    triggers {
    }
}
//---------------------------------//
//--- AST After constantFolding ---//
//---------------------------------//
__skydowLocs__ = Point(10,10);
__royalLocs__ = Point(10,10);
__thirdLocs__ = Point(10,10);
__lives__ = 9999;
__title__ = "RPG試驗";
__useDefaultItems__ = true;
__useCustomWeapons__ = true;
__customWeapons__ = [CustomWeapon(reference = "TWilightGameEventCompiler.weapon_wind_staff", code = "wind_staff", damage = 5, fireType = "單手橫劈", pivotOnHandDegree = 58, pivotOnHandX = 2, pivotOnHandY = 9, pivotOnHandXScale = "1.3", pivotOnHandYScale = "1.5", pivotOnIconDegree = -40, pivotOnIconX = 20, pivotOnIconY = 20),CustomWeapon(reference = "TWilightGameEventCompiler.weapon_iron_sword", code = "iron_sword", damage = 30, fireType = "大刀砍劈", pivotOnHandDegree = 35, pivotOnHandX = -12, pivotOnIconDegree = -40, pivotOnIconX = 27, pivotOnIconY = 14)];
__map__ = "CG.TWilightGameEventCompiler/rpg/simple_rpg.twmap";
__roomSize__ = 8;
block loadStateSaved {
    __repeat__ = -1;
    checks {
        forEachActor(actor = ActorMatch(controller = "player"), varname = "instance");
        checkNumber(lhs = "{instance.completedInit}", op = "==", rhs = 1);
        if(true) {
            checkString(str = "{{instance}_savedBefore}", matchKind = "equal", value = "1");
        }
        if(false) {
            checkString(str = "{{instance}_savedBefore}", matchKind = "equal", value = "undefined");
        }
    }
    actions {
        setObjectVar(key = "completedInit", object = "instance", type = "string", value = 2);
        if(true) {
            getUserState(category = "simple-rpg-test", key = "Point", playerId = "{instance}", varName = "{instance}_Point");
            setObjectVar(key = "Point", object = "instance", type = "integer", value = "{{instance}_Point}");
            getUserState(category = "simple-rpg-test", key = "ExpNeeded", playerId = "{instance}", varName = "{instance}_ExpNeeded");
            setObjectVar(key = "ExpNeeded", object = "instance", type = "integer", value = "{{instance}_ExpNeeded}");
            getUserState(category = "simple-rpg-test", key = "Level", playerId = "{instance}", varName = "{instance}_Level");
            setObjectVar(key = "Level", object = "instance", type = "integer", value = "{{instance}_Level}");
            getUserState(category = "simple-rpg-test", key = "STR", playerId = "{instance}", varName = "{instance}_STR");
            setObjectVar(key = "STR", object = "instance", type = "integer", value = "{{instance}_STR}");
            getUserState(category = "simple-rpg-test", key = "CON", playerId = "{instance}", varName = "{instance}_CON");
            setObjectVar(key = "CON", object = "instance", type = "integer", value = "{{instance}_CON}");
            getUserState(category = "simple-rpg-test", key = "AGI", playerId = "{instance}", varName = "{instance}_AGI");
            setObjectVar(key = "AGI", object = "instance", type = "integer", value = "{{instance}_AGI}");
            getUserState(category = "simple-rpg-test", key = "INT", playerId = "{instance}", varName = "{instance}_INT");
            setObjectVar(key = "INT", object = "instance", type = "integer", value = "{{instance}_INT}");
            getUserState(category = "simple-rpg-test", key = "PSY", playerId = "{instance}", varName = "{instance}_PSY");
            setObjectVar(key = "PSY", object = "instance", type = "integer", value = "{{instance}_PSY}");
            getUserState(category = "simple-rpg-test", key = "Exp", playerId = "{instance}", varName = "{instance}_Exp");
            setObjectVar(key = "Exp", object = "instance", type = "integer", value = "{{instance}_Exp}");
            getUserState(category = "simple-rpg-test", key = "HP", playerId = "{instance}", varName = "{instance}_HP");
            setObjectVar(key = "HP", object = "instance", type = "integer", value = "{{instance}_HP}");
            setObjectVar(key = "HP", object = "instance", type = "integer", value = "98 + 10*{instance.CON} + 2*{instance.Level}");
            actorAttributes(actorId = "instance", attr = "maxHp", value = "{instance.HP}");
            actorAttributes(actorId = "instance", attr = "closeWeaponSpeed", value = "4-3/(1+0.05*{instance.AGI})");
            actorAttributes(actorId = "instance", attr = "weight", value = "3*pow(0.97,{instance.AGI})");
            deltaHp(actorCode = "instance", type = "heal", value = 9999);
        }
    }
    triggers {
    }
}
block loadStateNew {
    __repeat__ = -1;
    checks {
        forEachActor(actor = ActorMatch(controller = "player"), varname = "instance");
        checkNumber(lhs = "{instance.completedInit}", op = "==", rhs = 1);
        if(false) {
            checkString(str = "{{instance}_savedBefore}", matchKind = "equal", value = "1");
        }
        if(true) {
            checkString(str = "{{instance}_savedBefore}", matchKind = "equal", value = "undefined");
        }
    }
    actions {
        setObjectVar(key = "completedInit", object = "instance", type = "string", value = 2);
        if(false) {
            getUserState(category = "simple-rpg-test", key = "Point", playerId = "{instance}", varName = "{instance}_Point");
            setObjectVar(key = "Point", object = "instance", type = "integer", value = "{{instance}_Point}");
            getUserState(category = "simple-rpg-test", key = "ExpNeeded", playerId = "{instance}", varName = "{instance}_ExpNeeded");
            setObjectVar(key = "ExpNeeded", object = "instance", type = "integer", value = "{{instance}_ExpNeeded}");
            getUserState(category = "simple-rpg-test", key = "Level", playerId = "{instance}", varName = "{instance}_Level");
            setObjectVar(key = "Level", object = "instance", type = "integer", value = "{{instance}_Level}");
            getUserState(category = "simple-rpg-test", key = "STR", playerId = "{instance}", varName = "{instance}_STR");
            setObjectVar(key = "STR", object = "instance", type = "integer", value = "{{instance}_STR}");
            getUserState(category = "simple-rpg-test", key = "CON", playerId = "{instance}", varName = "{instance}_CON");
            setObjectVar(key = "CON", object = "instance", type = "integer", value = "{{instance}_CON}");
            getUserState(category = "simple-rpg-test", key = "AGI", playerId = "{instance}", varName = "{instance}_AGI");
            setObjectVar(key = "AGI", object = "instance", type = "integer", value = "{{instance}_AGI}");
            getUserState(category = "simple-rpg-test", key = "INT", playerId = "{instance}", varName = "{instance}_INT");
            setObjectVar(key = "INT", object = "instance", type = "integer", value = "{{instance}_INT}");
            getUserState(category = "simple-rpg-test", key = "PSY", playerId = "{instance}", varName = "{instance}_PSY");
            setObjectVar(key = "PSY", object = "instance", type = "integer", value = "{{instance}_PSY}");
            getUserState(category = "simple-rpg-test", key = "Exp", playerId = "{instance}", varName = "{instance}_Exp");
            setObjectVar(key = "Exp", object = "instance", type = "integer", value = "{{instance}_Exp}");
            getUserState(category = "simple-rpg-test", key = "HP", playerId = "{instance}", varName = "{instance}_HP");
            setObjectVar(key = "HP", object = "instance", type = "integer", value = "{{instance}_HP}");
            setObjectVar(key = "HP", object = "instance", type = "integer", value = "98 + 10*{instance.CON} + 2*{instance.Level}");
            actorAttributes(actorId = "instance", attr = "maxHp", value = "{instance.HP}");
            actorAttributes(actorId = "instance", attr = "closeWeaponSpeed", value = "4-3/(1+0.05*{instance.AGI})");
            actorAttributes(actorId = "instance", attr = "weight", value = "3*pow(0.97,{instance.AGI})");
            deltaHp(actorCode = "instance", type = "heal", value = 9999);
        }
    }
    triggers {
    }
}
block clickIncreaseSTR {
    __repeat__ = -1;
    triggers {
        clickButton(varName = "instance", buttonId = "increaseSTR");
    }
    checks {
        checkNumber(lhs = "{instance.Point}", op = ">", rhs = 0);
    }
    actions {
        setObjectVar(key = "Point", object = "instance", type = "integer", value = "{instance.Point}-1");
        setObjectVar(key = "STR", object = "instance", type = "integer", value = "{instance.STR}+1");
        actorTalk(actorId = "instance", text = "成功提升一點力量，尚餘{instance.Point}點能力點");
        setObjectVar(key = "HP", object = "instance", type = "integer", value = "98 + 10*{instance.CON} + 2*{instance.Level}");
        actorAttributes(actorId = "instance", attr = "maxHp", value = "{instance.HP}");
        actorAttributes(actorId = "instance", attr = "closeWeaponSpeed", value = "4-3/(1+0.05*{instance.AGI})");
        actorAttributes(actorId = "instance", attr = "weight", value = "3*pow(0.97,{instance.AGI})");
        setUserState(category = "simple-rpg-test", key = "Point", playerId = "{instance}", type = "string", value = "{{instance}.Point}");
        setUserState(category = "simple-rpg-test", key = "ExpNeeded", playerId = "{instance}", type = "string", value = "{{instance}.ExpNeeded}");
        setUserState(category = "simple-rpg-test", key = "Level", playerId = "{instance}", type = "string", value = "{{instance}.Level}");
        setUserState(category = "simple-rpg-test", key = "STR", playerId = "{instance}", type = "string", value = "{{instance}.STR}");
        setUserState(category = "simple-rpg-test", key = "CON", playerId = "{instance}", type = "string", value = "{{instance}.CON}");
        setUserState(category = "simple-rpg-test", key = "AGI", playerId = "{instance}", type = "string", value = "{{instance}.AGI}");
        setUserState(category = "simple-rpg-test", key = "INT", playerId = "{instance}", type = "string", value = "{{instance}.INT}");
        setUserState(category = "simple-rpg-test", key = "PSY", playerId = "{instance}", type = "string", value = "{{instance}.PSY}");
        setUserState(category = "simple-rpg-test", key = "Exp", playerId = "{instance}", type = "string", value = "{{instance}.Exp}");
        setUserState(category = "simple-rpg-test", key = "HP", playerId = "{instance}", type = "string", value = "{{instance}.HP}");
        setUserState(category = "simple-rpg-test", key = "savedBefore", playerId = "{instance}", type = "integer", value = "1");
    }
}
block clickIncreaseCON {
    __repeat__ = -1;
    triggers {
        clickButton(varName = "instance", buttonId = "increaseCON");
    }
    checks {
        checkNumber(lhs = "{instance.Point}", op = ">", rhs = 0);
    }
    actions {
        setObjectVar(key = "Point", object = "instance", type = "integer", value = "{instance.Point}-1");
        setObjectVar(key = "CON", object = "instance", type = "integer", value = "{instance.CON}+1");
        actorTalk(actorId = "instance", text = "成功提升一點體質，尚餘{instance.Point}點能力點");
        setObjectVar(key = "HP", object = "instance", type = "integer", value = "98 + 10*{instance.CON} + 2*{instance.Level}");
        actorAttributes(actorId = "instance", attr = "maxHp", value = "{instance.HP}");
        actorAttributes(actorId = "instance", attr = "closeWeaponSpeed", value = "4-3/(1+0.05*{instance.AGI})");
        actorAttributes(actorId = "instance", attr = "weight", value = "3*pow(0.97,{instance.AGI})");
        setUserState(category = "simple-rpg-test", key = "Point", playerId = "{instance}", type = "string", value = "{{instance}.Point}");
        setUserState(category = "simple-rpg-test", key = "ExpNeeded", playerId = "{instance}", type = "string", value = "{{instance}.ExpNeeded}");
        setUserState(category = "simple-rpg-test", key = "Level", playerId = "{instance}", type = "string", value = "{{instance}.Level}");
        setUserState(category = "simple-rpg-test", key = "STR", playerId = "{instance}", type = "string", value = "{{instance}.STR}");
        setUserState(category = "simple-rpg-test", key = "CON", playerId = "{instance}", type = "string", value = "{{instance}.CON}");
        setUserState(category = "simple-rpg-test", key = "AGI", playerId = "{instance}", type = "string", value = "{{instance}.AGI}");
        setUserState(category = "simple-rpg-test", key = "INT", playerId = "{instance}", type = "string", value = "{{instance}.INT}");
        setUserState(category = "simple-rpg-test", key = "PSY", playerId = "{instance}", type = "string", value = "{{instance}.PSY}");
        setUserState(category = "simple-rpg-test", key = "Exp", playerId = "{instance}", type = "string", value = "{{instance}.Exp}");
        setUserState(category = "simple-rpg-test", key = "HP", playerId = "{instance}", type = "string", value = "{{instance}.HP}");
        setUserState(category = "simple-rpg-test", key = "savedBefore", playerId = "{instance}", type = "integer", value = "1");
    }
}
block clickIncreaseAGI {
    __repeat__ = -1;
    triggers {
        clickButton(varName = "instance", buttonId = "increaseAGI");
    }
    checks {
        checkNumber(lhs = "{instance.Point}", op = ">", rhs = 0);
    }
    actions {
        setObjectVar(key = "Point", object = "instance", type = "integer", value = "{instance.Point}-1");
        setObjectVar(key = "AGI", object = "instance", type = "integer", value = "{instance.AGI}+1");
        actorTalk(actorId = "instance", text = "成功提升一點敏捷，尚餘{instance.Point}點能力點");
        setObjectVar(key = "HP", object = "instance", type = "integer", value = "98 + 10*{instance.CON} + 2*{instance.Level}");
        actorAttributes(actorId = "instance", attr = "maxHp", value = "{instance.HP}");
        actorAttributes(actorId = "instance", attr = "closeWeaponSpeed", value = "4-3/(1+0.05*{instance.AGI})");
        actorAttributes(actorId = "instance", attr = "weight", value = "3*pow(0.97,{instance.AGI})");
        setUserState(category = "simple-rpg-test", key = "Point", playerId = "{instance}", type = "string", value = "{{instance}.Point}");
        setUserState(category = "simple-rpg-test", key = "ExpNeeded", playerId = "{instance}", type = "string", value = "{{instance}.ExpNeeded}");
        setUserState(category = "simple-rpg-test", key = "Level", playerId = "{instance}", type = "string", value = "{{instance}.Level}");
        setUserState(category = "simple-rpg-test", key = "STR", playerId = "{instance}", type = "string", value = "{{instance}.STR}");
        setUserState(category = "simple-rpg-test", key = "CON", playerId = "{instance}", type = "string", value = "{{instance}.CON}");
        setUserState(category = "simple-rpg-test", key = "AGI", playerId = "{instance}", type = "string", value = "{{instance}.AGI}");
        setUserState(category = "simple-rpg-test", key = "INT", playerId = "{instance}", type = "string", value = "{{instance}.INT}");
        setUserState(category = "simple-rpg-test", key = "PSY", playerId = "{instance}", type = "string", value = "{{instance}.PSY}");
        setUserState(category = "simple-rpg-test", key = "Exp", playerId = "{instance}", type = "string", value = "{{instance}.Exp}");
        setUserState(category = "simple-rpg-test", key = "HP", playerId = "{instance}", type = "string", value = "{{instance}.HP}");
        setUserState(category = "simple-rpg-test", key = "savedBefore", playerId = "{instance}", type = "integer", value = "1");
    }
}
block clickIncreaseINT {
    __repeat__ = -1;
    triggers {
        clickButton(varName = "instance", buttonId = "increaseINT");
    }
    checks {
        checkNumber(lhs = "{instance.Point}", op = ">", rhs = 0);
    }
    actions {
        setObjectVar(key = "Point", object = "instance", type = "integer", value = "{instance.Point}-1");
        setObjectVar(key = "INT", object = "instance", type = "integer", value = "{instance.INT}+1");
        actorTalk(actorId = "instance", text = "成功提升一點智慧，尚餘{instance.Point}點能力點");
        setObjectVar(key = "HP", object = "instance", type = "integer", value = "98 + 10*{instance.CON} + 2*{instance.Level}");
        actorAttributes(actorId = "instance", attr = "maxHp", value = "{instance.HP}");
        actorAttributes(actorId = "instance", attr = "closeWeaponSpeed", value = "4-3/(1+0.05*{instance.AGI})");
        actorAttributes(actorId = "instance", attr = "weight", value = "3*pow(0.97,{instance.AGI})");
        setUserState(category = "simple-rpg-test", key = "Point", playerId = "{instance}", type = "string", value = "{{instance}.Point}");
        setUserState(category = "simple-rpg-test", key = "ExpNeeded", playerId = "{instance}", type = "string", value = "{{instance}.ExpNeeded}");
        setUserState(category = "simple-rpg-test", key = "Level", playerId = "{instance}", type = "string", value = "{{instance}.Level}");
        setUserState(category = "simple-rpg-test", key = "STR", playerId = "{instance}", type = "string", value = "{{instance}.STR}");
        setUserState(category = "simple-rpg-test", key = "CON", playerId = "{instance}", type = "string", value = "{{instance}.CON}");
        setUserState(category = "simple-rpg-test", key = "AGI", playerId = "{instance}", type = "string", value = "{{instance}.AGI}");
        setUserState(category = "simple-rpg-test", key = "INT", playerId = "{instance}", type = "string", value = "{{instance}.INT}");
        setUserState(category = "simple-rpg-test", key = "PSY", playerId = "{instance}", type = "string", value = "{{instance}.PSY}");
        setUserState(category = "simple-rpg-test", key = "Exp", playerId = "{instance}", type = "string", value = "{{instance}.Exp}");
        setUserState(category = "simple-rpg-test", key = "HP", playerId = "{instance}", type = "string", value = "{{instance}.HP}");
        setUserState(category = "simple-rpg-test", key = "savedBefore", playerId = "{instance}", type = "integer", value = "1");
    }
}
block clickIncreasePSY {
    __repeat__ = -1;
    triggers {
        clickButton(varName = "instance", buttonId = "increasePSY");
    }
    checks {
        checkNumber(lhs = "{instance.Point}", op = ">", rhs = 0);
    }
    actions {
        setObjectVar(key = "Point", object = "instance", type = "integer", value = "{instance.Point}-1");
        setObjectVar(key = "PSY", object = "instance", type = "integer", value = "{instance.PSY}+1");
        actorTalk(actorId = "instance", text = "成功提升一點精神，尚餘{instance.Point}點能力點");
        setObjectVar(key = "HP", object = "instance", type = "integer", value = "98 + 10*{instance.CON} + 2*{instance.Level}");
        actorAttributes(actorId = "instance", attr = "maxHp", value = "{instance.HP}");
        actorAttributes(actorId = "instance", attr = "closeWeaponSpeed", value = "4-3/(1+0.05*{instance.AGI})");
        actorAttributes(actorId = "instance", attr = "weight", value = "3*pow(0.97,{instance.AGI})");
        setUserState(category = "simple-rpg-test", key = "Point", playerId = "{instance}", type = "string", value = "{{instance}.Point}");
        setUserState(category = "simple-rpg-test", key = "ExpNeeded", playerId = "{instance}", type = "string", value = "{{instance}.ExpNeeded}");
        setUserState(category = "simple-rpg-test", key = "Level", playerId = "{instance}", type = "string", value = "{{instance}.Level}");
        setUserState(category = "simple-rpg-test", key = "STR", playerId = "{instance}", type = "string", value = "{{instance}.STR}");
        setUserState(category = "simple-rpg-test", key = "CON", playerId = "{instance}", type = "string", value = "{{instance}.CON}");
        setUserState(category = "simple-rpg-test", key = "AGI", playerId = "{instance}", type = "string", value = "{{instance}.AGI}");
        setUserState(category = "simple-rpg-test", key = "INT", playerId = "{instance}", type = "string", value = "{{instance}.INT}");
        setUserState(category = "simple-rpg-test", key = "PSY", playerId = "{instance}", type = "string", value = "{{instance}.PSY}");
        setUserState(category = "simple-rpg-test", key = "Exp", playerId = "{instance}", type = "string", value = "{{instance}.Exp}");
        setUserState(category = "simple-rpg-test", key = "HP", playerId = "{instance}", type = "string", value = "{{instance}.HP}");
        setUserState(category = "simple-rpg-test", key = "savedBefore", playerId = "{instance}", type = "integer", value = "1");
    }
}
block releasePowerWindStaff {
    __repeat__ = -1;
    triggers {
        releasePower(varName = "instance", weapon = "custom_wind_staff");
    }
    actions {
        if(true) {
            enblastEffect(fromActor = "instance", scale = "0.5", damage = "{instance.INT} + {instance.PSY}/2 + 10", toAngle = "({instance.bodyRotation}*180/3.14+32)");
            enblastEffect(fromActor = "instance", scale = "0.5", damage = "{instance.INT} + {instance.PSY}/2 + 10", toAngle = "({instance.bodyRotation}*180/3.14+16)");
            enblastEffect(fromActor = "instance", scale = "0.5", damage = "{instance.INT} + {instance.PSY}/2 + 10", toAngle = "{instance.bodyRotation}*180/3.14");
            enblastEffect(fromActor = "instance", scale = "0.5", damage = "{instance.INT} + {instance.PSY}/2 + 10", toAngle = "({instance.bodyRotation}*180/3.14-16)");
            enblastEffect(fromActor = "instance", scale = "0.5", damage = "{instance.INT} + {instance.PSY}/2 + 10", toAngle = "({instance.bodyRotation}*180/3.14-32)");
        }
        if(false) {
            deltaHp(actorCode = "instance", value = "{instance.HP}/4");
        }
    }
    checks {
    }
}
block releasePowerIronSword {
    __repeat__ = -1;
    triggers {
        releasePower(varName = "instance", weapon = "custom_iron_sword");
    }
    actions {
        if(false) {
            enblastEffect(fromActor = "instance", scale = "0.5", damage = "{instance.INT} + {instance.PSY}/2 + 10", toAngle = "({instance.bodyRotation}*180/3.14+32)");
            enblastEffect(fromActor = "instance", scale = "0.5", damage = "{instance.INT} + {instance.PSY}/2 + 10", toAngle = "({instance.bodyRotation}*180/3.14+16)");
            enblastEffect(fromActor = "instance", scale = "0.5", damage = "{instance.INT} + {instance.PSY}/2 + 10", toAngle = "{instance.bodyRotation}*180/3.14");
            enblastEffect(fromActor = "instance", scale = "0.5", damage = "{instance.INT} + {instance.PSY}/2 + 10", toAngle = "({instance.bodyRotation}*180/3.14-16)");
            enblastEffect(fromActor = "instance", scale = "0.5", damage = "{instance.INT} + {instance.PSY}/2 + 10", toAngle = "({instance.bodyRotation}*180/3.14-32)");
        }
        if(true) {
            deltaHp(actorCode = "instance", value = "{instance.HP}/4");
        }
    }
    checks {
    }
}
block clickResetPoint {
    __repeat__ = -1;
    triggers {
        clickButton(varName = "instance", buttonId = "ResetPoint");
    }
    actions {
        setObjectVar(key = "Point", object = "instance", type = "integer", value = "{instance.Level}*2+3");
        setObjectVar(key = "STR", object = "instance", type = "integer", value = 0);
        setObjectVar(key = "CON", object = "instance", type = "integer", value = 0);
        setObjectVar(key = "AGI", object = "instance", type = "integer", value = 0);
        setObjectVar(key = "INT", object = "instance", type = "integer", value = 0);
        setObjectVar(key = "PSY", object = "instance", type = "integer", value = 0);
        actorTalk(actorId = "instance", text = "成功重設能力點，目前有{instance.Point}點能力點");
        setObjectVar(key = "HP", object = "instance", type = "integer", value = "98 + 10*{instance.CON} + 2*{instance.Level}");
        actorAttributes(actorId = "instance", attr = "maxHp", value = "{instance.HP}");
        actorAttributes(actorId = "instance", attr = "closeWeaponSpeed", value = "4-3/(1+0.05*{instance.AGI})");
        actorAttributes(actorId = "instance", attr = "weight", value = "3*pow(0.97,{instance.AGI})");
        setUserState(category = "simple-rpg-test", key = "Point", playerId = "{instance}", type = "string", value = "{{instance}.Point}");
        setUserState(category = "simple-rpg-test", key = "ExpNeeded", playerId = "{instance}", type = "string", value = "{{instance}.ExpNeeded}");
        setUserState(category = "simple-rpg-test", key = "Level", playerId = "{instance}", type = "string", value = "{{instance}.Level}");
        setUserState(category = "simple-rpg-test", key = "STR", playerId = "{instance}", type = "string", value = "{{instance}.STR}");
        setUserState(category = "simple-rpg-test", key = "CON", playerId = "{instance}", type = "string", value = "{{instance}.CON}");
        setUserState(category = "simple-rpg-test", key = "AGI", playerId = "{instance}", type = "string", value = "{{instance}.AGI}");
        setUserState(category = "simple-rpg-test", key = "INT", playerId = "{instance}", type = "string", value = "{{instance}.INT}");
        setUserState(category = "simple-rpg-test", key = "PSY", playerId = "{instance}", type = "string", value = "{{instance}.PSY}");
        setUserState(category = "simple-rpg-test", key = "Exp", playerId = "{instance}", type = "string", value = "{{instance}.Exp}");
        setUserState(category = "simple-rpg-test", key = "HP", playerId = "{instance}", type = "string", value = "{{instance}.HP}");
        setUserState(category = "simple-rpg-test", key = "savedBefore", playerId = "{instance}", type = "integer", value = "1");
    }
    checks {
    }
}
block getExp {
    __repeat__ = -1;
    triggers {
        itemPickup(actorVarname = "instance", matchKind = "equal", itemVarname = "deer_exp");
    }
    actions {
        setObjectVar(key = "Exp", object = "instance", type = "integer", value = "({instance.Exp}+1)");
        setUserState(category = "simple-rpg-test", key = "Point", playerId = "{instance}", type = "string", value = "{{instance}.Point}");
        setUserState(category = "simple-rpg-test", key = "ExpNeeded", playerId = "{instance}", type = "string", value = "{{instance}.ExpNeeded}");
        setUserState(category = "simple-rpg-test", key = "Level", playerId = "{instance}", type = "string", value = "{{instance}.Level}");
        setUserState(category = "simple-rpg-test", key = "STR", playerId = "{instance}", type = "string", value = "{{instance}.STR}");
        setUserState(category = "simple-rpg-test", key = "CON", playerId = "{instance}", type = "string", value = "{{instance}.CON}");
        setUserState(category = "simple-rpg-test", key = "AGI", playerId = "{instance}", type = "string", value = "{{instance}.AGI}");
        setUserState(category = "simple-rpg-test", key = "INT", playerId = "{instance}", type = "string", value = "{{instance}.INT}");
        setUserState(category = "simple-rpg-test", key = "PSY", playerId = "{instance}", type = "string", value = "{{instance}.PSY}");
        setUserState(category = "simple-rpg-test", key = "Exp", playerId = "{instance}", type = "string", value = "{{instance}.Exp}");
        setUserState(category = "simple-rpg-test", key = "HP", playerId = "{instance}", type = "string", value = "{{instance}.HP}");
        setUserState(category = "simple-rpg-test", key = "savedBefore", playerId = "{instance}", type = "integer", value = "1");
    }
    checks {
    }
}
block monsterDead {
    __repeat__ = -1;
    triggers {
        actorDead(actor = ActorMatch(id = "monster"), varName = "instance");
    }
    actions {
        addDropItem(itemCode = "deer_exp", x = "({instance.gamePosition.x}-16)/32", y = "({instance.gamePosition.y}-16)/32", type = "sariraFire");
    }
    checks {
    }
}
block monsterSpawn {
    __repeat__ = -1;
    __repeatInterval__ = 8000;
    checks {
        actorCount(actor = ActorMatch(id = "monster_deer", matchKind = "contain"), op = "<", value = "5");
    }
    actions {
        addActor(name = "鹿(60)", id = "monster_deer*", camp = "第三", hp = 60, x = "random(21,40)", y = "random(0,19)", localVarname = "actor", weapon1 = "fist", weapon2 = "fist", strength = "10", role = "鹿");
        actorFollow(actorId = "actor", type = "跟隨自己");
    }
    triggers {
    }
}
block levelUp {
    __repeat__ = -1;
    checks {
        forEachActor(actor = ActorMatch(controller = "玩家"), varname = "instance");
        checkNumber(lhs = "{instance.Exp}", op = ">=", rhs = "{instance.ExpNeeded}");
    }
    actions {
        setObjectVar(key = "Exp", object = "instance", type = "integer", value = "{instance.Exp}-{instance.ExpNeeded}");
        setObjectVar(key = "Level", object = "instance", type = "integer", value = "({instance.Level}+1)");
        setObjectVar(key = "Point", object = "instance", type = "integer", value = "({instance.Point}+2)");
        setObjectVar(key = "ExpNeeded", object = "instance", type = "integer", value = "{instance.Level}*2+4");
        setObjectVar(key = "HP", object = "instance", type = "integer", value = "98 + 10*{instance.CON} + 2*{instance.Level}");
        actorAttributes(actorId = "instance", attr = "maxHp", value = "{instance.HP}");
        setUserState(category = "simple-rpg-test", key = "Point", playerId = "{instance}", type = "string", value = "{{instance}.Point}");
        setUserState(category = "simple-rpg-test", key = "ExpNeeded", playerId = "{instance}", type = "string", value = "{{instance}.ExpNeeded}");
        setUserState(category = "simple-rpg-test", key = "Level", playerId = "{instance}", type = "string", value = "{{instance}.Level}");
        setUserState(category = "simple-rpg-test", key = "STR", playerId = "{instance}", type = "string", value = "{{instance}.STR}");
        setUserState(category = "simple-rpg-test", key = "CON", playerId = "{instance}", type = "string", value = "{{instance}.CON}");
        setUserState(category = "simple-rpg-test", key = "AGI", playerId = "{instance}", type = "string", value = "{{instance}.AGI}");
        setUserState(category = "simple-rpg-test", key = "INT", playerId = "{instance}", type = "string", value = "{{instance}.INT}");
        setUserState(category = "simple-rpg-test", key = "PSY", playerId = "{instance}", type = "string", value = "{{instance}.PSY}");
        setUserState(category = "simple-rpg-test", key = "Exp", playerId = "{instance}", type = "string", value = "{{instance}.Exp}");
        setUserState(category = "simple-rpg-test", key = "HP", playerId = "{instance}", type = "string", value = "{{instance}.HP}");
        setUserState(category = "simple-rpg-test", key = "savedBefore", playerId = "{instance}", type = "integer", value = "1");
    }
    triggers {
    }
}
block recover {
    __repeat__ = -1;
    __repeatInterval__ = 10000;
    checks {
        forEachActor(actor = ActorMatch(controller = "玩家"), varname = "instance");
    }
    actions {
        deltaHp(actorCode = "instance", value = "1 + {instance.PSY} + {instance.CON}/2");
    }
    triggers {
    }
}
block pressZ {
    __repeat__ = -1;
    triggers {
        keyboardPressed(varName = "instance", key = "Z");
    }
    actions {
        actorTalk(actorId = "{instance.id}", text = "【Lv{{instance.id}.Level}】\nExp:{{instance.id}.Exp}/{{instance.id}.ExpNeeded}\n尚餘能力點：{{instance.id}.Point}\n力量：{{instance.id}.STR}\n體質：{{instance.id}.CON}\n敏捷：{{instance.id}.AGI}\n智慧：{{instance.id}.INT}\n精神：{{instance.id}.PSY}");
    }
    checks {
    }
}
block staffAttack {
    __repeat__ = -1;
    triggers {
        actorFire(weapon = "custom_wind_staff", varName = "instance");
    }
    actions {
        enblastEffect(fromActor = "instance", toAngle = "{instance.bodyRotation}*180/3.14", scale = "0.5", damage = "{instance.INT} + {instance.PSY}/2 + 10");
    }
    checks {
    }
}
block swordAttack {
    __repeat__ = -1;
    triggers {
        actorHit(actor = ActorMatch(), actorVarName = "instance", hitter = ActorMatch(), hitterVarName = "attacker", weapon = "custom_iron_sword");
    }
    actions {
        deltaHp(actorCode = "instance", casterCode = "attacker", type = "流血受傷", value = "{attacker.STR}*3");
    }
    checks {
    }
}
block newPlayer {
    __repeat__ = -1;
    triggers {
        actorAdded(actor = ActorMatch(controller = "player"), varName = "instance");
    }
    actions {
        setObjectVar(key = "STR", object = "instance", type = "integer", value = 0);
        setObjectVar(key = "CON", object = "instance", type = "integer", value = 0);
        setObjectVar(key = "AGI", object = "instance", type = "integer", value = 0);
        setObjectVar(key = "INT", object = "instance", type = "integer", value = 0);
        setObjectVar(key = "PSY", object = "instance", type = "integer", value = 0);
        setObjectVar(key = "Level", object = "instance", type = "integer", value = 1);
        setObjectVar(key = "Point", object = "instance", type = "integer", value = 5);
        setObjectVar(key = "Exp", object = "instance", type = "integer", value = 0);
        setObjectVar(key = "ExpNeeded", object = "instance", type = "integer", value = 6);
        setObjectVar(key = "HP", object = "instance", type = "integer", value = 100);
        getUserState(category = "simple-rpg-test", key = "savedBefore", playerId = "{instance}", varName = "{instance}_savedBefore");
        setObjectVar(key = "completedInit", object = "instance", type = "integer", value = 1);
    }
    checks {
    }
}
block init {
    actions {
        setWeaponAbility(weapon = "小刀", operation = "無技能", level = 1);
        setWeaponAbility(weapon = "小刀", operation = "無技能", level = 2);
        setWeaponAbility(weapon = "custom_wind_staff");
        setWeaponAbility(weapon = "custom_iron_sword");
        addStuff(x = 4, y = 8, item = "custom_wind_staff");
        addStuff(x = 4, y = 8, item = "custom_wind_staff");
        addStuff(x = 4, y = 8, item = "custom_wind_staff");
        addStuff(x = 4, y = 8, item = "custom_wind_staff");
        addStuff(x = 4, y = 8, item = "custom_wind_staff");
        addMapSign(x = 4, y = 7, rotation = 90, text = "【法杖】\n武器傷害：5\n - 攻擊附帶傷害為【10+智慧+精神/2】的光彈\n技能：釋出5發光彈", showButtons = false);
        addMapSign(x = 6, y = 7, rotation = 90, text = "【鐵劍】\n武器傷害：【30+力量*3】\n技能：恢復四分之一的血量", showButtons = false);
        if(false) {
            mapWarp(fromX = 19, fromY = 9, toX = 21, toY = 9, direction = "下");
            mapWarp(fromX = 21, fromY = 9, toX = 19, toY = 9, direction = "上");
        } else if(false) {
            mapWarp(fromX = 19, fromY = 9, toX = 21, toY = 9, direction = "上");
            mapWarp(fromX = 21, fromY = 9, toX = 19, toY = 9, direction = "下");
        } else if(false) {
            mapWarp(fromX = 19, fromY = 9, toX = 21, toY = 9, direction = "左");
            mapWarp(fromX = 21, fromY = 9, toX = 19, toY = 9, direction = "右");
        } else if(true) {
            mapWarp(fromX = 19, fromY = 9, toX = 21, toY = 9, direction = "右");
            mapWarp(fromX = 21, fromY = 9, toX = 19, toY = 9, direction = "左");
        } else if(false) {
            print(type = "error", text = "Cannot set the same point as the mapWarp src and dst");
        } else {
            print(type = "error", text = "Bidirectional mapWarp requires x or y to be the same value");
        }
        if(false) {
            mapWarp(fromX = 19, fromY = 10, toX = 21, toY = 10, direction = "下");
            mapWarp(fromX = 21, fromY = 10, toX = 19, toY = 10, direction = "上");
        } else if(false) {
            mapWarp(fromX = 19, fromY = 10, toX = 21, toY = 10, direction = "上");
            mapWarp(fromX = 21, fromY = 10, toX = 19, toY = 10, direction = "下");
        } else if(false) {
            mapWarp(fromX = 19, fromY = 10, toX = 21, toY = 10, direction = "左");
            mapWarp(fromX = 21, fromY = 10, toX = 19, toY = 10, direction = "右");
        } else if(true) {
            mapWarp(fromX = 19, fromY = 10, toX = 21, toY = 10, direction = "右");
            mapWarp(fromX = 21, fromY = 10, toX = 19, toY = 10, direction = "左");
        } else if(false) {
            print(type = "error", text = "Cannot set the same point as the mapWarp src and dst");
        } else {
            print(type = "error", text = "Bidirectional mapWarp requires x or y to be the same value");
        }
        addStuff(x = 6, y = 8, item = "custom_iron_sword");
        addStuff(x = 6, y = 8, item = "custom_iron_sword");
        addStuff(x = 6, y = 8, item = "custom_iron_sword");
        addStuff(x = 6, y = 8, item = "custom_iron_sword");
        addStuff(x = 6, y = 8, item = "custom_iron_sword");
        addMapSign(x = 3, y = 17, rotation = 270, text = "【力量】\n消耗一點能力點，提升劍類傷害", buttonCode = "increaseSTR", buttonLabel = "確認");
        addMapSign(x = 5, y = 17, rotation = 270, text = "【體質】\n消耗一點能力點，增加十點血量上限及半點恢復力", buttonCode = "increaseCON", buttonLabel = "確認");
        addMapSign(x = 7, y = 17, rotation = 270, text = "【敏捷】\n消耗一點能力點，重量減少3%，並提升武器攻擊速度", buttonCode = "increaseAGI", buttonLabel = "確認");
        addMapSign(x = 9, y = 17, rotation = 270, text = "【智慧】\n消耗一點能力點，提升杖類傷害", buttonCode = "increaseINT", buttonLabel = "確認");
        addMapSign(x = 11, y = 17, rotation = 270, text = "【精神】\n消耗一點能力點，小量提升杖類傷害及提升一點恢復力", buttonCode = "increasePSY", buttonLabel = "確認");
        addMapSign(x = 1, y = 15, rotation = 0, text = "【重置能力點分配】", buttonCode = "ResetPoint", buttonLabel = "確認");
    }
    checks {
    }
    triggers {
    }
}
//----------------------------------//
//--- AST After forLoopUnrolling ---//
//----------------------------------//
__skydowLocs__ = Point(10,10);
__royalLocs__ = Point(10,10);
__thirdLocs__ = Point(10,10);
__lives__ = 9999;
__title__ = "RPG試驗";
__useDefaultItems__ = true;
__useCustomWeapons__ = true;
__customWeapons__ = [CustomWeapon(reference = "TWilightGameEventCompiler.weapon_wind_staff", code = "wind_staff", damage = 5, fireType = "單手橫劈", pivotOnHandDegree = 58, pivotOnHandX = 2, pivotOnHandY = 9, pivotOnHandXScale = "1.3", pivotOnHandYScale = "1.5", pivotOnIconDegree = -40, pivotOnIconX = 20, pivotOnIconY = 20),CustomWeapon(reference = "TWilightGameEventCompiler.weapon_iron_sword", code = "iron_sword", damage = 30, fireType = "大刀砍劈", pivotOnHandDegree = 35, pivotOnHandX = -12, pivotOnIconDegree = -40, pivotOnIconX = 27, pivotOnIconY = 14)];
__map__ = "CG.TWilightGameEventCompiler/rpg/simple_rpg.twmap";
__roomSize__ = 8;
block loadStateSaved {
    __repeat__ = -1;
    checks {
        forEachActor(actor = ActorMatch(controller = "player"), varname = "instance");
        checkNumber(lhs = "{instance.completedInit}", op = "==", rhs = 1);
        if(true) {
            checkString(str = "{{instance}_savedBefore}", matchKind = "equal", value = "1");
        }
        if(false) {
            checkString(str = "{{instance}_savedBefore}", matchKind = "equal", value = "undefined");
        }
    }
    actions {
        setObjectVar(key = "completedInit", object = "instance", type = "string", value = 2);
        if(true) {
            getUserState(category = "simple-rpg-test", key = "Point", playerId = "{instance}", varName = "{instance}_Point");
            setObjectVar(key = "Point", object = "instance", type = "integer", value = "{{instance}_Point}");
            getUserState(category = "simple-rpg-test", key = "ExpNeeded", playerId = "{instance}", varName = "{instance}_ExpNeeded");
            setObjectVar(key = "ExpNeeded", object = "instance", type = "integer", value = "{{instance}_ExpNeeded}");
            getUserState(category = "simple-rpg-test", key = "Level", playerId = "{instance}", varName = "{instance}_Level");
            setObjectVar(key = "Level", object = "instance", type = "integer", value = "{{instance}_Level}");
            getUserState(category = "simple-rpg-test", key = "STR", playerId = "{instance}", varName = "{instance}_STR");
            setObjectVar(key = "STR", object = "instance", type = "integer", value = "{{instance}_STR}");
            getUserState(category = "simple-rpg-test", key = "CON", playerId = "{instance}", varName = "{instance}_CON");
            setObjectVar(key = "CON", object = "instance", type = "integer", value = "{{instance}_CON}");
            getUserState(category = "simple-rpg-test", key = "AGI", playerId = "{instance}", varName = "{instance}_AGI");
            setObjectVar(key = "AGI", object = "instance", type = "integer", value = "{{instance}_AGI}");
            getUserState(category = "simple-rpg-test", key = "INT", playerId = "{instance}", varName = "{instance}_INT");
            setObjectVar(key = "INT", object = "instance", type = "integer", value = "{{instance}_INT}");
            getUserState(category = "simple-rpg-test", key = "PSY", playerId = "{instance}", varName = "{instance}_PSY");
            setObjectVar(key = "PSY", object = "instance", type = "integer", value = "{{instance}_PSY}");
            getUserState(category = "simple-rpg-test", key = "Exp", playerId = "{instance}", varName = "{instance}_Exp");
            setObjectVar(key = "Exp", object = "instance", type = "integer", value = "{{instance}_Exp}");
            getUserState(category = "simple-rpg-test", key = "HP", playerId = "{instance}", varName = "{instance}_HP");
            setObjectVar(key = "HP", object = "instance", type = "integer", value = "{{instance}_HP}");
            setObjectVar(key = "HP", object = "instance", type = "integer", value = "98 + 10*{instance.CON} + 2*{instance.Level}");
            actorAttributes(actorId = "instance", attr = "maxHp", value = "{instance.HP}");
            actorAttributes(actorId = "instance", attr = "closeWeaponSpeed", value = "4-3/(1+0.05*{instance.AGI})");
            actorAttributes(actorId = "instance", attr = "weight", value = "3*pow(0.97,{instance.AGI})");
            deltaHp(actorCode = "instance", type = "heal", value = 9999);
        }
    }
    triggers {
    }
}
block loadStateNew {
    __repeat__ = -1;
    checks {
        forEachActor(actor = ActorMatch(controller = "player"), varname = "instance");
        checkNumber(lhs = "{instance.completedInit}", op = "==", rhs = 1);
        if(false) {
            checkString(str = "{{instance}_savedBefore}", matchKind = "equal", value = "1");
        }
        if(true) {
            checkString(str = "{{instance}_savedBefore}", matchKind = "equal", value = "undefined");
        }
    }
    actions {
        setObjectVar(key = "completedInit", object = "instance", type = "string", value = 2);
        if(false) {
            getUserState(category = "simple-rpg-test", key = "Point", playerId = "{instance}", varName = "{instance}_Point");
            setObjectVar(key = "Point", object = "instance", type = "integer", value = "{{instance}_Point}");
            getUserState(category = "simple-rpg-test", key = "ExpNeeded", playerId = "{instance}", varName = "{instance}_ExpNeeded");
            setObjectVar(key = "ExpNeeded", object = "instance", type = "integer", value = "{{instance}_ExpNeeded}");
            getUserState(category = "simple-rpg-test", key = "Level", playerId = "{instance}", varName = "{instance}_Level");
            setObjectVar(key = "Level", object = "instance", type = "integer", value = "{{instance}_Level}");
            getUserState(category = "simple-rpg-test", key = "STR", playerId = "{instance}", varName = "{instance}_STR");
            setObjectVar(key = "STR", object = "instance", type = "integer", value = "{{instance}_STR}");
            getUserState(category = "simple-rpg-test", key = "CON", playerId = "{instance}", varName = "{instance}_CON");
            setObjectVar(key = "CON", object = "instance", type = "integer", value = "{{instance}_CON}");
            getUserState(category = "simple-rpg-test", key = "AGI", playerId = "{instance}", varName = "{instance}_AGI");
            setObjectVar(key = "AGI", object = "instance", type = "integer", value = "{{instance}_AGI}");
            getUserState(category = "simple-rpg-test", key = "INT", playerId = "{instance}", varName = "{instance}_INT");
            setObjectVar(key = "INT", object = "instance", type = "integer", value = "{{instance}_INT}");
            getUserState(category = "simple-rpg-test", key = "PSY", playerId = "{instance}", varName = "{instance}_PSY");
            setObjectVar(key = "PSY", object = "instance", type = "integer", value = "{{instance}_PSY}");
            getUserState(category = "simple-rpg-test", key = "Exp", playerId = "{instance}", varName = "{instance}_Exp");
            setObjectVar(key = "Exp", object = "instance", type = "integer", value = "{{instance}_Exp}");
            getUserState(category = "simple-rpg-test", key = "HP", playerId = "{instance}", varName = "{instance}_HP");
            setObjectVar(key = "HP", object = "instance", type = "integer", value = "{{instance}_HP}");
            setObjectVar(key = "HP", object = "instance", type = "integer", value = "98 + 10*{instance.CON} + 2*{instance.Level}");
            actorAttributes(actorId = "instance", attr = "maxHp", value = "{instance.HP}");
            actorAttributes(actorId = "instance", attr = "closeWeaponSpeed", value = "4-3/(1+0.05*{instance.AGI})");
            actorAttributes(actorId = "instance", attr = "weight", value = "3*pow(0.97,{instance.AGI})");
            deltaHp(actorCode = "instance", type = "heal", value = 9999);
        }
    }
    triggers {
    }
}
block clickIncreaseSTR {
    __repeat__ = -1;
    triggers {
        clickButton(varName = "instance", buttonId = "increaseSTR");
    }
    checks {
        checkNumber(lhs = "{instance.Point}", op = ">", rhs = 0);
    }
    actions {
        setObjectVar(key = "Point", object = "instance", type = "integer", value = "{instance.Point}-1");
        setObjectVar(key = "STR", object = "instance", type = "integer", value = "{instance.STR}+1");
        actorTalk(actorId = "instance", text = "成功提升一點力量，尚餘{instance.Point}點能力點");
        setObjectVar(key = "HP", object = "instance", type = "integer", value = "98 + 10*{instance.CON} + 2*{instance.Level}");
        actorAttributes(actorId = "instance", attr = "maxHp", value = "{instance.HP}");
        actorAttributes(actorId = "instance", attr = "closeWeaponSpeed", value = "4-3/(1+0.05*{instance.AGI})");
        actorAttributes(actorId = "instance", attr = "weight", value = "3*pow(0.97,{instance.AGI})");
        setUserState(category = "simple-rpg-test", key = "Point", playerId = "{instance}", type = "string", value = "{{instance}.Point}");
        setUserState(category = "simple-rpg-test", key = "ExpNeeded", playerId = "{instance}", type = "string", value = "{{instance}.ExpNeeded}");
        setUserState(category = "simple-rpg-test", key = "Level", playerId = "{instance}", type = "string", value = "{{instance}.Level}");
        setUserState(category = "simple-rpg-test", key = "STR", playerId = "{instance}", type = "string", value = "{{instance}.STR}");
        setUserState(category = "simple-rpg-test", key = "CON", playerId = "{instance}", type = "string", value = "{{instance}.CON}");
        setUserState(category = "simple-rpg-test", key = "AGI", playerId = "{instance}", type = "string", value = "{{instance}.AGI}");
        setUserState(category = "simple-rpg-test", key = "INT", playerId = "{instance}", type = "string", value = "{{instance}.INT}");
        setUserState(category = "simple-rpg-test", key = "PSY", playerId = "{instance}", type = "string", value = "{{instance}.PSY}");
        setUserState(category = "simple-rpg-test", key = "Exp", playerId = "{instance}", type = "string", value = "{{instance}.Exp}");
        setUserState(category = "simple-rpg-test", key = "HP", playerId = "{instance}", type = "string", value = "{{instance}.HP}");
        setUserState(category = "simple-rpg-test", key = "savedBefore", playerId = "{instance}", type = "integer", value = "1");
    }
}
block clickIncreaseCON {
    __repeat__ = -1;
    triggers {
        clickButton(varName = "instance", buttonId = "increaseCON");
    }
    checks {
        checkNumber(lhs = "{instance.Point}", op = ">", rhs = 0);
    }
    actions {
        setObjectVar(key = "Point", object = "instance", type = "integer", value = "{instance.Point}-1");
        setObjectVar(key = "CON", object = "instance", type = "integer", value = "{instance.CON}+1");
        actorTalk(actorId = "instance", text = "成功提升一點體質，尚餘{instance.Point}點能力點");
        setObjectVar(key = "HP", object = "instance", type = "integer", value = "98 + 10*{instance.CON} + 2*{instance.Level}");
        actorAttributes(actorId = "instance", attr = "maxHp", value = "{instance.HP}");
        actorAttributes(actorId = "instance", attr = "closeWeaponSpeed", value = "4-3/(1+0.05*{instance.AGI})");
        actorAttributes(actorId = "instance", attr = "weight", value = "3*pow(0.97,{instance.AGI})");
        setUserState(category = "simple-rpg-test", key = "Point", playerId = "{instance}", type = "string", value = "{{instance}.Point}");
        setUserState(category = "simple-rpg-test", key = "ExpNeeded", playerId = "{instance}", type = "string", value = "{{instance}.ExpNeeded}");
        setUserState(category = "simple-rpg-test", key = "Level", playerId = "{instance}", type = "string", value = "{{instance}.Level}");
        setUserState(category = "simple-rpg-test", key = "STR", playerId = "{instance}", type = "string", value = "{{instance}.STR}");
        setUserState(category = "simple-rpg-test", key = "CON", playerId = "{instance}", type = "string", value = "{{instance}.CON}");
        setUserState(category = "simple-rpg-test", key = "AGI", playerId = "{instance}", type = "string", value = "{{instance}.AGI}");
        setUserState(category = "simple-rpg-test", key = "INT", playerId = "{instance}", type = "string", value = "{{instance}.INT}");
        setUserState(category = "simple-rpg-test", key = "PSY", playerId = "{instance}", type = "string", value = "{{instance}.PSY}");
        setUserState(category = "simple-rpg-test", key = "Exp", playerId = "{instance}", type = "string", value = "{{instance}.Exp}");
        setUserState(category = "simple-rpg-test", key = "HP", playerId = "{instance}", type = "string", value = "{{instance}.HP}");
        setUserState(category = "simple-rpg-test", key = "savedBefore", playerId = "{instance}", type = "integer", value = "1");
    }
}
block clickIncreaseAGI {
    __repeat__ = -1;
    triggers {
        clickButton(varName = "instance", buttonId = "increaseAGI");
    }
    checks {
        checkNumber(lhs = "{instance.Point}", op = ">", rhs = 0);
    }
    actions {
        setObjectVar(key = "Point", object = "instance", type = "integer", value = "{instance.Point}-1");
        setObjectVar(key = "AGI", object = "instance", type = "integer", value = "{instance.AGI}+1");
        actorTalk(actorId = "instance", text = "成功提升一點敏捷，尚餘{instance.Point}點能力點");
        setObjectVar(key = "HP", object = "instance", type = "integer", value = "98 + 10*{instance.CON} + 2*{instance.Level}");
        actorAttributes(actorId = "instance", attr = "maxHp", value = "{instance.HP}");
        actorAttributes(actorId = "instance", attr = "closeWeaponSpeed", value = "4-3/(1+0.05*{instance.AGI})");
        actorAttributes(actorId = "instance", attr = "weight", value = "3*pow(0.97,{instance.AGI})");
        setUserState(category = "simple-rpg-test", key = "Point", playerId = "{instance}", type = "string", value = "{{instance}.Point}");
        setUserState(category = "simple-rpg-test", key = "ExpNeeded", playerId = "{instance}", type = "string", value = "{{instance}.ExpNeeded}");
        setUserState(category = "simple-rpg-test", key = "Level", playerId = "{instance}", type = "string", value = "{{instance}.Level}");
        setUserState(category = "simple-rpg-test", key = "STR", playerId = "{instance}", type = "string", value = "{{instance}.STR}");
        setUserState(category = "simple-rpg-test", key = "CON", playerId = "{instance}", type = "string", value = "{{instance}.CON}");
        setUserState(category = "simple-rpg-test", key = "AGI", playerId = "{instance}", type = "string", value = "{{instance}.AGI}");
        setUserState(category = "simple-rpg-test", key = "INT", playerId = "{instance}", type = "string", value = "{{instance}.INT}");
        setUserState(category = "simple-rpg-test", key = "PSY", playerId = "{instance}", type = "string", value = "{{instance}.PSY}");
        setUserState(category = "simple-rpg-test", key = "Exp", playerId = "{instance}", type = "string", value = "{{instance}.Exp}");
        setUserState(category = "simple-rpg-test", key = "HP", playerId = "{instance}", type = "string", value = "{{instance}.HP}");
        setUserState(category = "simple-rpg-test", key = "savedBefore", playerId = "{instance}", type = "integer", value = "1");
    }
}
block clickIncreaseINT {
    __repeat__ = -1;
    triggers {
        clickButton(varName = "instance", buttonId = "increaseINT");
    }
    checks {
        checkNumber(lhs = "{instance.Point}", op = ">", rhs = 0);
    }
    actions {
        setObjectVar(key = "Point", object = "instance", type = "integer", value = "{instance.Point}-1");
        setObjectVar(key = "INT", object = "instance", type = "integer", value = "{instance.INT}+1");
        actorTalk(actorId = "instance", text = "成功提升一點智慧，尚餘{instance.Point}點能力點");
        setObjectVar(key = "HP", object = "instance", type = "integer", value = "98 + 10*{instance.CON} + 2*{instance.Level}");
        actorAttributes(actorId = "instance", attr = "maxHp", value = "{instance.HP}");
        actorAttributes(actorId = "instance", attr = "closeWeaponSpeed", value = "4-3/(1+0.05*{instance.AGI})");
        actorAttributes(actorId = "instance", attr = "weight", value = "3*pow(0.97,{instance.AGI})");
        setUserState(category = "simple-rpg-test", key = "Point", playerId = "{instance}", type = "string", value = "{{instance}.Point}");
        setUserState(category = "simple-rpg-test", key = "ExpNeeded", playerId = "{instance}", type = "string", value = "{{instance}.ExpNeeded}");
        setUserState(category = "simple-rpg-test", key = "Level", playerId = "{instance}", type = "string", value = "{{instance}.Level}");
        setUserState(category = "simple-rpg-test", key = "STR", playerId = "{instance}", type = "string", value = "{{instance}.STR}");
        setUserState(category = "simple-rpg-test", key = "CON", playerId = "{instance}", type = "string", value = "{{instance}.CON}");
        setUserState(category = "simple-rpg-test", key = "AGI", playerId = "{instance}", type = "string", value = "{{instance}.AGI}");
        setUserState(category = "simple-rpg-test", key = "INT", playerId = "{instance}", type = "string", value = "{{instance}.INT}");
        setUserState(category = "simple-rpg-test", key = "PSY", playerId = "{instance}", type = "string", value = "{{instance}.PSY}");
        setUserState(category = "simple-rpg-test", key = "Exp", playerId = "{instance}", type = "string", value = "{{instance}.Exp}");
        setUserState(category = "simple-rpg-test", key = "HP", playerId = "{instance}", type = "string", value = "{{instance}.HP}");
        setUserState(category = "simple-rpg-test", key = "savedBefore", playerId = "{instance}", type = "integer", value = "1");
    }
}
block clickIncreasePSY {
    __repeat__ = -1;
    triggers {
        clickButton(varName = "instance", buttonId = "increasePSY");
    }
    checks {
        checkNumber(lhs = "{instance.Point}", op = ">", rhs = 0);
    }
    actions {
        setObjectVar(key = "Point", object = "instance", type = "integer", value = "{instance.Point}-1");
        setObjectVar(key = "PSY", object = "instance", type = "integer", value = "{instance.PSY}+1");
        actorTalk(actorId = "instance", text = "成功提升一點精神，尚餘{instance.Point}點能力點");
        setObjectVar(key = "HP", object = "instance", type = "integer", value = "98 + 10*{instance.CON} + 2*{instance.Level}");
        actorAttributes(actorId = "instance", attr = "maxHp", value = "{instance.HP}");
        actorAttributes(actorId = "instance", attr = "closeWeaponSpeed", value = "4-3/(1+0.05*{instance.AGI})");
        actorAttributes(actorId = "instance", attr = "weight", value = "3*pow(0.97,{instance.AGI})");
        setUserState(category = "simple-rpg-test", key = "Point", playerId = "{instance}", type = "string", value = "{{instance}.Point}");
        setUserState(category = "simple-rpg-test", key = "ExpNeeded", playerId = "{instance}", type = "string", value = "{{instance}.ExpNeeded}");
        setUserState(category = "simple-rpg-test", key = "Level", playerId = "{instance}", type = "string", value = "{{instance}.Level}");
        setUserState(category = "simple-rpg-test", key = "STR", playerId = "{instance}", type = "string", value = "{{instance}.STR}");
        setUserState(category = "simple-rpg-test", key = "CON", playerId = "{instance}", type = "string", value = "{{instance}.CON}");
        setUserState(category = "simple-rpg-test", key = "AGI", playerId = "{instance}", type = "string", value = "{{instance}.AGI}");
        setUserState(category = "simple-rpg-test", key = "INT", playerId = "{instance}", type = "string", value = "{{instance}.INT}");
        setUserState(category = "simple-rpg-test", key = "PSY", playerId = "{instance}", type = "string", value = "{{instance}.PSY}");
        setUserState(category = "simple-rpg-test", key = "Exp", playerId = "{instance}", type = "string", value = "{{instance}.Exp}");
        setUserState(category = "simple-rpg-test", key = "HP", playerId = "{instance}", type = "string", value = "{{instance}.HP}");
        setUserState(category = "simple-rpg-test", key = "savedBefore", playerId = "{instance}", type = "integer", value = "1");
    }
}
block releasePowerWindStaff {
    __repeat__ = -1;
    triggers {
        releasePower(varName = "instance", weapon = "custom_wind_staff");
    }
    actions {
        if(true) {
            enblastEffect(fromActor = "instance", scale = "0.5", damage = "{instance.INT} + {instance.PSY}/2 + 10", toAngle = "({instance.bodyRotation}*180/3.14+32)");
            enblastEffect(fromActor = "instance", scale = "0.5", damage = "{instance.INT} + {instance.PSY}/2 + 10", toAngle = "({instance.bodyRotation}*180/3.14+16)");
            enblastEffect(fromActor = "instance", scale = "0.5", damage = "{instance.INT} + {instance.PSY}/2 + 10", toAngle = "{instance.bodyRotation}*180/3.14");
            enblastEffect(fromActor = "instance", scale = "0.5", damage = "{instance.INT} + {instance.PSY}/2 + 10", toAngle = "({instance.bodyRotation}*180/3.14-16)");
            enblastEffect(fromActor = "instance", scale = "0.5", damage = "{instance.INT} + {instance.PSY}/2 + 10", toAngle = "({instance.bodyRotation}*180/3.14-32)");
        }
        if(false) {
            deltaHp(actorCode = "instance", value = "{instance.HP}/4");
        }
    }
    checks {
    }
}
block releasePowerIronSword {
    __repeat__ = -1;
    triggers {
        releasePower(varName = "instance", weapon = "custom_iron_sword");
    }
    actions {
        if(false) {
            enblastEffect(fromActor = "instance", scale = "0.5", damage = "{instance.INT} + {instance.PSY}/2 + 10", toAngle = "({instance.bodyRotation}*180/3.14+32)");
            enblastEffect(fromActor = "instance", scale = "0.5", damage = "{instance.INT} + {instance.PSY}/2 + 10", toAngle = "({instance.bodyRotation}*180/3.14+16)");
            enblastEffect(fromActor = "instance", scale = "0.5", damage = "{instance.INT} + {instance.PSY}/2 + 10", toAngle = "{instance.bodyRotation}*180/3.14");
            enblastEffect(fromActor = "instance", scale = "0.5", damage = "{instance.INT} + {instance.PSY}/2 + 10", toAngle = "({instance.bodyRotation}*180/3.14-16)");
            enblastEffect(fromActor = "instance", scale = "0.5", damage = "{instance.INT} + {instance.PSY}/2 + 10", toAngle = "({instance.bodyRotation}*180/3.14-32)");
        }
        if(true) {
            deltaHp(actorCode = "instance", value = "{instance.HP}/4");
        }
    }
    checks {
    }
}
block clickResetPoint {
    __repeat__ = -1;
    triggers {
        clickButton(varName = "instance", buttonId = "ResetPoint");
    }
    actions {
        setObjectVar(key = "Point", object = "instance", type = "integer", value = "{instance.Level}*2+3");
        setObjectVar(key = "STR", object = "instance", type = "integer", value = 0);
        setObjectVar(key = "CON", object = "instance", type = "integer", value = 0);
        setObjectVar(key = "AGI", object = "instance", type = "integer", value = 0);
        setObjectVar(key = "INT", object = "instance", type = "integer", value = 0);
        setObjectVar(key = "PSY", object = "instance", type = "integer", value = 0);
        actorTalk(actorId = "instance", text = "成功重設能力點，目前有{instance.Point}點能力點");
        setObjectVar(key = "HP", object = "instance", type = "integer", value = "98 + 10*{instance.CON} + 2*{instance.Level}");
        actorAttributes(actorId = "instance", attr = "maxHp", value = "{instance.HP}");
        actorAttributes(actorId = "instance", attr = "closeWeaponSpeed", value = "4-3/(1+0.05*{instance.AGI})");
        actorAttributes(actorId = "instance", attr = "weight", value = "3*pow(0.97,{instance.AGI})");
        setUserState(category = "simple-rpg-test", key = "Point", playerId = "{instance}", type = "string", value = "{{instance}.Point}");
        setUserState(category = "simple-rpg-test", key = "ExpNeeded", playerId = "{instance}", type = "string", value = "{{instance}.ExpNeeded}");
        setUserState(category = "simple-rpg-test", key = "Level", playerId = "{instance}", type = "string", value = "{{instance}.Level}");
        setUserState(category = "simple-rpg-test", key = "STR", playerId = "{instance}", type = "string", value = "{{instance}.STR}");
        setUserState(category = "simple-rpg-test", key = "CON", playerId = "{instance}", type = "string", value = "{{instance}.CON}");
        setUserState(category = "simple-rpg-test", key = "AGI", playerId = "{instance}", type = "string", value = "{{instance}.AGI}");
        setUserState(category = "simple-rpg-test", key = "INT", playerId = "{instance}", type = "string", value = "{{instance}.INT}");
        setUserState(category = "simple-rpg-test", key = "PSY", playerId = "{instance}", type = "string", value = "{{instance}.PSY}");
        setUserState(category = "simple-rpg-test", key = "Exp", playerId = "{instance}", type = "string", value = "{{instance}.Exp}");
        setUserState(category = "simple-rpg-test", key = "HP", playerId = "{instance}", type = "string", value = "{{instance}.HP}");
        setUserState(category = "simple-rpg-test", key = "savedBefore", playerId = "{instance}", type = "integer", value = "1");
    }
    checks {
    }
}
block getExp {
    __repeat__ = -1;
    triggers {
        itemPickup(actorVarname = "instance", matchKind = "equal", itemVarname = "deer_exp");
    }
    actions {
        setObjectVar(key = "Exp", object = "instance", type = "integer", value = "({instance.Exp}+1)");
        setUserState(category = "simple-rpg-test", key = "Point", playerId = "{instance}", type = "string", value = "{{instance}.Point}");
        setUserState(category = "simple-rpg-test", key = "ExpNeeded", playerId = "{instance}", type = "string", value = "{{instance}.ExpNeeded}");
        setUserState(category = "simple-rpg-test", key = "Level", playerId = "{instance}", type = "string", value = "{{instance}.Level}");
        setUserState(category = "simple-rpg-test", key = "STR", playerId = "{instance}", type = "string", value = "{{instance}.STR}");
        setUserState(category = "simple-rpg-test", key = "CON", playerId = "{instance}", type = "string", value = "{{instance}.CON}");
        setUserState(category = "simple-rpg-test", key = "AGI", playerId = "{instance}", type = "string", value = "{{instance}.AGI}");
        setUserState(category = "simple-rpg-test", key = "INT", playerId = "{instance}", type = "string", value = "{{instance}.INT}");
        setUserState(category = "simple-rpg-test", key = "PSY", playerId = "{instance}", type = "string", value = "{{instance}.PSY}");
        setUserState(category = "simple-rpg-test", key = "Exp", playerId = "{instance}", type = "string", value = "{{instance}.Exp}");
        setUserState(category = "simple-rpg-test", key = "HP", playerId = "{instance}", type = "string", value = "{{instance}.HP}");
        setUserState(category = "simple-rpg-test", key = "savedBefore", playerId = "{instance}", type = "integer", value = "1");
    }
    checks {
    }
}
block monsterDead {
    __repeat__ = -1;
    triggers {
        actorDead(actor = ActorMatch(id = "monster"), varName = "instance");
    }
    actions {
        addDropItem(itemCode = "deer_exp", x = "({instance.gamePosition.x}-16)/32", y = "({instance.gamePosition.y}-16)/32", type = "sariraFire");
    }
    checks {
    }
}
block monsterSpawn {
    __repeat__ = -1;
    __repeatInterval__ = 8000;
    checks {
        actorCount(actor = ActorMatch(id = "monster_deer", matchKind = "contain"), op = "<", value = "5");
    }
    actions {
        addActor(name = "鹿(60)", id = "monster_deer*", camp = "第三", hp = 60, x = "random(21,40)", y = "random(0,19)", localVarname = "actor", weapon1 = "fist", weapon2 = "fist", strength = "10", role = "鹿");
        actorFollow(actorId = "actor", type = "跟隨自己");
    }
    triggers {
    }
}
block levelUp {
    __repeat__ = -1;
    checks {
        forEachActor(actor = ActorMatch(controller = "玩家"), varname = "instance");
        checkNumber(lhs = "{instance.Exp}", op = ">=", rhs = "{instance.ExpNeeded}");
    }
    actions {
        setObjectVar(key = "Exp", object = "instance", type = "integer", value = "{instance.Exp}-{instance.ExpNeeded}");
        setObjectVar(key = "Level", object = "instance", type = "integer", value = "({instance.Level}+1)");
        setObjectVar(key = "Point", object = "instance", type = "integer", value = "({instance.Point}+2)");
        setObjectVar(key = "ExpNeeded", object = "instance", type = "integer", value = "{instance.Level}*2+4");
        setObjectVar(key = "HP", object = "instance", type = "integer", value = "98 + 10*{instance.CON} + 2*{instance.Level}");
        actorAttributes(actorId = "instance", attr = "maxHp", value = "{instance.HP}");
        setUserState(category = "simple-rpg-test", key = "Point", playerId = "{instance}", type = "string", value = "{{instance}.Point}");
        setUserState(category = "simple-rpg-test", key = "ExpNeeded", playerId = "{instance}", type = "string", value = "{{instance}.ExpNeeded}");
        setUserState(category = "simple-rpg-test", key = "Level", playerId = "{instance}", type = "string", value = "{{instance}.Level}");
        setUserState(category = "simple-rpg-test", key = "STR", playerId = "{instance}", type = "string", value = "{{instance}.STR}");
        setUserState(category = "simple-rpg-test", key = "CON", playerId = "{instance}", type = "string", value = "{{instance}.CON}");
        setUserState(category = "simple-rpg-test", key = "AGI", playerId = "{instance}", type = "string", value = "{{instance}.AGI}");
        setUserState(category = "simple-rpg-test", key = "INT", playerId = "{instance}", type = "string", value = "{{instance}.INT}");
        setUserState(category = "simple-rpg-test", key = "PSY", playerId = "{instance}", type = "string", value = "{{instance}.PSY}");
        setUserState(category = "simple-rpg-test", key = "Exp", playerId = "{instance}", type = "string", value = "{{instance}.Exp}");
        setUserState(category = "simple-rpg-test", key = "HP", playerId = "{instance}", type = "string", value = "{{instance}.HP}");
        setUserState(category = "simple-rpg-test", key = "savedBefore", playerId = "{instance}", type = "integer", value = "1");
    }
    triggers {
    }
}
block recover {
    __repeat__ = -1;
    __repeatInterval__ = 10000;
    checks {
        forEachActor(actor = ActorMatch(controller = "玩家"), varname = "instance");
    }
    actions {
        deltaHp(actorCode = "instance", value = "1 + {instance.PSY} + {instance.CON}/2");
    }
    triggers {
    }
}
block pressZ {
    __repeat__ = -1;
    triggers {
        keyboardPressed(varName = "instance", key = "Z");
    }
    actions {
        actorTalk(actorId = "{instance.id}", text = "【Lv{{instance.id}.Level}】\nExp:{{instance.id}.Exp}/{{instance.id}.ExpNeeded}\n尚餘能力點：{{instance.id}.Point}\n力量：{{instance.id}.STR}\n體質：{{instance.id}.CON}\n敏捷：{{instance.id}.AGI}\n智慧：{{instance.id}.INT}\n精神：{{instance.id}.PSY}");
    }
    checks {
    }
}
block staffAttack {
    __repeat__ = -1;
    triggers {
        actorFire(weapon = "custom_wind_staff", varName = "instance");
    }
    actions {
        enblastEffect(fromActor = "instance", toAngle = "{instance.bodyRotation}*180/3.14", scale = "0.5", damage = "{instance.INT} + {instance.PSY}/2 + 10");
    }
    checks {
    }
}
block swordAttack {
    __repeat__ = -1;
    triggers {
        actorHit(actor = ActorMatch(), actorVarName = "instance", hitter = ActorMatch(), hitterVarName = "attacker", weapon = "custom_iron_sword");
    }
    actions {
        deltaHp(actorCode = "instance", casterCode = "attacker", type = "流血受傷", value = "{attacker.STR}*3");
    }
    checks {
    }
}
block newPlayer {
    __repeat__ = -1;
    triggers {
        actorAdded(actor = ActorMatch(controller = "player"), varName = "instance");
    }
    actions {
        setObjectVar(key = "STR", object = "instance", type = "integer", value = 0);
        setObjectVar(key = "CON", object = "instance", type = "integer", value = 0);
        setObjectVar(key = "AGI", object = "instance", type = "integer", value = 0);
        setObjectVar(key = "INT", object = "instance", type = "integer", value = 0);
        setObjectVar(key = "PSY", object = "instance", type = "integer", value = 0);
        setObjectVar(key = "Level", object = "instance", type = "integer", value = 1);
        setObjectVar(key = "Point", object = "instance", type = "integer", value = 5);
        setObjectVar(key = "Exp", object = "instance", type = "integer", value = 0);
        setObjectVar(key = "ExpNeeded", object = "instance", type = "integer", value = 6);
        setObjectVar(key = "HP", object = "instance", type = "integer", value = 100);
        getUserState(category = "simple-rpg-test", key = "savedBefore", playerId = "{instance}", varName = "{instance}_savedBefore");
        setObjectVar(key = "completedInit", object = "instance", type = "integer", value = 1);
    }
    checks {
    }
}
block init {
    actions {
        setWeaponAbility(weapon = "小刀", operation = "無技能", level = 1);
        setWeaponAbility(weapon = "小刀", operation = "無技能", level = 2);
        setWeaponAbility(weapon = "custom_wind_staff");
        setWeaponAbility(weapon = "custom_iron_sword");
        addStuff(x = 4, y = 8, item = "custom_wind_staff");
        addStuff(x = 4, y = 8, item = "custom_wind_staff");
        addStuff(x = 4, y = 8, item = "custom_wind_staff");
        addStuff(x = 4, y = 8, item = "custom_wind_staff");
        addStuff(x = 4, y = 8, item = "custom_wind_staff");
        addMapSign(x = 4, y = 7, rotation = 90, text = "【法杖】\n武器傷害：5\n - 攻擊附帶傷害為【10+智慧+精神/2】的光彈\n技能：釋出5發光彈", showButtons = false);
        addMapSign(x = 6, y = 7, rotation = 90, text = "【鐵劍】\n武器傷害：【30+力量*3】\n技能：恢復四分之一的血量", showButtons = false);
        if(false) {
            mapWarp(fromX = 19, fromY = 9, toX = 21, toY = 9, direction = "下");
            mapWarp(fromX = 21, fromY = 9, toX = 19, toY = 9, direction = "上");
        } else if(false) {
            mapWarp(fromX = 19, fromY = 9, toX = 21, toY = 9, direction = "上");
            mapWarp(fromX = 21, fromY = 9, toX = 19, toY = 9, direction = "下");
        } else if(false) {
            mapWarp(fromX = 19, fromY = 9, toX = 21, toY = 9, direction = "左");
            mapWarp(fromX = 21, fromY = 9, toX = 19, toY = 9, direction = "右");
        } else if(true) {
            mapWarp(fromX = 19, fromY = 9, toX = 21, toY = 9, direction = "右");
            mapWarp(fromX = 21, fromY = 9, toX = 19, toY = 9, direction = "左");
        } else if(false) {
            print(type = "error", text = "Cannot set the same point as the mapWarp src and dst");
        } else {
            print(type = "error", text = "Bidirectional mapWarp requires x or y to be the same value");
        }
        if(false) {
            mapWarp(fromX = 19, fromY = 10, toX = 21, toY = 10, direction = "下");
            mapWarp(fromX = 21, fromY = 10, toX = 19, toY = 10, direction = "上");
        } else if(false) {
            mapWarp(fromX = 19, fromY = 10, toX = 21, toY = 10, direction = "上");
            mapWarp(fromX = 21, fromY = 10, toX = 19, toY = 10, direction = "下");
        } else if(false) {
            mapWarp(fromX = 19, fromY = 10, toX = 21, toY = 10, direction = "左");
            mapWarp(fromX = 21, fromY = 10, toX = 19, toY = 10, direction = "右");
        } else if(true) {
            mapWarp(fromX = 19, fromY = 10, toX = 21, toY = 10, direction = "右");
            mapWarp(fromX = 21, fromY = 10, toX = 19, toY = 10, direction = "左");
        } else if(false) {
            print(type = "error", text = "Cannot set the same point as the mapWarp src and dst");
        } else {
            print(type = "error", text = "Bidirectional mapWarp requires x or y to be the same value");
        }
        addStuff(x = 6, y = 8, item = "custom_iron_sword");
        addStuff(x = 6, y = 8, item = "custom_iron_sword");
        addStuff(x = 6, y = 8, item = "custom_iron_sword");
        addStuff(x = 6, y = 8, item = "custom_iron_sword");
        addStuff(x = 6, y = 8, item = "custom_iron_sword");
        addMapSign(x = 3, y = 17, rotation = 270, text = "【力量】\n消耗一點能力點，提升劍類傷害", buttonCode = "increaseSTR", buttonLabel = "確認");
        addMapSign(x = 5, y = 17, rotation = 270, text = "【體質】\n消耗一點能力點，增加十點血量上限及半點恢復力", buttonCode = "increaseCON", buttonLabel = "確認");
        addMapSign(x = 7, y = 17, rotation = 270, text = "【敏捷】\n消耗一點能力點，重量減少3%，並提升武器攻擊速度", buttonCode = "increaseAGI", buttonLabel = "確認");
        addMapSign(x = 9, y = 17, rotation = 270, text = "【智慧】\n消耗一點能力點，提升杖類傷害", buttonCode = "increaseINT", buttonLabel = "確認");
        addMapSign(x = 11, y = 17, rotation = 270, text = "【精神】\n消耗一點能力點，小量提升杖類傷害及提升一點恢復力", buttonCode = "increasePSY", buttonLabel = "確認");
        addMapSign(x = 1, y = 15, rotation = 0, text = "【重置能力點分配】", buttonCode = "ResetPoint", buttonLabel = "確認");
    }
    checks {
    }
    triggers {
    }
}
//---------------------------------//
//--- AST After constantFolding ---//
//---------------------------------//
__skydowLocs__ = Point(10,10);
__royalLocs__ = Point(10,10);
__thirdLocs__ = Point(10,10);
__lives__ = 9999;
__title__ = "RPG試驗";
__useDefaultItems__ = true;
__useCustomWeapons__ = true;
__customWeapons__ = [CustomWeapon(reference = "TWilightGameEventCompiler.weapon_wind_staff", code = "wind_staff", damage = 5, fireType = "單手橫劈", pivotOnHandDegree = 58, pivotOnHandX = 2, pivotOnHandY = 9, pivotOnHandXScale = "1.3", pivotOnHandYScale = "1.5", pivotOnIconDegree = -40, pivotOnIconX = 20, pivotOnIconY = 20),CustomWeapon(reference = "TWilightGameEventCompiler.weapon_iron_sword", code = "iron_sword", damage = 30, fireType = "大刀砍劈", pivotOnHandDegree = 35, pivotOnHandX = -12, pivotOnIconDegree = -40, pivotOnIconX = 27, pivotOnIconY = 14)];
__map__ = "CG.TWilightGameEventCompiler/rpg/simple_rpg.twmap";
__roomSize__ = 8;
block loadStateSaved {
    __repeat__ = -1;
    checks {
        forEachActor(actor = ActorMatch(controller = "player"), varname = "instance");
        checkNumber(lhs = "{instance.completedInit}", op = "==", rhs = 1);
        if(true) {
            checkString(str = "{{instance}_savedBefore}", matchKind = "equal", value = "1");
        }
        if(false) {
            checkString(str = "{{instance}_savedBefore}", matchKind = "equal", value = "undefined");
        }
    }
    actions {
        setObjectVar(key = "completedInit", object = "instance", type = "string", value = 2);
        if(true) {
            getUserState(category = "simple-rpg-test", key = "Point", playerId = "{instance}", varName = "{instance}_Point");
            setObjectVar(key = "Point", object = "instance", type = "integer", value = "{{instance}_Point}");
            getUserState(category = "simple-rpg-test", key = "ExpNeeded", playerId = "{instance}", varName = "{instance}_ExpNeeded");
            setObjectVar(key = "ExpNeeded", object = "instance", type = "integer", value = "{{instance}_ExpNeeded}");
            getUserState(category = "simple-rpg-test", key = "Level", playerId = "{instance}", varName = "{instance}_Level");
            setObjectVar(key = "Level", object = "instance", type = "integer", value = "{{instance}_Level}");
            getUserState(category = "simple-rpg-test", key = "STR", playerId = "{instance}", varName = "{instance}_STR");
            setObjectVar(key = "STR", object = "instance", type = "integer", value = "{{instance}_STR}");
            getUserState(category = "simple-rpg-test", key = "CON", playerId = "{instance}", varName = "{instance}_CON");
            setObjectVar(key = "CON", object = "instance", type = "integer", value = "{{instance}_CON}");
            getUserState(category = "simple-rpg-test", key = "AGI", playerId = "{instance}", varName = "{instance}_AGI");
            setObjectVar(key = "AGI", object = "instance", type = "integer", value = "{{instance}_AGI}");
            getUserState(category = "simple-rpg-test", key = "INT", playerId = "{instance}", varName = "{instance}_INT");
            setObjectVar(key = "INT", object = "instance", type = "integer", value = "{{instance}_INT}");
            getUserState(category = "simple-rpg-test", key = "PSY", playerId = "{instance}", varName = "{instance}_PSY");
            setObjectVar(key = "PSY", object = "instance", type = "integer", value = "{{instance}_PSY}");
            getUserState(category = "simple-rpg-test", key = "Exp", playerId = "{instance}", varName = "{instance}_Exp");
            setObjectVar(key = "Exp", object = "instance", type = "integer", value = "{{instance}_Exp}");
            getUserState(category = "simple-rpg-test", key = "HP", playerId = "{instance}", varName = "{instance}_HP");
            setObjectVar(key = "HP", object = "instance", type = "integer", value = "{{instance}_HP}");
            setObjectVar(key = "HP", object = "instance", type = "integer", value = "98 + 10*{instance.CON} + 2*{instance.Level}");
            actorAttributes(actorId = "instance", attr = "maxHp", value = "{instance.HP}");
            actorAttributes(actorId = "instance", attr = "closeWeaponSpeed", value = "4-3/(1+0.05*{instance.AGI})");
            actorAttributes(actorId = "instance", attr = "weight", value = "3*pow(0.97,{instance.AGI})");
            deltaHp(actorCode = "instance", type = "heal", value = 9999);
        }
    }
    triggers {
    }
}
block loadStateNew {
    __repeat__ = -1;
    checks {
        forEachActor(actor = ActorMatch(controller = "player"), varname = "instance");
        checkNumber(lhs = "{instance.completedInit}", op = "==", rhs = 1);
        if(false) {
            checkString(str = "{{instance}_savedBefore}", matchKind = "equal", value = "1");
        }
        if(true) {
            checkString(str = "{{instance}_savedBefore}", matchKind = "equal", value = "undefined");
        }
    }
    actions {
        setObjectVar(key = "completedInit", object = "instance", type = "string", value = 2);
        if(false) {
            getUserState(category = "simple-rpg-test", key = "Point", playerId = "{instance}", varName = "{instance}_Point");
            setObjectVar(key = "Point", object = "instance", type = "integer", value = "{{instance}_Point}");
            getUserState(category = "simple-rpg-test", key = "ExpNeeded", playerId = "{instance}", varName = "{instance}_ExpNeeded");
            setObjectVar(key = "ExpNeeded", object = "instance", type = "integer", value = "{{instance}_ExpNeeded}");
            getUserState(category = "simple-rpg-test", key = "Level", playerId = "{instance}", varName = "{instance}_Level");
            setObjectVar(key = "Level", object = "instance", type = "integer", value = "{{instance}_Level}");
            getUserState(category = "simple-rpg-test", key = "STR", playerId = "{instance}", varName = "{instance}_STR");
            setObjectVar(key = "STR", object = "instance", type = "integer", value = "{{instance}_STR}");
            getUserState(category = "simple-rpg-test", key = "CON", playerId = "{instance}", varName = "{instance}_CON");
            setObjectVar(key = "CON", object = "instance", type = "integer", value = "{{instance}_CON}");
            getUserState(category = "simple-rpg-test", key = "AGI", playerId = "{instance}", varName = "{instance}_AGI");
            setObjectVar(key = "AGI", object = "instance", type = "integer", value = "{{instance}_AGI}");
            getUserState(category = "simple-rpg-test", key = "INT", playerId = "{instance}", varName = "{instance}_INT");
            setObjectVar(key = "INT", object = "instance", type = "integer", value = "{{instance}_INT}");
            getUserState(category = "simple-rpg-test", key = "PSY", playerId = "{instance}", varName = "{instance}_PSY");
            setObjectVar(key = "PSY", object = "instance", type = "integer", value = "{{instance}_PSY}");
            getUserState(category = "simple-rpg-test", key = "Exp", playerId = "{instance}", varName = "{instance}_Exp");
            setObjectVar(key = "Exp", object = "instance", type = "integer", value = "{{instance}_Exp}");
            getUserState(category = "simple-rpg-test", key = "HP", playerId = "{instance}", varName = "{instance}_HP");
            setObjectVar(key = "HP", object = "instance", type = "integer", value = "{{instance}_HP}");
            setObjectVar(key = "HP", object = "instance", type = "integer", value = "98 + 10*{instance.CON} + 2*{instance.Level}");
            actorAttributes(actorId = "instance", attr = "maxHp", value = "{instance.HP}");
            actorAttributes(actorId = "instance", attr = "closeWeaponSpeed", value = "4-3/(1+0.05*{instance.AGI})");
            actorAttributes(actorId = "instance", attr = "weight", value = "3*pow(0.97,{instance.AGI})");
            deltaHp(actorCode = "instance", type = "heal", value = 9999);
        }
    }
    triggers {
    }
}
block clickIncreaseSTR {
    __repeat__ = -1;
    triggers {
        clickButton(varName = "instance", buttonId = "increaseSTR");
    }
    checks {
        checkNumber(lhs = "{instance.Point}", op = ">", rhs = 0);
    }
    actions {
        setObjectVar(key = "Point", object = "instance", type = "integer", value = "{instance.Point}-1");
        setObjectVar(key = "STR", object = "instance", type = "integer", value = "{instance.STR}+1");
        actorTalk(actorId = "instance", text = "成功提升一點力量，尚餘{instance.Point}點能力點");
        setObjectVar(key = "HP", object = "instance", type = "integer", value = "98 + 10*{instance.CON} + 2*{instance.Level}");
        actorAttributes(actorId = "instance", attr = "maxHp", value = "{instance.HP}");
        actorAttributes(actorId = "instance", attr = "closeWeaponSpeed", value = "4-3/(1+0.05*{instance.AGI})");
        actorAttributes(actorId = "instance", attr = "weight", value = "3*pow(0.97,{instance.AGI})");
        setUserState(category = "simple-rpg-test", key = "Point", playerId = "{instance}", type = "string", value = "{{instance}.Point}");
        setUserState(category = "simple-rpg-test", key = "ExpNeeded", playerId = "{instance}", type = "string", value = "{{instance}.ExpNeeded}");
        setUserState(category = "simple-rpg-test", key = "Level", playerId = "{instance}", type = "string", value = "{{instance}.Level}");
        setUserState(category = "simple-rpg-test", key = "STR", playerId = "{instance}", type = "string", value = "{{instance}.STR}");
        setUserState(category = "simple-rpg-test", key = "CON", playerId = "{instance}", type = "string", value = "{{instance}.CON}");
        setUserState(category = "simple-rpg-test", key = "AGI", playerId = "{instance}", type = "string", value = "{{instance}.AGI}");
        setUserState(category = "simple-rpg-test", key = "INT", playerId = "{instance}", type = "string", value = "{{instance}.INT}");
        setUserState(category = "simple-rpg-test", key = "PSY", playerId = "{instance}", type = "string", value = "{{instance}.PSY}");
        setUserState(category = "simple-rpg-test", key = "Exp", playerId = "{instance}", type = "string", value = "{{instance}.Exp}");
        setUserState(category = "simple-rpg-test", key = "HP", playerId = "{instance}", type = "string", value = "{{instance}.HP}");
        setUserState(category = "simple-rpg-test", key = "savedBefore", playerId = "{instance}", type = "integer", value = "1");
    }
}
block clickIncreaseCON {
    __repeat__ = -1;
    triggers {
        clickButton(varName = "instance", buttonId = "increaseCON");
    }
    checks {
        checkNumber(lhs = "{instance.Point}", op = ">", rhs = 0);
    }
    actions {
        setObjectVar(key = "Point", object = "instance", type = "integer", value = "{instance.Point}-1");
        setObjectVar(key = "CON", object = "instance", type = "integer", value = "{instance.CON}+1");
        actorTalk(actorId = "instance", text = "成功提升一點體質，尚餘{instance.Point}點能力點");
        setObjectVar(key = "HP", object = "instance", type = "integer", value = "98 + 10*{instance.CON} + 2*{instance.Level}");
        actorAttributes(actorId = "instance", attr = "maxHp", value = "{instance.HP}");
        actorAttributes(actorId = "instance", attr = "closeWeaponSpeed", value = "4-3/(1+0.05*{instance.AGI})");
        actorAttributes(actorId = "instance", attr = "weight", value = "3*pow(0.97,{instance.AGI})");
        setUserState(category = "simple-rpg-test", key = "Point", playerId = "{instance}", type = "string", value = "{{instance}.Point}");
        setUserState(category = "simple-rpg-test", key = "ExpNeeded", playerId = "{instance}", type = "string", value = "{{instance}.ExpNeeded}");
        setUserState(category = "simple-rpg-test", key = "Level", playerId = "{instance}", type = "string", value = "{{instance}.Level}");
        setUserState(category = "simple-rpg-test", key = "STR", playerId = "{instance}", type = "string", value = "{{instance}.STR}");
        setUserState(category = "simple-rpg-test", key = "CON", playerId = "{instance}", type = "string", value = "{{instance}.CON}");
        setUserState(category = "simple-rpg-test", key = "AGI", playerId = "{instance}", type = "string", value = "{{instance}.AGI}");
        setUserState(category = "simple-rpg-test", key = "INT", playerId = "{instance}", type = "string", value = "{{instance}.INT}");
        setUserState(category = "simple-rpg-test", key = "PSY", playerId = "{instance}", type = "string", value = "{{instance}.PSY}");
        setUserState(category = "simple-rpg-test", key = "Exp", playerId = "{instance}", type = "string", value = "{{instance}.Exp}");
        setUserState(category = "simple-rpg-test", key = "HP", playerId = "{instance}", type = "string", value = "{{instance}.HP}");
        setUserState(category = "simple-rpg-test", key = "savedBefore", playerId = "{instance}", type = "integer", value = "1");
    }
}
block clickIncreaseAGI {
    __repeat__ = -1;
    triggers {
        clickButton(varName = "instance", buttonId = "increaseAGI");
    }
    checks {
        checkNumber(lhs = "{instance.Point}", op = ">", rhs = 0);
    }
    actions {
        setObjectVar(key = "Point", object = "instance", type = "integer", value = "{instance.Point}-1");
        setObjectVar(key = "AGI", object = "instance", type = "integer", value = "{instance.AGI}+1");
        actorTalk(actorId = "instance", text = "成功提升一點敏捷，尚餘{instance.Point}點能力點");
        setObjectVar(key = "HP", object = "instance", type = "integer", value = "98 + 10*{instance.CON} + 2*{instance.Level}");
        actorAttributes(actorId = "instance", attr = "maxHp", value = "{instance.HP}");
        actorAttributes(actorId = "instance", attr = "closeWeaponSpeed", value = "4-3/(1+0.05*{instance.AGI})");
        actorAttributes(actorId = "instance", attr = "weight", value = "3*pow(0.97,{instance.AGI})");
        setUserState(category = "simple-rpg-test", key = "Point", playerId = "{instance}", type = "string", value = "{{instance}.Point}");
        setUserState(category = "simple-rpg-test", key = "ExpNeeded", playerId = "{instance}", type = "string", value = "{{instance}.ExpNeeded}");
        setUserState(category = "simple-rpg-test", key = "Level", playerId = "{instance}", type = "string", value = "{{instance}.Level}");
        setUserState(category = "simple-rpg-test", key = "STR", playerId = "{instance}", type = "string", value = "{{instance}.STR}");
        setUserState(category = "simple-rpg-test", key = "CON", playerId = "{instance}", type = "string", value = "{{instance}.CON}");
        setUserState(category = "simple-rpg-test", key = "AGI", playerId = "{instance}", type = "string", value = "{{instance}.AGI}");
        setUserState(category = "simple-rpg-test", key = "INT", playerId = "{instance}", type = "string", value = "{{instance}.INT}");
        setUserState(category = "simple-rpg-test", key = "PSY", playerId = "{instance}", type = "string", value = "{{instance}.PSY}");
        setUserState(category = "simple-rpg-test", key = "Exp", playerId = "{instance}", type = "string", value = "{{instance}.Exp}");
        setUserState(category = "simple-rpg-test", key = "HP", playerId = "{instance}", type = "string", value = "{{instance}.HP}");
        setUserState(category = "simple-rpg-test", key = "savedBefore", playerId = "{instance}", type = "integer", value = "1");
    }
}
block clickIncreaseINT {
    __repeat__ = -1;
    triggers {
        clickButton(varName = "instance", buttonId = "increaseINT");
    }
    checks {
        checkNumber(lhs = "{instance.Point}", op = ">", rhs = 0);
    }
    actions {
        setObjectVar(key = "Point", object = "instance", type = "integer", value = "{instance.Point}-1");
        setObjectVar(key = "INT", object = "instance", type = "integer", value = "{instance.INT}+1");
        actorTalk(actorId = "instance", text = "成功提升一點智慧，尚餘{instance.Point}點能力點");
        setObjectVar(key = "HP", object = "instance", type = "integer", value = "98 + 10*{instance.CON} + 2*{instance.Level}");
        actorAttributes(actorId = "instance", attr = "maxHp", value = "{instance.HP}");
        actorAttributes(actorId = "instance", attr = "closeWeaponSpeed", value = "4-3/(1+0.05*{instance.AGI})");
        actorAttributes(actorId = "instance", attr = "weight", value = "3*pow(0.97,{instance.AGI})");
        setUserState(category = "simple-rpg-test", key = "Point", playerId = "{instance}", type = "string", value = "{{instance}.Point}");
        setUserState(category = "simple-rpg-test", key = "ExpNeeded", playerId = "{instance}", type = "string", value = "{{instance}.ExpNeeded}");
        setUserState(category = "simple-rpg-test", key = "Level", playerId = "{instance}", type = "string", value = "{{instance}.Level}");
        setUserState(category = "simple-rpg-test", key = "STR", playerId = "{instance}", type = "string", value = "{{instance}.STR}");
        setUserState(category = "simple-rpg-test", key = "CON", playerId = "{instance}", type = "string", value = "{{instance}.CON}");
        setUserState(category = "simple-rpg-test", key = "AGI", playerId = "{instance}", type = "string", value = "{{instance}.AGI}");
        setUserState(category = "simple-rpg-test", key = "INT", playerId = "{instance}", type = "string", value = "{{instance}.INT}");
        setUserState(category = "simple-rpg-test", key = "PSY", playerId = "{instance}", type = "string", value = "{{instance}.PSY}");
        setUserState(category = "simple-rpg-test", key = "Exp", playerId = "{instance}", type = "string", value = "{{instance}.Exp}");
        setUserState(category = "simple-rpg-test", key = "HP", playerId = "{instance}", type = "string", value = "{{instance}.HP}");
        setUserState(category = "simple-rpg-test", key = "savedBefore", playerId = "{instance}", type = "integer", value = "1");
    }
}
block clickIncreasePSY {
    __repeat__ = -1;
    triggers {
        clickButton(varName = "instance", buttonId = "increasePSY");
    }
    checks {
        checkNumber(lhs = "{instance.Point}", op = ">", rhs = 0);
    }
    actions {
        setObjectVar(key = "Point", object = "instance", type = "integer", value = "{instance.Point}-1");
        setObjectVar(key = "PSY", object = "instance", type = "integer", value = "{instance.PSY}+1");
        actorTalk(actorId = "instance", text = "成功提升一點精神，尚餘{instance.Point}點能力點");
        setObjectVar(key = "HP", object = "instance", type = "integer", value = "98 + 10*{instance.CON} + 2*{instance.Level}");
        actorAttributes(actorId = "instance", attr = "maxHp", value = "{instance.HP}");
        actorAttributes(actorId = "instance", attr = "closeWeaponSpeed", value = "4-3/(1+0.05*{instance.AGI})");
        actorAttributes(actorId = "instance", attr = "weight", value = "3*pow(0.97,{instance.AGI})");
        setUserState(category = "simple-rpg-test", key = "Point", playerId = "{instance}", type = "string", value = "{{instance}.Point}");
        setUserState(category = "simple-rpg-test", key = "ExpNeeded", playerId = "{instance}", type = "string", value = "{{instance}.ExpNeeded}");
        setUserState(category = "simple-rpg-test", key = "Level", playerId = "{instance}", type = "string", value = "{{instance}.Level}");
        setUserState(category = "simple-rpg-test", key = "STR", playerId = "{instance}", type = "string", value = "{{instance}.STR}");
        setUserState(category = "simple-rpg-test", key = "CON", playerId = "{instance}", type = "string", value = "{{instance}.CON}");
        setUserState(category = "simple-rpg-test", key = "AGI", playerId = "{instance}", type = "string", value = "{{instance}.AGI}");
        setUserState(category = "simple-rpg-test", key = "INT", playerId = "{instance}", type = "string", value = "{{instance}.INT}");
        setUserState(category = "simple-rpg-test", key = "PSY", playerId = "{instance}", type = "string", value = "{{instance}.PSY}");
        setUserState(category = "simple-rpg-test", key = "Exp", playerId = "{instance}", type = "string", value = "{{instance}.Exp}");
        setUserState(category = "simple-rpg-test", key = "HP", playerId = "{instance}", type = "string", value = "{{instance}.HP}");
        setUserState(category = "simple-rpg-test", key = "savedBefore", playerId = "{instance}", type = "integer", value = "1");
    }
}
block releasePowerWindStaff {
    __repeat__ = -1;
    triggers {
        releasePower(varName = "instance", weapon = "custom_wind_staff");
    }
    actions {
        if(true) {
            enblastEffect(fromActor = "instance", scale = "0.5", damage = "{instance.INT} + {instance.PSY}/2 + 10", toAngle = "({instance.bodyRotation}*180/3.14+32)");
            enblastEffect(fromActor = "instance", scale = "0.5", damage = "{instance.INT} + {instance.PSY}/2 + 10", toAngle = "({instance.bodyRotation}*180/3.14+16)");
            enblastEffect(fromActor = "instance", scale = "0.5", damage = "{instance.INT} + {instance.PSY}/2 + 10", toAngle = "{instance.bodyRotation}*180/3.14");
            enblastEffect(fromActor = "instance", scale = "0.5", damage = "{instance.INT} + {instance.PSY}/2 + 10", toAngle = "({instance.bodyRotation}*180/3.14-16)");
            enblastEffect(fromActor = "instance", scale = "0.5", damage = "{instance.INT} + {instance.PSY}/2 + 10", toAngle = "({instance.bodyRotation}*180/3.14-32)");
        }
        if(false) {
            deltaHp(actorCode = "instance", value = "{instance.HP}/4");
        }
    }
    checks {
    }
}
block releasePowerIronSword {
    __repeat__ = -1;
    triggers {
        releasePower(varName = "instance", weapon = "custom_iron_sword");
    }
    actions {
        if(false) {
            enblastEffect(fromActor = "instance", scale = "0.5", damage = "{instance.INT} + {instance.PSY}/2 + 10", toAngle = "({instance.bodyRotation}*180/3.14+32)");
            enblastEffect(fromActor = "instance", scale = "0.5", damage = "{instance.INT} + {instance.PSY}/2 + 10", toAngle = "({instance.bodyRotation}*180/3.14+16)");
            enblastEffect(fromActor = "instance", scale = "0.5", damage = "{instance.INT} + {instance.PSY}/2 + 10", toAngle = "{instance.bodyRotation}*180/3.14");
            enblastEffect(fromActor = "instance", scale = "0.5", damage = "{instance.INT} + {instance.PSY}/2 + 10", toAngle = "({instance.bodyRotation}*180/3.14-16)");
            enblastEffect(fromActor = "instance", scale = "0.5", damage = "{instance.INT} + {instance.PSY}/2 + 10", toAngle = "({instance.bodyRotation}*180/3.14-32)");
        }
        if(true) {
            deltaHp(actorCode = "instance", value = "{instance.HP}/4");
        }
    }
    checks {
    }
}
block clickResetPoint {
    __repeat__ = -1;
    triggers {
        clickButton(varName = "instance", buttonId = "ResetPoint");
    }
    actions {
        setObjectVar(key = "Point", object = "instance", type = "integer", value = "{instance.Level}*2+3");
        setObjectVar(key = "STR", object = "instance", type = "integer", value = 0);
        setObjectVar(key = "CON", object = "instance", type = "integer", value = 0);
        setObjectVar(key = "AGI", object = "instance", type = "integer", value = 0);
        setObjectVar(key = "INT", object = "instance", type = "integer", value = 0);
        setObjectVar(key = "PSY", object = "instance", type = "integer", value = 0);
        actorTalk(actorId = "instance", text = "成功重設能力點，目前有{instance.Point}點能力點");
        setObjectVar(key = "HP", object = "instance", type = "integer", value = "98 + 10*{instance.CON} + 2*{instance.Level}");
        actorAttributes(actorId = "instance", attr = "maxHp", value = "{instance.HP}");
        actorAttributes(actorId = "instance", attr = "closeWeaponSpeed", value = "4-3/(1+0.05*{instance.AGI})");
        actorAttributes(actorId = "instance", attr = "weight", value = "3*pow(0.97,{instance.AGI})");
        setUserState(category = "simple-rpg-test", key = "Point", playerId = "{instance}", type = "string", value = "{{instance}.Point}");
        setUserState(category = "simple-rpg-test", key = "ExpNeeded", playerId = "{instance}", type = "string", value = "{{instance}.ExpNeeded}");
        setUserState(category = "simple-rpg-test", key = "Level", playerId = "{instance}", type = "string", value = "{{instance}.Level}");
        setUserState(category = "simple-rpg-test", key = "STR", playerId = "{instance}", type = "string", value = "{{instance}.STR}");
        setUserState(category = "simple-rpg-test", key = "CON", playerId = "{instance}", type = "string", value = "{{instance}.CON}");
        setUserState(category = "simple-rpg-test", key = "AGI", playerId = "{instance}", type = "string", value = "{{instance}.AGI}");
        setUserState(category = "simple-rpg-test", key = "INT", playerId = "{instance}", type = "string", value = "{{instance}.INT}");
        setUserState(category = "simple-rpg-test", key = "PSY", playerId = "{instance}", type = "string", value = "{{instance}.PSY}");
        setUserState(category = "simple-rpg-test", key = "Exp", playerId = "{instance}", type = "string", value = "{{instance}.Exp}");
        setUserState(category = "simple-rpg-test", key = "HP", playerId = "{instance}", type = "string", value = "{{instance}.HP}");
        setUserState(category = "simple-rpg-test", key = "savedBefore", playerId = "{instance}", type = "integer", value = "1");
    }
    checks {
    }
}
block getExp {
    __repeat__ = -1;
    triggers {
        itemPickup(actorVarname = "instance", matchKind = "equal", itemVarname = "deer_exp");
    }
    actions {
        setObjectVar(key = "Exp", object = "instance", type = "integer", value = "({instance.Exp}+1)");
        setUserState(category = "simple-rpg-test", key = "Point", playerId = "{instance}", type = "string", value = "{{instance}.Point}");
        setUserState(category = "simple-rpg-test", key = "ExpNeeded", playerId = "{instance}", type = "string", value = "{{instance}.ExpNeeded}");
        setUserState(category = "simple-rpg-test", key = "Level", playerId = "{instance}", type = "string", value = "{{instance}.Level}");
        setUserState(category = "simple-rpg-test", key = "STR", playerId = "{instance}", type = "string", value = "{{instance}.STR}");
        setUserState(category = "simple-rpg-test", key = "CON", playerId = "{instance}", type = "string", value = "{{instance}.CON}");
        setUserState(category = "simple-rpg-test", key = "AGI", playerId = "{instance}", type = "string", value = "{{instance}.AGI}");
        setUserState(category = "simple-rpg-test", key = "INT", playerId = "{instance}", type = "string", value = "{{instance}.INT}");
        setUserState(category = "simple-rpg-test", key = "PSY", playerId = "{instance}", type = "string", value = "{{instance}.PSY}");
        setUserState(category = "simple-rpg-test", key = "Exp", playerId = "{instance}", type = "string", value = "{{instance}.Exp}");
        setUserState(category = "simple-rpg-test", key = "HP", playerId = "{instance}", type = "string", value = "{{instance}.HP}");
        setUserState(category = "simple-rpg-test", key = "savedBefore", playerId = "{instance}", type = "integer", value = "1");
    }
    checks {
    }
}
block monsterDead {
    __repeat__ = -1;
    triggers {
        actorDead(actor = ActorMatch(id = "monster"), varName = "instance");
    }
    actions {
        addDropItem(itemCode = "deer_exp", x = "({instance.gamePosition.x}-16)/32", y = "({instance.gamePosition.y}-16)/32", type = "sariraFire");
    }
    checks {
    }
}
block monsterSpawn {
    __repeat__ = -1;
    __repeatInterval__ = 8000;
    checks {
        actorCount(actor = ActorMatch(id = "monster_deer", matchKind = "contain"), op = "<", value = "5");
    }
    actions {
        addActor(name = "鹿(60)", id = "monster_deer*", camp = "第三", hp = 60, x = "random(21,40)", y = "random(0,19)", localVarname = "actor", weapon1 = "fist", weapon2 = "fist", strength = "10", role = "鹿");
        actorFollow(actorId = "actor", type = "跟隨自己");
    }
    triggers {
    }
}
block levelUp {
    __repeat__ = -1;
    checks {
        forEachActor(actor = ActorMatch(controller = "玩家"), varname = "instance");
        checkNumber(lhs = "{instance.Exp}", op = ">=", rhs = "{instance.ExpNeeded}");
    }
    actions {
        setObjectVar(key = "Exp", object = "instance", type = "integer", value = "{instance.Exp}-{instance.ExpNeeded}");
        setObjectVar(key = "Level", object = "instance", type = "integer", value = "({instance.Level}+1)");
        setObjectVar(key = "Point", object = "instance", type = "integer", value = "({instance.Point}+2)");
        setObjectVar(key = "ExpNeeded", object = "instance", type = "integer", value = "{instance.Level}*2+4");
        setObjectVar(key = "HP", object = "instance", type = "integer", value = "98 + 10*{instance.CON} + 2*{instance.Level}");
        actorAttributes(actorId = "instance", attr = "maxHp", value = "{instance.HP}");
        setUserState(category = "simple-rpg-test", key = "Point", playerId = "{instance}", type = "string", value = "{{instance}.Point}");
        setUserState(category = "simple-rpg-test", key = "ExpNeeded", playerId = "{instance}", type = "string", value = "{{instance}.ExpNeeded}");
        setUserState(category = "simple-rpg-test", key = "Level", playerId = "{instance}", type = "string", value = "{{instance}.Level}");
        setUserState(category = "simple-rpg-test", key = "STR", playerId = "{instance}", type = "string", value = "{{instance}.STR}");
        setUserState(category = "simple-rpg-test", key = "CON", playerId = "{instance}", type = "string", value = "{{instance}.CON}");
        setUserState(category = "simple-rpg-test", key = "AGI", playerId = "{instance}", type = "string", value = "{{instance}.AGI}");
        setUserState(category = "simple-rpg-test", key = "INT", playerId = "{instance}", type = "string", value = "{{instance}.INT}");
        setUserState(category = "simple-rpg-test", key = "PSY", playerId = "{instance}", type = "string", value = "{{instance}.PSY}");
        setUserState(category = "simple-rpg-test", key = "Exp", playerId = "{instance}", type = "string", value = "{{instance}.Exp}");
        setUserState(category = "simple-rpg-test", key = "HP", playerId = "{instance}", type = "string", value = "{{instance}.HP}");
        setUserState(category = "simple-rpg-test", key = "savedBefore", playerId = "{instance}", type = "integer", value = "1");
    }
    triggers {
    }
}
block recover {
    __repeat__ = -1;
    __repeatInterval__ = 10000;
    checks {
        forEachActor(actor = ActorMatch(controller = "玩家"), varname = "instance");
    }
    actions {
        deltaHp(actorCode = "instance", value = "1 + {instance.PSY} + {instance.CON}/2");
    }
    triggers {
    }
}
block pressZ {
    __repeat__ = -1;
    triggers {
        keyboardPressed(varName = "instance", key = "Z");
    }
    actions {
        actorTalk(actorId = "{instance.id}", text = "【Lv{{instance.id}.Level}】\nExp:{{instance.id}.Exp}/{{instance.id}.ExpNeeded}\n尚餘能力點：{{instance.id}.Point}\n力量：{{instance.id}.STR}\n體質：{{instance.id}.CON}\n敏捷：{{instance.id}.AGI}\n智慧：{{instance.id}.INT}\n精神：{{instance.id}.PSY}");
    }
    checks {
    }
}
block staffAttack {
    __repeat__ = -1;
    triggers {
        actorFire(weapon = "custom_wind_staff", varName = "instance");
    }
    actions {
        enblastEffect(fromActor = "instance", toAngle = "{instance.bodyRotation}*180/3.14", scale = "0.5", damage = "{instance.INT} + {instance.PSY}/2 + 10");
    }
    checks {
    }
}
block swordAttack {
    __repeat__ = -1;
    triggers {
        actorHit(actor = ActorMatch(), actorVarName = "instance", hitter = ActorMatch(), hitterVarName = "attacker", weapon = "custom_iron_sword");
    }
    actions {
        deltaHp(actorCode = "instance", casterCode = "attacker", type = "流血受傷", value = "{attacker.STR}*3");
    }
    checks {
    }
}
block newPlayer {
    __repeat__ = -1;
    triggers {
        actorAdded(actor = ActorMatch(controller = "player"), varName = "instance");
    }
    actions {
        setObjectVar(key = "STR", object = "instance", type = "integer", value = 0);
        setObjectVar(key = "CON", object = "instance", type = "integer", value = 0);
        setObjectVar(key = "AGI", object = "instance", type = "integer", value = 0);
        setObjectVar(key = "INT", object = "instance", type = "integer", value = 0);
        setObjectVar(key = "PSY", object = "instance", type = "integer", value = 0);
        setObjectVar(key = "Level", object = "instance", type = "integer", value = 1);
        setObjectVar(key = "Point", object = "instance", type = "integer", value = 5);
        setObjectVar(key = "Exp", object = "instance", type = "integer", value = 0);
        setObjectVar(key = "ExpNeeded", object = "instance", type = "integer", value = 6);
        setObjectVar(key = "HP", object = "instance", type = "integer", value = 100);
        getUserState(category = "simple-rpg-test", key = "savedBefore", playerId = "{instance}", varName = "{instance}_savedBefore");
        setObjectVar(key = "completedInit", object = "instance", type = "integer", value = 1);
    }
    checks {
    }
}
block init {
    actions {
        setWeaponAbility(weapon = "小刀", operation = "無技能", level = 1);
        setWeaponAbility(weapon = "小刀", operation = "無技能", level = 2);
        setWeaponAbility(weapon = "custom_wind_staff");
        setWeaponAbility(weapon = "custom_iron_sword");
        addStuff(x = 4, y = 8, item = "custom_wind_staff");
        addStuff(x = 4, y = 8, item = "custom_wind_staff");
        addStuff(x = 4, y = 8, item = "custom_wind_staff");
        addStuff(x = 4, y = 8, item = "custom_wind_staff");
        addStuff(x = 4, y = 8, item = "custom_wind_staff");
        addMapSign(x = 4, y = 7, rotation = 90, text = "【法杖】\n武器傷害：5\n - 攻擊附帶傷害為【10+智慧+精神/2】的光彈\n技能：釋出5發光彈", showButtons = false);
        addMapSign(x = 6, y = 7, rotation = 90, text = "【鐵劍】\n武器傷害：【30+力量*3】\n技能：恢復四分之一的血量", showButtons = false);
        if(false) {
            mapWarp(fromX = 19, fromY = 9, toX = 21, toY = 9, direction = "下");
            mapWarp(fromX = 21, fromY = 9, toX = 19, toY = 9, direction = "上");
        } else if(false) {
            mapWarp(fromX = 19, fromY = 9, toX = 21, toY = 9, direction = "上");
            mapWarp(fromX = 21, fromY = 9, toX = 19, toY = 9, direction = "下");
        } else if(false) {
            mapWarp(fromX = 19, fromY = 9, toX = 21, toY = 9, direction = "左");
            mapWarp(fromX = 21, fromY = 9, toX = 19, toY = 9, direction = "右");
        } else if(true) {
            mapWarp(fromX = 19, fromY = 9, toX = 21, toY = 9, direction = "右");
            mapWarp(fromX = 21, fromY = 9, toX = 19, toY = 9, direction = "左");
        } else if(false) {
            print(type = "error", text = "Cannot set the same point as the mapWarp src and dst");
        } else {
            print(type = "error", text = "Bidirectional mapWarp requires x or y to be the same value");
        }
        if(false) {
            mapWarp(fromX = 19, fromY = 10, toX = 21, toY = 10, direction = "下");
            mapWarp(fromX = 21, fromY = 10, toX = 19, toY = 10, direction = "上");
        } else if(false) {
            mapWarp(fromX = 19, fromY = 10, toX = 21, toY = 10, direction = "上");
            mapWarp(fromX = 21, fromY = 10, toX = 19, toY = 10, direction = "下");
        } else if(false) {
            mapWarp(fromX = 19, fromY = 10, toX = 21, toY = 10, direction = "左");
            mapWarp(fromX = 21, fromY = 10, toX = 19, toY = 10, direction = "右");
        } else if(true) {
            mapWarp(fromX = 19, fromY = 10, toX = 21, toY = 10, direction = "右");
            mapWarp(fromX = 21, fromY = 10, toX = 19, toY = 10, direction = "左");
        } else if(false) {
            print(type = "error", text = "Cannot set the same point as the mapWarp src and dst");
        } else {
            print(type = "error", text = "Bidirectional mapWarp requires x or y to be the same value");
        }
        addStuff(x = 6, y = 8, item = "custom_iron_sword");
        addStuff(x = 6, y = 8, item = "custom_iron_sword");
        addStuff(x = 6, y = 8, item = "custom_iron_sword");
        addStuff(x = 6, y = 8, item = "custom_iron_sword");
        addStuff(x = 6, y = 8, item = "custom_iron_sword");
        addMapSign(x = 3, y = 17, rotation = 270, text = "【力量】\n消耗一點能力點，提升劍類傷害", buttonCode = "increaseSTR", buttonLabel = "確認");
        addMapSign(x = 5, y = 17, rotation = 270, text = "【體質】\n消耗一點能力點，增加十點血量上限及半點恢復力", buttonCode = "increaseCON", buttonLabel = "確認");
        addMapSign(x = 7, y = 17, rotation = 270, text = "【敏捷】\n消耗一點能力點，重量減少3%，並提升武器攻擊速度", buttonCode = "increaseAGI", buttonLabel = "確認");
        addMapSign(x = 9, y = 17, rotation = 270, text = "【智慧】\n消耗一點能力點，提升杖類傷害", buttonCode = "increaseINT", buttonLabel = "確認");
        addMapSign(x = 11, y = 17, rotation = 270, text = "【精神】\n消耗一點能力點，小量提升杖類傷害及提升一點恢復力", buttonCode = "increasePSY", buttonLabel = "確認");
        addMapSign(x = 1, y = 15, rotation = 0, text = "【重置能力點分配】", buttonCode = "ResetPoint", buttonLabel = "確認");
    }
    checks {
    }
    triggers {
    }
}
//----------------------------------------//
//--- AST After ifStatementPropagation ---//
//----------------------------------------//
__skydowLocs__ = Point(10,10);
__royalLocs__ = Point(10,10);
__thirdLocs__ = Point(10,10);
__lives__ = 9999;
__title__ = "RPG試驗";
__useDefaultItems__ = true;
__useCustomWeapons__ = true;
__customWeapons__ = [CustomWeapon(reference = "TWilightGameEventCompiler.weapon_wind_staff", code = "wind_staff", damage = 5, fireType = "單手橫劈", pivotOnHandDegree = 58, pivotOnHandX = 2, pivotOnHandY = 9, pivotOnHandXScale = "1.3", pivotOnHandYScale = "1.5", pivotOnIconDegree = -40, pivotOnIconX = 20, pivotOnIconY = 20),CustomWeapon(reference = "TWilightGameEventCompiler.weapon_iron_sword", code = "iron_sword", damage = 30, fireType = "大刀砍劈", pivotOnHandDegree = 35, pivotOnHandX = -12, pivotOnIconDegree = -40, pivotOnIconX = 27, pivotOnIconY = 14)];
__map__ = "CG.TWilightGameEventCompiler/rpg/simple_rpg.twmap";
__roomSize__ = 8;
block loadStateSaved {
    __repeat__ = -1;
    checks {
        forEachActor(actor = ActorMatch(controller = "player"), varname = "instance");
        checkNumber(lhs = "{instance.completedInit}", op = "==", rhs = 1);
        checkString(str = "{{instance}_savedBefore}", matchKind = "equal", value = "1");
    }
    actions {
        setObjectVar(key = "completedInit", object = "instance", type = "string", value = 2);
        getUserState(category = "simple-rpg-test", key = "Point", playerId = "{instance}", varName = "{instance}_Point");
        setObjectVar(key = "Point", object = "instance", type = "integer", value = "{{instance}_Point}");
        getUserState(category = "simple-rpg-test", key = "ExpNeeded", playerId = "{instance}", varName = "{instance}_ExpNeeded");
        setObjectVar(key = "ExpNeeded", object = "instance", type = "integer", value = "{{instance}_ExpNeeded}");
        getUserState(category = "simple-rpg-test", key = "Level", playerId = "{instance}", varName = "{instance}_Level");
        setObjectVar(key = "Level", object = "instance", type = "integer", value = "{{instance}_Level}");
        getUserState(category = "simple-rpg-test", key = "STR", playerId = "{instance}", varName = "{instance}_STR");
        setObjectVar(key = "STR", object = "instance", type = "integer", value = "{{instance}_STR}");
        getUserState(category = "simple-rpg-test", key = "CON", playerId = "{instance}", varName = "{instance}_CON");
        setObjectVar(key = "CON", object = "instance", type = "integer", value = "{{instance}_CON}");
        getUserState(category = "simple-rpg-test", key = "AGI", playerId = "{instance}", varName = "{instance}_AGI");
        setObjectVar(key = "AGI", object = "instance", type = "integer", value = "{{instance}_AGI}");
        getUserState(category = "simple-rpg-test", key = "INT", playerId = "{instance}", varName = "{instance}_INT");
        setObjectVar(key = "INT", object = "instance", type = "integer", value = "{{instance}_INT}");
        getUserState(category = "simple-rpg-test", key = "PSY", playerId = "{instance}", varName = "{instance}_PSY");
        setObjectVar(key = "PSY", object = "instance", type = "integer", value = "{{instance}_PSY}");
        getUserState(category = "simple-rpg-test", key = "Exp", playerId = "{instance}", varName = "{instance}_Exp");
        setObjectVar(key = "Exp", object = "instance", type = "integer", value = "{{instance}_Exp}");
        getUserState(category = "simple-rpg-test", key = "HP", playerId = "{instance}", varName = "{instance}_HP");
        setObjectVar(key = "HP", object = "instance", type = "integer", value = "{{instance}_HP}");
        setObjectVar(key = "HP", object = "instance", type = "integer", value = "98 + 10*{instance.CON} + 2*{instance.Level}");
        actorAttributes(actorId = "instance", attr = "maxHp", value = "{instance.HP}");
        actorAttributes(actorId = "instance", attr = "closeWeaponSpeed", value = "4-3/(1+0.05*{instance.AGI})");
        actorAttributes(actorId = "instance", attr = "weight", value = "3*pow(0.97,{instance.AGI})");
        deltaHp(actorCode = "instance", type = "heal", value = 9999);
    }
    triggers {
    }
}
block loadStateNew {
    __repeat__ = -1;
    checks {
        forEachActor(actor = ActorMatch(controller = "player"), varname = "instance");
        checkNumber(lhs = "{instance.completedInit}", op = "==", rhs = 1);
        checkString(str = "{{instance}_savedBefore}", matchKind = "equal", value = "undefined");
    }
    actions {
        setObjectVar(key = "completedInit", object = "instance", type = "string", value = 2);
    }
    triggers {
    }
}
block clickIncreaseSTR {
    __repeat__ = -1;
    triggers {
        clickButton(varName = "instance", buttonId = "increaseSTR");
    }
    checks {
        checkNumber(lhs = "{instance.Point}", op = ">", rhs = 0);
    }
    actions {
        setObjectVar(key = "Point", object = "instance", type = "integer", value = "{instance.Point}-1");
        setObjectVar(key = "STR", object = "instance", type = "integer", value = "{instance.STR}+1");
        actorTalk(actorId = "instance", text = "成功提升一點力量，尚餘{instance.Point}點能力點");
        setObjectVar(key = "HP", object = "instance", type = "integer", value = "98 + 10*{instance.CON} + 2*{instance.Level}");
        actorAttributes(actorId = "instance", attr = "maxHp", value = "{instance.HP}");
        actorAttributes(actorId = "instance", attr = "closeWeaponSpeed", value = "4-3/(1+0.05*{instance.AGI})");
        actorAttributes(actorId = "instance", attr = "weight", value = "3*pow(0.97,{instance.AGI})");
        setUserState(category = "simple-rpg-test", key = "Point", playerId = "{instance}", type = "string", value = "{{instance}.Point}");
        setUserState(category = "simple-rpg-test", key = "ExpNeeded", playerId = "{instance}", type = "string", value = "{{instance}.ExpNeeded}");
        setUserState(category = "simple-rpg-test", key = "Level", playerId = "{instance}", type = "string", value = "{{instance}.Level}");
        setUserState(category = "simple-rpg-test", key = "STR", playerId = "{instance}", type = "string", value = "{{instance}.STR}");
        setUserState(category = "simple-rpg-test", key = "CON", playerId = "{instance}", type = "string", value = "{{instance}.CON}");
        setUserState(category = "simple-rpg-test", key = "AGI", playerId = "{instance}", type = "string", value = "{{instance}.AGI}");
        setUserState(category = "simple-rpg-test", key = "INT", playerId = "{instance}", type = "string", value = "{{instance}.INT}");
        setUserState(category = "simple-rpg-test", key = "PSY", playerId = "{instance}", type = "string", value = "{{instance}.PSY}");
        setUserState(category = "simple-rpg-test", key = "Exp", playerId = "{instance}", type = "string", value = "{{instance}.Exp}");
        setUserState(category = "simple-rpg-test", key = "HP", playerId = "{instance}", type = "string", value = "{{instance}.HP}");
        setUserState(category = "simple-rpg-test", key = "savedBefore", playerId = "{instance}", type = "integer", value = "1");
    }
}
block clickIncreaseCON {
    __repeat__ = -1;
    triggers {
        clickButton(varName = "instance", buttonId = "increaseCON");
    }
    checks {
        checkNumber(lhs = "{instance.Point}", op = ">", rhs = 0);
    }
    actions {
        setObjectVar(key = "Point", object = "instance", type = "integer", value = "{instance.Point}-1");
        setObjectVar(key = "CON", object = "instance", type = "integer", value = "{instance.CON}+1");
        actorTalk(actorId = "instance", text = "成功提升一點體質，尚餘{instance.Point}點能力點");
        setObjectVar(key = "HP", object = "instance", type = "integer", value = "98 + 10*{instance.CON} + 2*{instance.Level}");
        actorAttributes(actorId = "instance", attr = "maxHp", value = "{instance.HP}");
        actorAttributes(actorId = "instance", attr = "closeWeaponSpeed", value = "4-3/(1+0.05*{instance.AGI})");
        actorAttributes(actorId = "instance", attr = "weight", value = "3*pow(0.97,{instance.AGI})");
        setUserState(category = "simple-rpg-test", key = "Point", playerId = "{instance}", type = "string", value = "{{instance}.Point}");
        setUserState(category = "simple-rpg-test", key = "ExpNeeded", playerId = "{instance}", type = "string", value = "{{instance}.ExpNeeded}");
        setUserState(category = "simple-rpg-test", key = "Level", playerId = "{instance}", type = "string", value = "{{instance}.Level}");
        setUserState(category = "simple-rpg-test", key = "STR", playerId = "{instance}", type = "string", value = "{{instance}.STR}");
        setUserState(category = "simple-rpg-test", key = "CON", playerId = "{instance}", type = "string", value = "{{instance}.CON}");
        setUserState(category = "simple-rpg-test", key = "AGI", playerId = "{instance}", type = "string", value = "{{instance}.AGI}");
        setUserState(category = "simple-rpg-test", key = "INT", playerId = "{instance}", type = "string", value = "{{instance}.INT}");
        setUserState(category = "simple-rpg-test", key = "PSY", playerId = "{instance}", type = "string", value = "{{instance}.PSY}");
        setUserState(category = "simple-rpg-test", key = "Exp", playerId = "{instance}", type = "string", value = "{{instance}.Exp}");
        setUserState(category = "simple-rpg-test", key = "HP", playerId = "{instance}", type = "string", value = "{{instance}.HP}");
        setUserState(category = "simple-rpg-test", key = "savedBefore", playerId = "{instance}", type = "integer", value = "1");
    }
}
block clickIncreaseAGI {
    __repeat__ = -1;
    triggers {
        clickButton(varName = "instance", buttonId = "increaseAGI");
    }
    checks {
        checkNumber(lhs = "{instance.Point}", op = ">", rhs = 0);
    }
    actions {
        setObjectVar(key = "Point", object = "instance", type = "integer", value = "{instance.Point}-1");
        setObjectVar(key = "AGI", object = "instance", type = "integer", value = "{instance.AGI}+1");
        actorTalk(actorId = "instance", text = "成功提升一點敏捷，尚餘{instance.Point}點能力點");
        setObjectVar(key = "HP", object = "instance", type = "integer", value = "98 + 10*{instance.CON} + 2*{instance.Level}");
        actorAttributes(actorId = "instance", attr = "maxHp", value = "{instance.HP}");
        actorAttributes(actorId = "instance", attr = "closeWeaponSpeed", value = "4-3/(1+0.05*{instance.AGI})");
        actorAttributes(actorId = "instance", attr = "weight", value = "3*pow(0.97,{instance.AGI})");
        setUserState(category = "simple-rpg-test", key = "Point", playerId = "{instance}", type = "string", value = "{{instance}.Point}");
        setUserState(category = "simple-rpg-test", key = "ExpNeeded", playerId = "{instance}", type = "string", value = "{{instance}.ExpNeeded}");
        setUserState(category = "simple-rpg-test", key = "Level", playerId = "{instance}", type = "string", value = "{{instance}.Level}");
        setUserState(category = "simple-rpg-test", key = "STR", playerId = "{instance}", type = "string", value = "{{instance}.STR}");
        setUserState(category = "simple-rpg-test", key = "CON", playerId = "{instance}", type = "string", value = "{{instance}.CON}");
        setUserState(category = "simple-rpg-test", key = "AGI", playerId = "{instance}", type = "string", value = "{{instance}.AGI}");
        setUserState(category = "simple-rpg-test", key = "INT", playerId = "{instance}", type = "string", value = "{{instance}.INT}");
        setUserState(category = "simple-rpg-test", key = "PSY", playerId = "{instance}", type = "string", value = "{{instance}.PSY}");
        setUserState(category = "simple-rpg-test", key = "Exp", playerId = "{instance}", type = "string", value = "{{instance}.Exp}");
        setUserState(category = "simple-rpg-test", key = "HP", playerId = "{instance}", type = "string", value = "{{instance}.HP}");
        setUserState(category = "simple-rpg-test", key = "savedBefore", playerId = "{instance}", type = "integer", value = "1");
    }
}
block clickIncreaseINT {
    __repeat__ = -1;
    triggers {
        clickButton(varName = "instance", buttonId = "increaseINT");
    }
    checks {
        checkNumber(lhs = "{instance.Point}", op = ">", rhs = 0);
    }
    actions {
        setObjectVar(key = "Point", object = "instance", type = "integer", value = "{instance.Point}-1");
        setObjectVar(key = "INT", object = "instance", type = "integer", value = "{instance.INT}+1");
        actorTalk(actorId = "instance", text = "成功提升一點智慧，尚餘{instance.Point}點能力點");
        setObjectVar(key = "HP", object = "instance", type = "integer", value = "98 + 10*{instance.CON} + 2*{instance.Level}");
        actorAttributes(actorId = "instance", attr = "maxHp", value = "{instance.HP}");
        actorAttributes(actorId = "instance", attr = "closeWeaponSpeed", value = "4-3/(1+0.05*{instance.AGI})");
        actorAttributes(actorId = "instance", attr = "weight", value = "3*pow(0.97,{instance.AGI})");
        setUserState(category = "simple-rpg-test", key = "Point", playerId = "{instance}", type = "string", value = "{{instance}.Point}");
        setUserState(category = "simple-rpg-test", key = "ExpNeeded", playerId = "{instance}", type = "string", value = "{{instance}.ExpNeeded}");
        setUserState(category = "simple-rpg-test", key = "Level", playerId = "{instance}", type = "string", value = "{{instance}.Level}");
        setUserState(category = "simple-rpg-test", key = "STR", playerId = "{instance}", type = "string", value = "{{instance}.STR}");
        setUserState(category = "simple-rpg-test", key = "CON", playerId = "{instance}", type = "string", value = "{{instance}.CON}");
        setUserState(category = "simple-rpg-test", key = "AGI", playerId = "{instance}", type = "string", value = "{{instance}.AGI}");
        setUserState(category = "simple-rpg-test", key = "INT", playerId = "{instance}", type = "string", value = "{{instance}.INT}");
        setUserState(category = "simple-rpg-test", key = "PSY", playerId = "{instance}", type = "string", value = "{{instance}.PSY}");
        setUserState(category = "simple-rpg-test", key = "Exp", playerId = "{instance}", type = "string", value = "{{instance}.Exp}");
        setUserState(category = "simple-rpg-test", key = "HP", playerId = "{instance}", type = "string", value = "{{instance}.HP}");
        setUserState(category = "simple-rpg-test", key = "savedBefore", playerId = "{instance}", type = "integer", value = "1");
    }
}
block clickIncreasePSY {
    __repeat__ = -1;
    triggers {
        clickButton(varName = "instance", buttonId = "increasePSY");
    }
    checks {
        checkNumber(lhs = "{instance.Point}", op = ">", rhs = 0);
    }
    actions {
        setObjectVar(key = "Point", object = "instance", type = "integer", value = "{instance.Point}-1");
        setObjectVar(key = "PSY", object = "instance", type = "integer", value = "{instance.PSY}+1");
        actorTalk(actorId = "instance", text = "成功提升一點精神，尚餘{instance.Point}點能力點");
        setObjectVar(key = "HP", object = "instance", type = "integer", value = "98 + 10*{instance.CON} + 2*{instance.Level}");
        actorAttributes(actorId = "instance", attr = "maxHp", value = "{instance.HP}");
        actorAttributes(actorId = "instance", attr = "closeWeaponSpeed", value = "4-3/(1+0.05*{instance.AGI})");
        actorAttributes(actorId = "instance", attr = "weight", value = "3*pow(0.97,{instance.AGI})");
        setUserState(category = "simple-rpg-test", key = "Point", playerId = "{instance}", type = "string", value = "{{instance}.Point}");
        setUserState(category = "simple-rpg-test", key = "ExpNeeded", playerId = "{instance}", type = "string", value = "{{instance}.ExpNeeded}");
        setUserState(category = "simple-rpg-test", key = "Level", playerId = "{instance}", type = "string", value = "{{instance}.Level}");
        setUserState(category = "simple-rpg-test", key = "STR", playerId = "{instance}", type = "string", value = "{{instance}.STR}");
        setUserState(category = "simple-rpg-test", key = "CON", playerId = "{instance}", type = "string", value = "{{instance}.CON}");
        setUserState(category = "simple-rpg-test", key = "AGI", playerId = "{instance}", type = "string", value = "{{instance}.AGI}");
        setUserState(category = "simple-rpg-test", key = "INT", playerId = "{instance}", type = "string", value = "{{instance}.INT}");
        setUserState(category = "simple-rpg-test", key = "PSY", playerId = "{instance}", type = "string", value = "{{instance}.PSY}");
        setUserState(category = "simple-rpg-test", key = "Exp", playerId = "{instance}", type = "string", value = "{{instance}.Exp}");
        setUserState(category = "simple-rpg-test", key = "HP", playerId = "{instance}", type = "string", value = "{{instance}.HP}");
        setUserState(category = "simple-rpg-test", key = "savedBefore", playerId = "{instance}", type = "integer", value = "1");
    }
}
block releasePowerWindStaff {
    __repeat__ = -1;
    triggers {
        releasePower(varName = "instance", weapon = "custom_wind_staff");
    }
    actions {
        enblastEffect(fromActor = "instance", scale = "0.5", damage = "{instance.INT} + {instance.PSY}/2 + 10", toAngle = "({instance.bodyRotation}*180/3.14+32)");
        enblastEffect(fromActor = "instance", scale = "0.5", damage = "{instance.INT} + {instance.PSY}/2 + 10", toAngle = "({instance.bodyRotation}*180/3.14+16)");
        enblastEffect(fromActor = "instance", scale = "0.5", damage = "{instance.INT} + {instance.PSY}/2 + 10", toAngle = "{instance.bodyRotation}*180/3.14");
        enblastEffect(fromActor = "instance", scale = "0.5", damage = "{instance.INT} + {instance.PSY}/2 + 10", toAngle = "({instance.bodyRotation}*180/3.14-16)");
        enblastEffect(fromActor = "instance", scale = "0.5", damage = "{instance.INT} + {instance.PSY}/2 + 10", toAngle = "({instance.bodyRotation}*180/3.14-32)");
    }
    checks {
    }
}
block releasePowerIronSword {
    __repeat__ = -1;
    triggers {
        releasePower(varName = "instance", weapon = "custom_iron_sword");
    }
    actions {
        deltaHp(actorCode = "instance", value = "{instance.HP}/4");
    }
    checks {
    }
}
block clickResetPoint {
    __repeat__ = -1;
    triggers {
        clickButton(varName = "instance", buttonId = "ResetPoint");
    }
    actions {
        setObjectVar(key = "Point", object = "instance", type = "integer", value = "{instance.Level}*2+3");
        setObjectVar(key = "STR", object = "instance", type = "integer", value = 0);
        setObjectVar(key = "CON", object = "instance", type = "integer", value = 0);
        setObjectVar(key = "AGI", object = "instance", type = "integer", value = 0);
        setObjectVar(key = "INT", object = "instance", type = "integer", value = 0);
        setObjectVar(key = "PSY", object = "instance", type = "integer", value = 0);
        actorTalk(actorId = "instance", text = "成功重設能力點，目前有{instance.Point}點能力點");
        setObjectVar(key = "HP", object = "instance", type = "integer", value = "98 + 10*{instance.CON} + 2*{instance.Level}");
        actorAttributes(actorId = "instance", attr = "maxHp", value = "{instance.HP}");
        actorAttributes(actorId = "instance", attr = "closeWeaponSpeed", value = "4-3/(1+0.05*{instance.AGI})");
        actorAttributes(actorId = "instance", attr = "weight", value = "3*pow(0.97,{instance.AGI})");
        setUserState(category = "simple-rpg-test", key = "Point", playerId = "{instance}", type = "string", value = "{{instance}.Point}");
        setUserState(category = "simple-rpg-test", key = "ExpNeeded", playerId = "{instance}", type = "string", value = "{{instance}.ExpNeeded}");
        setUserState(category = "simple-rpg-test", key = "Level", playerId = "{instance}", type = "string", value = "{{instance}.Level}");
        setUserState(category = "simple-rpg-test", key = "STR", playerId = "{instance}", type = "string", value = "{{instance}.STR}");
        setUserState(category = "simple-rpg-test", key = "CON", playerId = "{instance}", type = "string", value = "{{instance}.CON}");
        setUserState(category = "simple-rpg-test", key = "AGI", playerId = "{instance}", type = "string", value = "{{instance}.AGI}");
        setUserState(category = "simple-rpg-test", key = "INT", playerId = "{instance}", type = "string", value = "{{instance}.INT}");
        setUserState(category = "simple-rpg-test", key = "PSY", playerId = "{instance}", type = "string", value = "{{instance}.PSY}");
        setUserState(category = "simple-rpg-test", key = "Exp", playerId = "{instance}", type = "string", value = "{{instance}.Exp}");
        setUserState(category = "simple-rpg-test", key = "HP", playerId = "{instance}", type = "string", value = "{{instance}.HP}");
        setUserState(category = "simple-rpg-test", key = "savedBefore", playerId = "{instance}", type = "integer", value = "1");
    }
    checks {
    }
}
block getExp {
    __repeat__ = -1;
    triggers {
        itemPickup(actorVarname = "instance", matchKind = "equal", itemVarname = "deer_exp");
    }
    actions {
        setObjectVar(key = "Exp", object = "instance", type = "integer", value = "({instance.Exp}+1)");
        setUserState(category = "simple-rpg-test", key = "Point", playerId = "{instance}", type = "string", value = "{{instance}.Point}");
        setUserState(category = "simple-rpg-test", key = "ExpNeeded", playerId = "{instance}", type = "string", value = "{{instance}.ExpNeeded}");
        setUserState(category = "simple-rpg-test", key = "Level", playerId = "{instance}", type = "string", value = "{{instance}.Level}");
        setUserState(category = "simple-rpg-test", key = "STR", playerId = "{instance}", type = "string", value = "{{instance}.STR}");
        setUserState(category = "simple-rpg-test", key = "CON", playerId = "{instance}", type = "string", value = "{{instance}.CON}");
        setUserState(category = "simple-rpg-test", key = "AGI", playerId = "{instance}", type = "string", value = "{{instance}.AGI}");
        setUserState(category = "simple-rpg-test", key = "INT", playerId = "{instance}", type = "string", value = "{{instance}.INT}");
        setUserState(category = "simple-rpg-test", key = "PSY", playerId = "{instance}", type = "string", value = "{{instance}.PSY}");
        setUserState(category = "simple-rpg-test", key = "Exp", playerId = "{instance}", type = "string", value = "{{instance}.Exp}");
        setUserState(category = "simple-rpg-test", key = "HP", playerId = "{instance}", type = "string", value = "{{instance}.HP}");
        setUserState(category = "simple-rpg-test", key = "savedBefore", playerId = "{instance}", type = "integer", value = "1");
    }
    checks {
    }
}
block monsterDead {
    __repeat__ = -1;
    triggers {
        actorDead(actor = ActorMatch(id = "monster"), varName = "instance");
    }
    actions {
        addDropItem(itemCode = "deer_exp", x = "({instance.gamePosition.x}-16)/32", y = "({instance.gamePosition.y}-16)/32", type = "sariraFire");
    }
    checks {
    }
}
block monsterSpawn {
    __repeat__ = -1;
    __repeatInterval__ = 8000;
    checks {
        actorCount(actor = ActorMatch(id = "monster_deer", matchKind = "contain"), op = "<", value = "5");
    }
    actions {
        addActor(name = "鹿(60)", id = "monster_deer*", camp = "第三", hp = 60, x = "random(21,40)", y = "random(0,19)", localVarname = "actor", weapon1 = "fist", weapon2 = "fist", strength = "10", role = "鹿");
        actorFollow(actorId = "actor", type = "跟隨自己");
    }
    triggers {
    }
}
block levelUp {
    __repeat__ = -1;
    checks {
        forEachActor(actor = ActorMatch(controller = "玩家"), varname = "instance");
        checkNumber(lhs = "{instance.Exp}", op = ">=", rhs = "{instance.ExpNeeded}");
    }
    actions {
        setObjectVar(key = "Exp", object = "instance", type = "integer", value = "{instance.Exp}-{instance.ExpNeeded}");
        setObjectVar(key = "Level", object = "instance", type = "integer", value = "({instance.Level}+1)");
        setObjectVar(key = "Point", object = "instance", type = "integer", value = "({instance.Point}+2)");
        setObjectVar(key = "ExpNeeded", object = "instance", type = "integer", value = "{instance.Level}*2+4");
        setObjectVar(key = "HP", object = "instance", type = "integer", value = "98 + 10*{instance.CON} + 2*{instance.Level}");
        actorAttributes(actorId = "instance", attr = "maxHp", value = "{instance.HP}");
        setUserState(category = "simple-rpg-test", key = "Point", playerId = "{instance}", type = "string", value = "{{instance}.Point}");
        setUserState(category = "simple-rpg-test", key = "ExpNeeded", playerId = "{instance}", type = "string", value = "{{instance}.ExpNeeded}");
        setUserState(category = "simple-rpg-test", key = "Level", playerId = "{instance}", type = "string", value = "{{instance}.Level}");
        setUserState(category = "simple-rpg-test", key = "STR", playerId = "{instance}", type = "string", value = "{{instance}.STR}");
        setUserState(category = "simple-rpg-test", key = "CON", playerId = "{instance}", type = "string", value = "{{instance}.CON}");
        setUserState(category = "simple-rpg-test", key = "AGI", playerId = "{instance}", type = "string", value = "{{instance}.AGI}");
        setUserState(category = "simple-rpg-test", key = "INT", playerId = "{instance}", type = "string", value = "{{instance}.INT}");
        setUserState(category = "simple-rpg-test", key = "PSY", playerId = "{instance}", type = "string", value = "{{instance}.PSY}");
        setUserState(category = "simple-rpg-test", key = "Exp", playerId = "{instance}", type = "string", value = "{{instance}.Exp}");
        setUserState(category = "simple-rpg-test", key = "HP", playerId = "{instance}", type = "string", value = "{{instance}.HP}");
        setUserState(category = "simple-rpg-test", key = "savedBefore", playerId = "{instance}", type = "integer", value = "1");
    }
    triggers {
    }
}
block recover {
    __repeat__ = -1;
    __repeatInterval__ = 10000;
    checks {
        forEachActor(actor = ActorMatch(controller = "玩家"), varname = "instance");
    }
    actions {
        deltaHp(actorCode = "instance", value = "1 + {instance.PSY} + {instance.CON}/2");
    }
    triggers {
    }
}
block pressZ {
    __repeat__ = -1;
    triggers {
        keyboardPressed(varName = "instance", key = "Z");
    }
    actions {
        actorTalk(actorId = "{instance.id}", text = "【Lv{{instance.id}.Level}】\nExp:{{instance.id}.Exp}/{{instance.id}.ExpNeeded}\n尚餘能力點：{{instance.id}.Point}\n力量：{{instance.id}.STR}\n體質：{{instance.id}.CON}\n敏捷：{{instance.id}.AGI}\n智慧：{{instance.id}.INT}\n精神：{{instance.id}.PSY}");
    }
    checks {
    }
}
block staffAttack {
    __repeat__ = -1;
    triggers {
        actorFire(weapon = "custom_wind_staff", varName = "instance");
    }
    actions {
        enblastEffect(fromActor = "instance", toAngle = "{instance.bodyRotation}*180/3.14", scale = "0.5", damage = "{instance.INT} + {instance.PSY}/2 + 10");
    }
    checks {
    }
}
block swordAttack {
    __repeat__ = -1;
    triggers {
        actorHit(actor = ActorMatch(), actorVarName = "instance", hitter = ActorMatch(), hitterVarName = "attacker", weapon = "custom_iron_sword");
    }
    actions {
        deltaHp(actorCode = "instance", casterCode = "attacker", type = "流血受傷", value = "{attacker.STR}*3");
    }
    checks {
    }
}
block newPlayer {
    __repeat__ = -1;
    triggers {
        actorAdded(actor = ActorMatch(controller = "player"), varName = "instance");
    }
    actions {
        setObjectVar(key = "STR", object = "instance", type = "integer", value = 0);
        setObjectVar(key = "CON", object = "instance", type = "integer", value = 0);
        setObjectVar(key = "AGI", object = "instance", type = "integer", value = 0);
        setObjectVar(key = "INT", object = "instance", type = "integer", value = 0);
        setObjectVar(key = "PSY", object = "instance", type = "integer", value = 0);
        setObjectVar(key = "Level", object = "instance", type = "integer", value = 1);
        setObjectVar(key = "Point", object = "instance", type = "integer", value = 5);
        setObjectVar(key = "Exp", object = "instance", type = "integer", value = 0);
        setObjectVar(key = "ExpNeeded", object = "instance", type = "integer", value = 6);
        setObjectVar(key = "HP", object = "instance", type = "integer", value = 100);
        getUserState(category = "simple-rpg-test", key = "savedBefore", playerId = "{instance}", varName = "{instance}_savedBefore");
        setObjectVar(key = "completedInit", object = "instance", type = "integer", value = 1);
    }
    checks {
    }
}
block init {
    actions {
        setWeaponAbility(weapon = "小刀", operation = "無技能", level = 1);
        setWeaponAbility(weapon = "小刀", operation = "無技能", level = 2);
        setWeaponAbility(weapon = "custom_wind_staff");
        setWeaponAbility(weapon = "custom_iron_sword");
        addStuff(x = 4, y = 8, item = "custom_wind_staff");
        addStuff(x = 4, y = 8, item = "custom_wind_staff");
        addStuff(x = 4, y = 8, item = "custom_wind_staff");
        addStuff(x = 4, y = 8, item = "custom_wind_staff");
        addStuff(x = 4, y = 8, item = "custom_wind_staff");
        addMapSign(x = 4, y = 7, rotation = 90, text = "【法杖】\n武器傷害：5\n - 攻擊附帶傷害為【10+智慧+精神/2】的光彈\n技能：釋出5發光彈", showButtons = false);
        addMapSign(x = 6, y = 7, rotation = 90, text = "【鐵劍】\n武器傷害：【30+力量*3】\n技能：恢復四分之一的血量", showButtons = false);
        mapWarp(fromX = 19, fromY = 9, toX = 21, toY = 9, direction = "右");
        mapWarp(fromX = 21, fromY = 9, toX = 19, toY = 9, direction = "左");
        mapWarp(fromX = 19, fromY = 10, toX = 21, toY = 10, direction = "右");
        mapWarp(fromX = 21, fromY = 10, toX = 19, toY = 10, direction = "左");
        addStuff(x = 6, y = 8, item = "custom_iron_sword");
        addStuff(x = 6, y = 8, item = "custom_iron_sword");
        addStuff(x = 6, y = 8, item = "custom_iron_sword");
        addStuff(x = 6, y = 8, item = "custom_iron_sword");
        addStuff(x = 6, y = 8, item = "custom_iron_sword");
        addMapSign(x = 3, y = 17, rotation = 270, text = "【力量】\n消耗一點能力點，提升劍類傷害", buttonCode = "increaseSTR", buttonLabel = "確認");
        addMapSign(x = 5, y = 17, rotation = 270, text = "【體質】\n消耗一點能力點，增加十點血量上限及半點恢復力", buttonCode = "increaseCON", buttonLabel = "確認");
        addMapSign(x = 7, y = 17, rotation = 270, text = "【敏捷】\n消耗一點能力點，重量減少3%，並提升武器攻擊速度", buttonCode = "increaseAGI", buttonLabel = "確認");
        addMapSign(x = 9, y = 17, rotation = 270, text = "【智慧】\n消耗一點能力點，提升杖類傷害", buttonCode = "increaseINT", buttonLabel = "確認");
        addMapSign(x = 11, y = 17, rotation = 270, text = "【精神】\n消耗一點能力點，小量提升杖類傷害及提升一點恢復力", buttonCode = "increasePSY", buttonLabel = "確認");
        addMapSign(x = 1, y = 15, rotation = 0, text = "【重置能力點分配】", buttonCode = "ResetPoint", buttonLabel = "確認");
    }
    checks {
    }
    triggers {
    }
}
//---------------------------------------//
//--- AST After implicitListPromotion ---//
//---------------------------------------//
__skydowLocs__ = [Point(10,10)];
__royalLocs__ = [Point(10,10)];
__thirdLocs__ = [Point(10,10)];
__lives__ = 9999;
__title__ = "RPG試驗";
__useDefaultItems__ = true;
__useCustomWeapons__ = true;
__customWeapons__ = [CustomWeapon(reference = "TWilightGameEventCompiler.weapon_wind_staff", code = "wind_staff", damage = 5, fireType = "單手橫劈", pivotOnHandDegree = 58, pivotOnHandX = 2, pivotOnHandY = 9, pivotOnHandXScale = "1.3", pivotOnHandYScale = "1.5", pivotOnIconDegree = -40, pivotOnIconX = 20, pivotOnIconY = 20),CustomWeapon(reference = "TWilightGameEventCompiler.weapon_iron_sword", code = "iron_sword", damage = 30, fireType = "大刀砍劈", pivotOnHandDegree = 35, pivotOnHandX = -12, pivotOnIconDegree = -40, pivotOnIconX = 27, pivotOnIconY = 14)];
__map__ = "CG.TWilightGameEventCompiler/rpg/simple_rpg.twmap";
__roomSize__ = 8;
block loadStateSaved {
    __repeat__ = -1;
    checks {
        forEachActor(actor = ActorMatch(controller = "player"), varname = "instance");
        checkNumber(lhs = "{instance.completedInit}", op = "==", rhs = 1);
        checkString(str = "{{instance}_savedBefore}", matchKind = "equal", value = "1");
    }
    actions {
        setObjectVar(key = "completedInit", object = "instance", type = "string", value = 2);
        getUserState(category = "simple-rpg-test", key = "Point", playerId = "{instance}", varName = "{instance}_Point");
        setObjectVar(key = "Point", object = "instance", type = "integer", value = "{{instance}_Point}");
        getUserState(category = "simple-rpg-test", key = "ExpNeeded", playerId = "{instance}", varName = "{instance}_ExpNeeded");
        setObjectVar(key = "ExpNeeded", object = "instance", type = "integer", value = "{{instance}_ExpNeeded}");
        getUserState(category = "simple-rpg-test", key = "Level", playerId = "{instance}", varName = "{instance}_Level");
        setObjectVar(key = "Level", object = "instance", type = "integer", value = "{{instance}_Level}");
        getUserState(category = "simple-rpg-test", key = "STR", playerId = "{instance}", varName = "{instance}_STR");
        setObjectVar(key = "STR", object = "instance", type = "integer", value = "{{instance}_STR}");
        getUserState(category = "simple-rpg-test", key = "CON", playerId = "{instance}", varName = "{instance}_CON");
        setObjectVar(key = "CON", object = "instance", type = "integer", value = "{{instance}_CON}");
        getUserState(category = "simple-rpg-test", key = "AGI", playerId = "{instance}", varName = "{instance}_AGI");
        setObjectVar(key = "AGI", object = "instance", type = "integer", value = "{{instance}_AGI}");
        getUserState(category = "simple-rpg-test", key = "INT", playerId = "{instance}", varName = "{instance}_INT");
        setObjectVar(key = "INT", object = "instance", type = "integer", value = "{{instance}_INT}");
        getUserState(category = "simple-rpg-test", key = "PSY", playerId = "{instance}", varName = "{instance}_PSY");
        setObjectVar(key = "PSY", object = "instance", type = "integer", value = "{{instance}_PSY}");
        getUserState(category = "simple-rpg-test", key = "Exp", playerId = "{instance}", varName = "{instance}_Exp");
        setObjectVar(key = "Exp", object = "instance", type = "integer", value = "{{instance}_Exp}");
        getUserState(category = "simple-rpg-test", key = "HP", playerId = "{instance}", varName = "{instance}_HP");
        setObjectVar(key = "HP", object = "instance", type = "integer", value = "{{instance}_HP}");
        setObjectVar(key = "HP", object = "instance", type = "integer", value = "98 + 10*{instance.CON} + 2*{instance.Level}");
        actorAttributes(actorId = "instance", attr = "maxHp", value = "{instance.HP}");
        actorAttributes(actorId = "instance", attr = "closeWeaponSpeed", value = "4-3/(1+0.05*{instance.AGI})");
        actorAttributes(actorId = "instance", attr = "weight", value = "3*pow(0.97,{instance.AGI})");
        deltaHp(actorCode = "instance", type = "heal", value = 9999);
    }
    triggers {
    }
}
block loadStateNew {
    __repeat__ = -1;
    checks {
        forEachActor(actor = ActorMatch(controller = "player"), varname = "instance");
        checkNumber(lhs = "{instance.completedInit}", op = "==", rhs = 1);
        checkString(str = "{{instance}_savedBefore}", matchKind = "equal", value = "undefined");
    }
    actions {
        setObjectVar(key = "completedInit", object = "instance", type = "string", value = 2);
    }
    triggers {
    }
}
block clickIncreaseSTR {
    __repeat__ = -1;
    triggers {
        clickButton(varName = "instance", buttonId = "increaseSTR");
    }
    checks {
        checkNumber(lhs = "{instance.Point}", op = ">", rhs = 0);
    }
    actions {
        setObjectVar(key = "Point", object = "instance", type = "integer", value = "{instance.Point}-1");
        setObjectVar(key = "STR", object = "instance", type = "integer", value = "{instance.STR}+1");
        actorTalk(actorId = "instance", text = "成功提升一點力量，尚餘{instance.Point}點能力點");
        setObjectVar(key = "HP", object = "instance", type = "integer", value = "98 + 10*{instance.CON} + 2*{instance.Level}");
        actorAttributes(actorId = "instance", attr = "maxHp", value = "{instance.HP}");
        actorAttributes(actorId = "instance", attr = "closeWeaponSpeed", value = "4-3/(1+0.05*{instance.AGI})");
        actorAttributes(actorId = "instance", attr = "weight", value = "3*pow(0.97,{instance.AGI})");
        setUserState(category = "simple-rpg-test", key = "Point", playerId = "{instance}", type = "string", value = "{{instance}.Point}");
        setUserState(category = "simple-rpg-test", key = "ExpNeeded", playerId = "{instance}", type = "string", value = "{{instance}.ExpNeeded}");
        setUserState(category = "simple-rpg-test", key = "Level", playerId = "{instance}", type = "string", value = "{{instance}.Level}");
        setUserState(category = "simple-rpg-test", key = "STR", playerId = "{instance}", type = "string", value = "{{instance}.STR}");
        setUserState(category = "simple-rpg-test", key = "CON", playerId = "{instance}", type = "string", value = "{{instance}.CON}");
        setUserState(category = "simple-rpg-test", key = "AGI", playerId = "{instance}", type = "string", value = "{{instance}.AGI}");
        setUserState(category = "simple-rpg-test", key = "INT", playerId = "{instance}", type = "string", value = "{{instance}.INT}");
        setUserState(category = "simple-rpg-test", key = "PSY", playerId = "{instance}", type = "string", value = "{{instance}.PSY}");
        setUserState(category = "simple-rpg-test", key = "Exp", playerId = "{instance}", type = "string", value = "{{instance}.Exp}");
        setUserState(category = "simple-rpg-test", key = "HP", playerId = "{instance}", type = "string", value = "{{instance}.HP}");
        setUserState(category = "simple-rpg-test", key = "savedBefore", playerId = "{instance}", type = "integer", value = "1");
    }
}
block clickIncreaseCON {
    __repeat__ = -1;
    triggers {
        clickButton(varName = "instance", buttonId = "increaseCON");
    }
    checks {
        checkNumber(lhs = "{instance.Point}", op = ">", rhs = 0);
    }
    actions {
        setObjectVar(key = "Point", object = "instance", type = "integer", value = "{instance.Point}-1");
        setObjectVar(key = "CON", object = "instance", type = "integer", value = "{instance.CON}+1");
        actorTalk(actorId = "instance", text = "成功提升一點體質，尚餘{instance.Point}點能力點");
        setObjectVar(key = "HP", object = "instance", type = "integer", value = "98 + 10*{instance.CON} + 2*{instance.Level}");
        actorAttributes(actorId = "instance", attr = "maxHp", value = "{instance.HP}");
        actorAttributes(actorId = "instance", attr = "closeWeaponSpeed", value = "4-3/(1+0.05*{instance.AGI})");
        actorAttributes(actorId = "instance", attr = "weight", value = "3*pow(0.97,{instance.AGI})");
        setUserState(category = "simple-rpg-test", key = "Point", playerId = "{instance}", type = "string", value = "{{instance}.Point}");
        setUserState(category = "simple-rpg-test", key = "ExpNeeded", playerId = "{instance}", type = "string", value = "{{instance}.ExpNeeded}");
        setUserState(category = "simple-rpg-test", key = "Level", playerId = "{instance}", type = "string", value = "{{instance}.Level}");
        setUserState(category = "simple-rpg-test", key = "STR", playerId = "{instance}", type = "string", value = "{{instance}.STR}");
        setUserState(category = "simple-rpg-test", key = "CON", playerId = "{instance}", type = "string", value = "{{instance}.CON}");
        setUserState(category = "simple-rpg-test", key = "AGI", playerId = "{instance}", type = "string", value = "{{instance}.AGI}");
        setUserState(category = "simple-rpg-test", key = "INT", playerId = "{instance}", type = "string", value = "{{instance}.INT}");
        setUserState(category = "simple-rpg-test", key = "PSY", playerId = "{instance}", type = "string", value = "{{instance}.PSY}");
        setUserState(category = "simple-rpg-test", key = "Exp", playerId = "{instance}", type = "string", value = "{{instance}.Exp}");
        setUserState(category = "simple-rpg-test", key = "HP", playerId = "{instance}", type = "string", value = "{{instance}.HP}");
        setUserState(category = "simple-rpg-test", key = "savedBefore", playerId = "{instance}", type = "integer", value = "1");
    }
}
block clickIncreaseAGI {
    __repeat__ = -1;
    triggers {
        clickButton(varName = "instance", buttonId = "increaseAGI");
    }
    checks {
        checkNumber(lhs = "{instance.Point}", op = ">", rhs = 0);
    }
    actions {
        setObjectVar(key = "Point", object = "instance", type = "integer", value = "{instance.Point}-1");
        setObjectVar(key = "AGI", object = "instance", type = "integer", value = "{instance.AGI}+1");
        actorTalk(actorId = "instance", text = "成功提升一點敏捷，尚餘{instance.Point}點能力點");
        setObjectVar(key = "HP", object = "instance", type = "integer", value = "98 + 10*{instance.CON} + 2*{instance.Level}");
        actorAttributes(actorId = "instance", attr = "maxHp", value = "{instance.HP}");
        actorAttributes(actorId = "instance", attr = "closeWeaponSpeed", value = "4-3/(1+0.05*{instance.AGI})");
        actorAttributes(actorId = "instance", attr = "weight", value = "3*pow(0.97,{instance.AGI})");
        setUserState(category = "simple-rpg-test", key = "Point", playerId = "{instance}", type = "string", value = "{{instance}.Point}");
        setUserState(category = "simple-rpg-test", key = "ExpNeeded", playerId = "{instance}", type = "string", value = "{{instance}.ExpNeeded}");
        setUserState(category = "simple-rpg-test", key = "Level", playerId = "{instance}", type = "string", value = "{{instance}.Level}");
        setUserState(category = "simple-rpg-test", key = "STR", playerId = "{instance}", type = "string", value = "{{instance}.STR}");
        setUserState(category = "simple-rpg-test", key = "CON", playerId = "{instance}", type = "string", value = "{{instance}.CON}");
        setUserState(category = "simple-rpg-test", key = "AGI", playerId = "{instance}", type = "string", value = "{{instance}.AGI}");
        setUserState(category = "simple-rpg-test", key = "INT", playerId = "{instance}", type = "string", value = "{{instance}.INT}");
        setUserState(category = "simple-rpg-test", key = "PSY", playerId = "{instance}", type = "string", value = "{{instance}.PSY}");
        setUserState(category = "simple-rpg-test", key = "Exp", playerId = "{instance}", type = "string", value = "{{instance}.Exp}");
        setUserState(category = "simple-rpg-test", key = "HP", playerId = "{instance}", type = "string", value = "{{instance}.HP}");
        setUserState(category = "simple-rpg-test", key = "savedBefore", playerId = "{instance}", type = "integer", value = "1");
    }
}
block clickIncreaseINT {
    __repeat__ = -1;
    triggers {
        clickButton(varName = "instance", buttonId = "increaseINT");
    }
    checks {
        checkNumber(lhs = "{instance.Point}", op = ">", rhs = 0);
    }
    actions {
        setObjectVar(key = "Point", object = "instance", type = "integer", value = "{instance.Point}-1");
        setObjectVar(key = "INT", object = "instance", type = "integer", value = "{instance.INT}+1");
        actorTalk(actorId = "instance", text = "成功提升一點智慧，尚餘{instance.Point}點能力點");
        setObjectVar(key = "HP", object = "instance", type = "integer", value = "98 + 10*{instance.CON} + 2*{instance.Level}");
        actorAttributes(actorId = "instance", attr = "maxHp", value = "{instance.HP}");
        actorAttributes(actorId = "instance", attr = "closeWeaponSpeed", value = "4-3/(1+0.05*{instance.AGI})");
        actorAttributes(actorId = "instance", attr = "weight", value = "3*pow(0.97,{instance.AGI})");
        setUserState(category = "simple-rpg-test", key = "Point", playerId = "{instance}", type = "string", value = "{{instance}.Point}");
        setUserState(category = "simple-rpg-test", key = "ExpNeeded", playerId = "{instance}", type = "string", value = "{{instance}.ExpNeeded}");
        setUserState(category = "simple-rpg-test", key = "Level", playerId = "{instance}", type = "string", value = "{{instance}.Level}");
        setUserState(category = "simple-rpg-test", key = "STR", playerId = "{instance}", type = "string", value = "{{instance}.STR}");
        setUserState(category = "simple-rpg-test", key = "CON", playerId = "{instance}", type = "string", value = "{{instance}.CON}");
        setUserState(category = "simple-rpg-test", key = "AGI", playerId = "{instance}", type = "string", value = "{{instance}.AGI}");
        setUserState(category = "simple-rpg-test", key = "INT", playerId = "{instance}", type = "string", value = "{{instance}.INT}");
        setUserState(category = "simple-rpg-test", key = "PSY", playerId = "{instance}", type = "string", value = "{{instance}.PSY}");
        setUserState(category = "simple-rpg-test", key = "Exp", playerId = "{instance}", type = "string", value = "{{instance}.Exp}");
        setUserState(category = "simple-rpg-test", key = "HP", playerId = "{instance}", type = "string", value = "{{instance}.HP}");
        setUserState(category = "simple-rpg-test", key = "savedBefore", playerId = "{instance}", type = "integer", value = "1");
    }
}
block clickIncreasePSY {
    __repeat__ = -1;
    triggers {
        clickButton(varName = "instance", buttonId = "increasePSY");
    }
    checks {
        checkNumber(lhs = "{instance.Point}", op = ">", rhs = 0);
    }
    actions {
        setObjectVar(key = "Point", object = "instance", type = "integer", value = "{instance.Point}-1");
        setObjectVar(key = "PSY", object = "instance", type = "integer", value = "{instance.PSY}+1");
        actorTalk(actorId = "instance", text = "成功提升一點精神，尚餘{instance.Point}點能力點");
        setObjectVar(key = "HP", object = "instance", type = "integer", value = "98 + 10*{instance.CON} + 2*{instance.Level}");
        actorAttributes(actorId = "instance", attr = "maxHp", value = "{instance.HP}");
        actorAttributes(actorId = "instance", attr = "closeWeaponSpeed", value = "4-3/(1+0.05*{instance.AGI})");
        actorAttributes(actorId = "instance", attr = "weight", value = "3*pow(0.97,{instance.AGI})");
        setUserState(category = "simple-rpg-test", key = "Point", playerId = "{instance}", type = "string", value = "{{instance}.Point}");
        setUserState(category = "simple-rpg-test", key = "ExpNeeded", playerId = "{instance}", type = "string", value = "{{instance}.ExpNeeded}");
        setUserState(category = "simple-rpg-test", key = "Level", playerId = "{instance}", type = "string", value = "{{instance}.Level}");
        setUserState(category = "simple-rpg-test", key = "STR", playerId = "{instance}", type = "string", value = "{{instance}.STR}");
        setUserState(category = "simple-rpg-test", key = "CON", playerId = "{instance}", type = "string", value = "{{instance}.CON}");
        setUserState(category = "simple-rpg-test", key = "AGI", playerId = "{instance}", type = "string", value = "{{instance}.AGI}");
        setUserState(category = "simple-rpg-test", key = "INT", playerId = "{instance}", type = "string", value = "{{instance}.INT}");
        setUserState(category = "simple-rpg-test", key = "PSY", playerId = "{instance}", type = "string", value = "{{instance}.PSY}");
        setUserState(category = "simple-rpg-test", key = "Exp", playerId = "{instance}", type = "string", value = "{{instance}.Exp}");
        setUserState(category = "simple-rpg-test", key = "HP", playerId = "{instance}", type = "string", value = "{{instance}.HP}");
        setUserState(category = "simple-rpg-test", key = "savedBefore", playerId = "{instance}", type = "integer", value = "1");
    }
}
block releasePowerWindStaff {
    __repeat__ = -1;
    triggers {
        releasePower(varName = "instance", weapon = "custom_wind_staff");
    }
    actions {
        enblastEffect(fromActor = "instance", scale = "0.5", damage = "{instance.INT} + {instance.PSY}/2 + 10", toAngle = "({instance.bodyRotation}*180/3.14+32)");
        enblastEffect(fromActor = "instance", scale = "0.5", damage = "{instance.INT} + {instance.PSY}/2 + 10", toAngle = "({instance.bodyRotation}*180/3.14+16)");
        enblastEffect(fromActor = "instance", scale = "0.5", damage = "{instance.INT} + {instance.PSY}/2 + 10", toAngle = "{instance.bodyRotation}*180/3.14");
        enblastEffect(fromActor = "instance", scale = "0.5", damage = "{instance.INT} + {instance.PSY}/2 + 10", toAngle = "({instance.bodyRotation}*180/3.14-16)");
        enblastEffect(fromActor = "instance", scale = "0.5", damage = "{instance.INT} + {instance.PSY}/2 + 10", toAngle = "({instance.bodyRotation}*180/3.14-32)");
    }
    checks {
    }
}
block releasePowerIronSword {
    __repeat__ = -1;
    triggers {
        releasePower(varName = "instance", weapon = "custom_iron_sword");
    }
    actions {
        deltaHp(actorCode = "instance", value = "{instance.HP}/4");
    }
    checks {
    }
}
block clickResetPoint {
    __repeat__ = -1;
    triggers {
        clickButton(varName = "instance", buttonId = "ResetPoint");
    }
    actions {
        setObjectVar(key = "Point", object = "instance", type = "integer", value = "{instance.Level}*2+3");
        setObjectVar(key = "STR", object = "instance", type = "integer", value = 0);
        setObjectVar(key = "CON", object = "instance", type = "integer", value = 0);
        setObjectVar(key = "AGI", object = "instance", type = "integer", value = 0);
        setObjectVar(key = "INT", object = "instance", type = "integer", value = 0);
        setObjectVar(key = "PSY", object = "instance", type = "integer", value = 0);
        actorTalk(actorId = "instance", text = "成功重設能力點，目前有{instance.Point}點能力點");
        setObjectVar(key = "HP", object = "instance", type = "integer", value = "98 + 10*{instance.CON} + 2*{instance.Level}");
        actorAttributes(actorId = "instance", attr = "maxHp", value = "{instance.HP}");
        actorAttributes(actorId = "instance", attr = "closeWeaponSpeed", value = "4-3/(1+0.05*{instance.AGI})");
        actorAttributes(actorId = "instance", attr = "weight", value = "3*pow(0.97,{instance.AGI})");
        setUserState(category = "simple-rpg-test", key = "Point", playerId = "{instance}", type = "string", value = "{{instance}.Point}");
        setUserState(category = "simple-rpg-test", key = "ExpNeeded", playerId = "{instance}", type = "string", value = "{{instance}.ExpNeeded}");
        setUserState(category = "simple-rpg-test", key = "Level", playerId = "{instance}", type = "string", value = "{{instance}.Level}");
        setUserState(category = "simple-rpg-test", key = "STR", playerId = "{instance}", type = "string", value = "{{instance}.STR}");
        setUserState(category = "simple-rpg-test", key = "CON", playerId = "{instance}", type = "string", value = "{{instance}.CON}");
        setUserState(category = "simple-rpg-test", key = "AGI", playerId = "{instance}", type = "string", value = "{{instance}.AGI}");
        setUserState(category = "simple-rpg-test", key = "INT", playerId = "{instance}", type = "string", value = "{{instance}.INT}");
        setUserState(category = "simple-rpg-test", key = "PSY", playerId = "{instance}", type = "string", value = "{{instance}.PSY}");
        setUserState(category = "simple-rpg-test", key = "Exp", playerId = "{instance}", type = "string", value = "{{instance}.Exp}");
        setUserState(category = "simple-rpg-test", key = "HP", playerId = "{instance}", type = "string", value = "{{instance}.HP}");
        setUserState(category = "simple-rpg-test", key = "savedBefore", playerId = "{instance}", type = "integer", value = "1");
    }
    checks {
    }
}
block getExp {
    __repeat__ = -1;
    triggers {
        itemPickup(actorVarname = "instance", matchKind = "equal", itemVarname = "deer_exp");
    }
    actions {
        setObjectVar(key = "Exp", object = "instance", type = "integer", value = "({instance.Exp}+1)");
        setUserState(category = "simple-rpg-test", key = "Point", playerId = "{instance}", type = "string", value = "{{instance}.Point}");
        setUserState(category = "simple-rpg-test", key = "ExpNeeded", playerId = "{instance}", type = "string", value = "{{instance}.ExpNeeded}");
        setUserState(category = "simple-rpg-test", key = "Level", playerId = "{instance}", type = "string", value = "{{instance}.Level}");
        setUserState(category = "simple-rpg-test", key = "STR", playerId = "{instance}", type = "string", value = "{{instance}.STR}");
        setUserState(category = "simple-rpg-test", key = "CON", playerId = "{instance}", type = "string", value = "{{instance}.CON}");
        setUserState(category = "simple-rpg-test", key = "AGI", playerId = "{instance}", type = "string", value = "{{instance}.AGI}");
        setUserState(category = "simple-rpg-test", key = "INT", playerId = "{instance}", type = "string", value = "{{instance}.INT}");
        setUserState(category = "simple-rpg-test", key = "PSY", playerId = "{instance}", type = "string", value = "{{instance}.PSY}");
        setUserState(category = "simple-rpg-test", key = "Exp", playerId = "{instance}", type = "string", value = "{{instance}.Exp}");
        setUserState(category = "simple-rpg-test", key = "HP", playerId = "{instance}", type = "string", value = "{{instance}.HP}");
        setUserState(category = "simple-rpg-test", key = "savedBefore", playerId = "{instance}", type = "integer", value = "1");
    }
    checks {
    }
}
block monsterDead {
    __repeat__ = -1;
    triggers {
        actorDead(actor = ActorMatch(id = "monster"), varName = "instance");
    }
    actions {
        addDropItem(itemCode = "deer_exp", x = "({instance.gamePosition.x}-16)/32", y = "({instance.gamePosition.y}-16)/32", type = "sariraFire");
    }
    checks {
    }
}
block monsterSpawn {
    __repeat__ = -1;
    __repeatInterval__ = 8000;
    checks {
        actorCount(actor = ActorMatch(id = "monster_deer", matchKind = "contain"), op = "<", value = "5");
    }
    actions {
        addActor(name = "鹿(60)", id = "monster_deer*", camp = "第三", hp = 60, x = "random(21,40)", y = "random(0,19)", localVarname = "actor", weapon1 = "fist", weapon2 = "fist", strength = "10", role = "鹿");
        actorFollow(actorId = "actor", type = "跟隨自己");
    }
    triggers {
    }
}
block levelUp {
    __repeat__ = -1;
    checks {
        forEachActor(actor = ActorMatch(controller = "玩家"), varname = "instance");
        checkNumber(lhs = "{instance.Exp}", op = ">=", rhs = "{instance.ExpNeeded}");
    }
    actions {
        setObjectVar(key = "Exp", object = "instance", type = "integer", value = "{instance.Exp}-{instance.ExpNeeded}");
        setObjectVar(key = "Level", object = "instance", type = "integer", value = "({instance.Level}+1)");
        setObjectVar(key = "Point", object = "instance", type = "integer", value = "({instance.Point}+2)");
        setObjectVar(key = "ExpNeeded", object = "instance", type = "integer", value = "{instance.Level}*2+4");
        setObjectVar(key = "HP", object = "instance", type = "integer", value = "98 + 10*{instance.CON} + 2*{instance.Level}");
        actorAttributes(actorId = "instance", attr = "maxHp", value = "{instance.HP}");
        setUserState(category = "simple-rpg-test", key = "Point", playerId = "{instance}", type = "string", value = "{{instance}.Point}");
        setUserState(category = "simple-rpg-test", key = "ExpNeeded", playerId = "{instance}", type = "string", value = "{{instance}.ExpNeeded}");
        setUserState(category = "simple-rpg-test", key = "Level", playerId = "{instance}", type = "string", value = "{{instance}.Level}");
        setUserState(category = "simple-rpg-test", key = "STR", playerId = "{instance}", type = "string", value = "{{instance}.STR}");
        setUserState(category = "simple-rpg-test", key = "CON", playerId = "{instance}", type = "string", value = "{{instance}.CON}");
        setUserState(category = "simple-rpg-test", key = "AGI", playerId = "{instance}", type = "string", value = "{{instance}.AGI}");
        setUserState(category = "simple-rpg-test", key = "INT", playerId = "{instance}", type = "string", value = "{{instance}.INT}");
        setUserState(category = "simple-rpg-test", key = "PSY", playerId = "{instance}", type = "string", value = "{{instance}.PSY}");
        setUserState(category = "simple-rpg-test", key = "Exp", playerId = "{instance}", type = "string", value = "{{instance}.Exp}");
        setUserState(category = "simple-rpg-test", key = "HP", playerId = "{instance}", type = "string", value = "{{instance}.HP}");
        setUserState(category = "simple-rpg-test", key = "savedBefore", playerId = "{instance}", type = "integer", value = "1");
    }
    triggers {
    }
}
block recover {
    __repeat__ = -1;
    __repeatInterval__ = 10000;
    checks {
        forEachActor(actor = ActorMatch(controller = "玩家"), varname = "instance");
    }
    actions {
        deltaHp(actorCode = "instance", value = "1 + {instance.PSY} + {instance.CON}/2");
    }
    triggers {
    }
}
block pressZ {
    __repeat__ = -1;
    triggers {
        keyboardPressed(varName = "instance", key = "Z");
    }
    actions {
        actorTalk(actorId = "{instance.id}", text = "【Lv{{instance.id}.Level}】\nExp:{{instance.id}.Exp}/{{instance.id}.ExpNeeded}\n尚餘能力點：{{instance.id}.Point}\n力量：{{instance.id}.STR}\n體質：{{instance.id}.CON}\n敏捷：{{instance.id}.AGI}\n智慧：{{instance.id}.INT}\n精神：{{instance.id}.PSY}");
    }
    checks {
    }
}
block staffAttack {
    __repeat__ = -1;
    triggers {
        actorFire(weapon = "custom_wind_staff", varName = "instance");
    }
    actions {
        enblastEffect(fromActor = "instance", toAngle = "{instance.bodyRotation}*180/3.14", scale = "0.5", damage = "{instance.INT} + {instance.PSY}/2 + 10");
    }
    checks {
    }
}
block swordAttack {
    __repeat__ = -1;
    triggers {
        actorHit(actor = ActorMatch(), actorVarName = "instance", hitter = ActorMatch(), hitterVarName = "attacker", weapon = "custom_iron_sword");
    }
    actions {
        deltaHp(actorCode = "instance", casterCode = "attacker", type = "流血受傷", value = "{attacker.STR}*3");
    }
    checks {
    }
}
block newPlayer {
    __repeat__ = -1;
    triggers {
        actorAdded(actor = ActorMatch(controller = "player"), varName = "instance");
    }
    actions {
        setObjectVar(key = "STR", object = "instance", type = "integer", value = 0);
        setObjectVar(key = "CON", object = "instance", type = "integer", value = 0);
        setObjectVar(key = "AGI", object = "instance", type = "integer", value = 0);
        setObjectVar(key = "INT", object = "instance", type = "integer", value = 0);
        setObjectVar(key = "PSY", object = "instance", type = "integer", value = 0);
        setObjectVar(key = "Level", object = "instance", type = "integer", value = 1);
        setObjectVar(key = "Point", object = "instance", type = "integer", value = 5);
        setObjectVar(key = "Exp", object = "instance", type = "integer", value = 0);
        setObjectVar(key = "ExpNeeded", object = "instance", type = "integer", value = 6);
        setObjectVar(key = "HP", object = "instance", type = "integer", value = 100);
        getUserState(category = "simple-rpg-test", key = "savedBefore", playerId = "{instance}", varName = "{instance}_savedBefore");
        setObjectVar(key = "completedInit", object = "instance", type = "integer", value = 1);
    }
    checks {
    }
}
block init {
    actions {
        setWeaponAbility(weapon = "小刀", operation = "無技能", level = 1);
        setWeaponAbility(weapon = "小刀", operation = "無技能", level = 2);
        setWeaponAbility(weapon = "custom_wind_staff");
        setWeaponAbility(weapon = "custom_iron_sword");
        addStuff(x = 4, y = 8, item = "custom_wind_staff");
        addStuff(x = 4, y = 8, item = "custom_wind_staff");
        addStuff(x = 4, y = 8, item = "custom_wind_staff");
        addStuff(x = 4, y = 8, item = "custom_wind_staff");
        addStuff(x = 4, y = 8, item = "custom_wind_staff");
        addMapSign(x = 4, y = 7, rotation = 90, text = "【法杖】\n武器傷害：5\n - 攻擊附帶傷害為【10+智慧+精神/2】的光彈\n技能：釋出5發光彈", showButtons = false);
        addMapSign(x = 6, y = 7, rotation = 90, text = "【鐵劍】\n武器傷害：【30+力量*3】\n技能：恢復四分之一的血量", showButtons = false);
        mapWarp(fromX = 19, fromY = 9, toX = 21, toY = 9, direction = "右");
        mapWarp(fromX = 21, fromY = 9, toX = 19, toY = 9, direction = "左");
        mapWarp(fromX = 19, fromY = 10, toX = 21, toY = 10, direction = "右");
        mapWarp(fromX = 21, fromY = 10, toX = 19, toY = 10, direction = "左");
        addStuff(x = 6, y = 8, item = "custom_iron_sword");
        addStuff(x = 6, y = 8, item = "custom_iron_sword");
        addStuff(x = 6, y = 8, item = "custom_iron_sword");
        addStuff(x = 6, y = 8, item = "custom_iron_sword");
        addStuff(x = 6, y = 8, item = "custom_iron_sword");
        addMapSign(x = 3, y = 17, rotation = 270, text = "【力量】\n消耗一點能力點，提升劍類傷害", buttonCode = "increaseSTR", buttonLabel = "確認");
        addMapSign(x = 5, y = 17, rotation = 270, text = "【體質】\n消耗一點能力點，增加十點血量上限及半點恢復力", buttonCode = "increaseCON", buttonLabel = "確認");
        addMapSign(x = 7, y = 17, rotation = 270, text = "【敏捷】\n消耗一點能力點，重量減少3%，並提升武器攻擊速度", buttonCode = "increaseAGI", buttonLabel = "確認");
        addMapSign(x = 9, y = 17, rotation = 270, text = "【智慧】\n消耗一點能力點，提升杖類傷害", buttonCode = "increaseINT", buttonLabel = "確認");
        addMapSign(x = 11, y = 17, rotation = 270, text = "【精神】\n消耗一點能力點，小量提升杖類傷害及提升一點恢復力", buttonCode = "increasePSY", buttonLabel = "確認");
        addMapSign(x = 1, y = 15, rotation = 0, text = "【重置能力點分配】", buttonCode = "ResetPoint", buttonLabel = "確認");
    }
    checks {
    }
    triggers {
    }
}
